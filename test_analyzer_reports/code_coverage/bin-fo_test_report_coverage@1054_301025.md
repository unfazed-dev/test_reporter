# ğŸ“Š Coverage Report

**Generated:** 2025-10-30 10:54:30.203480
**Module:** `lib/src/bin`

## ğŸ“ˆ Executive Summary

| Metric | Value |
|--------|-------|
| **Overall Coverage** | **2.4%** |
| Total Lines | 3153 |
| Covered Lines | 75 |
| Uncovered Lines | 3078 |
| Files Analyzed | 4 |

### Coverage Status: ğŸ”´ Critical

## ğŸ“ File Coverage Breakdown

| File | Coverage | Lines | Covered | Uncovered |
|------|----------|-------|---------|-----------|
| âŒ `failed_test_extractor_lib.dart` | **6.2%** | 356 | 22 | 334 |
| âŒ `run_all_lib.dart` | **7.6%** | 513 | 39 | 474 |
| âŒ `test_analyzer_lib.dart` | **0.1%** | 1237 | 1 | 1236 |
| âŒ `coverage_tool_lib.dart` | **1.2%** | 1047 | 13 | 1034 |

## ğŸ” Uncovered Lines Detail

Below are the specific lines that need test coverage:

### ğŸ“„ `failed_test_extractor_lib.dart`

**Uncovered line numbers:**
```
169, 171, 173-175, 178-179, 183-187, 190-193, 196, 198-199, 201, 206-208, 211, 214-219, 225-226, 229-235, 237-238, 241, 245-246, 248, 251, 254-255, 259-263, 268-269, 272, 275, 278-280, 284-285, 288-289, 293, 296, 299, 302-305, 308-312, 314, 316-319, 323, 325-330, 333, 339-341, 344-345, 347-349, 356-357, 360-362, 365-366, 368-369, 371-372, 374-375, 377-378, 387-390, 393-395, 401-406, 408, 412, 414, 416, 419, 422-423, 428, 431-435, 437-438, 443-444, 446, 448-449, 452-454, 456, 460-463, 466, 469-471, 477-480, 485-488, 493-501, 503-504, 508-509, 512-515, 518-523, 528-532, 537-540, 545-546, 548-550, 553-555, 557-558, 562-566, 572, 574-576, 579, 585-586, 589-591, 594-596, 598, 600, 602, 608, 611, 614-615, 617-621, 626, 632-633, 636-637, 640, 643-648, 650-659, 662, 666-671, 673-682, 684-686, 689-691, 694-700, 702-703, 705-710, 712-717, 719, 725-726, 729-731, 734-735, 737, 740, 743, 747-749, 755-758, 763-765, 767, 772-774, 777-781, 784
```

<details>
<summary>Click to see uncovered code snippets</summary>

- Line 169: `Future<void> run(List<String> arguments) async {`
- Line 171: `_args = _parser.parse(arguments);`
- Line 173: `print('âŒ Error parsing arguments: $e\n');`
- Line 174: `_showUsage();`
- Line 175: `exit(1);`
- Line 178: `if (_args['help'] as bool) {`
- Line 179: `_showUsage();`
- Line 183: `final testPaths = _args.rest;`
- Line 184: `if (testPaths.isEmpty) {`
- Line 185: `print('âŒ Error: No test path specified\n');`
- Line 186: `_showUsage();`
- Line 187: `exit(1);`
- Line 190: `final testPath = testPaths.first;`
- Line 191: `if (!Directory(testPath).existsSync() && !File(testPath).existsSync()) {`
- Line 192: `print('âŒ Error: Test path "$testPath" does not exist');`
- Line 193: `exit(1);`
- Line 196: `print('ğŸ” Failed Test Extractor - Analyzing test failures\n');`
- Line 198: `if (_args['watch'] as bool) {`
- Line 199: `await _runWatchMode(testPath);`
- Line 201: `await _runSingleExecution(testPath);`
- Line 206: `Future<void> _runWatchMode(String testPath) async {`
- Line 207: `print('ğŸ‘€ Starting watch mode for: $testPath');`
- Line 208: `print('   Press Ctrl+C to stop\n');`
- Line 211: `await _runSingleExecution(testPath);`
- Line 214: `await for (final event in _watchDirectory(testPath)) {`
- Line 215: `if (event.type == FileSystemEvent.modify &&`
- Line 216: `event.path.endsWith('.dart')) {`
- Line 217: `print('\nğŸ“ File changed: ${event.path}');`
- Line 218: `print('ğŸ”„ Re-running failed test extraction...\n');`
- Line 219: `await _runSingleExecution(testPath);`
- Line 225: `Future<void> _runSingleExecution(String testPath) async {`
- Line 226: `final stopwatch = Stopwatch()..start();`
- Line 229: `_failedTests.clear();`
- Line 230: `_testIdToName.clear();`
- Line 231: `_testIdToFile.clear();`
- Line 232: `_testIdToGroup.clear();`
- Line 233: `_suiteIdToPath.clear();`
- Line 234: `_totalTests = 0;`
- Line 235: `_passedTests = 0;`
- Line 237: `print('ğŸš€ Running tests with JSON reporter...');`
- Line 238: `final results = await _runTestsWithJsonOutput(testPath);`
- Line 241: `print('âŒ Failed to execute tests');`
- Line 245: `stopwatch.stop();`
- Line 246: `_totalTime = stopwatch.elapsed;`
- Line 248: `print('âœ… Test execution completed in ${_formatDuration(_totalTime)}\n');`
- Line 251: `await _displayResults(results);`
- Line 254: `if (_args['save-results'] as bool) {`
- Line 255: `await _saveResults(results, testPath);`
- Line 259: `if (_args['auto-rerun'] as bool &&`
- Line 260: `!(_args['list-only'] as bool) &&`
- Line 261: `results.failedTests.isNotEmpty) {`
- Line 262: `print('\nğŸ”„ Auto-rerunning failed tests...\n');`
- Line 263: `await _rerunFailedTests(results.failedTests);`
- Line 268: `Future<TestResults?> _runTestsWithJsonOutput(String testPath) async {`
- Line 269: `final testArgs = <String>['test'];`
- Line 272: `testArgs.add(testPath);`
- Line 275: `testArgs.addAll(['--reporter', 'json']);`
- Line 278: `final timeout = int.tryParse(_args['timeout'] as String) ?? 120;`
- Line 279: `if (timeout > 0) {`
- Line 280: `testArgs.addAll(['--timeout', '${timeout}s']);`
- Line 284: `if (_args['parallel'] as bool) {`
- Line 285: `testArgs.add('--concurrency=4');`
- Line 288: `if (_args['verbose'] as bool) {`
- Line 289: `print('ğŸ”§ Running: flutter ${testArgs.join(' ')}');`
- Line 293: `final process = await Process.start(`
- Line 296: `workingDirectory: Directory.current.path,`
- Line 299: `final jsonOutput = <String>[];`
- Line 302: `process.stdout`
- Line 303: `.transform(utf8.decoder)`
- Line 304: `.transform(const LineSplitter())`
- Line 305: `.listen(jsonOutput.add);`
- Line 308: `final stderrLines = <String>[];`
- Line 309: `process.stderr`
- Line 310: `.transform(utf8.decoder)`
- Line 311: `.transform(const LineSplitter())`
- Line 312: `.listen(stderrLines.add);`
- Line 314: `await process.exitCode;`
- Line 316: `if (_args['verbose'] as bool && stderrLines.isNotEmpty) {`
- Line 317: `print('âš ï¸  Test stderr output:');`
- Line 318: `stderrLines.forEach(print);`
- Line 319: `print('');`
- Line 323: `await _parseJsonEvents(jsonOutput);`
- Line 325: `return TestResults(`
- Line 326: `failedTests: List.from(_failedTests),`
- Line 327: `totalTests: _totalTests,`
- Line 328: `passedTests: _passedTests,`
- Line 329: `totalTime: _totalTime,`
- Line 330: `timestamp: DateTime.now(),`
- Line 333: `print('âŒ Error running tests: $e');`
- Line 339: `Future<void> _parseJsonEvents(List<String> jsonLines) async {`
- Line 340: `for (final line in jsonLines) {`
- Line 341: `if (line.trim().isEmpty) continue;`
- Line 344: `final event = jsonDecode(line) as Map<String, dynamic>;`
- Line 345: `await _processJsonEvent(event);`
- Line 347: `if (_args['verbose'] as bool) {`
- Line 348: `print('âš ï¸  Failed to parse JSON line: $line');`
- Line 349: `print('   Error: $e');`
- Line 356: `Future<void> _processJsonEvent(Map<String, dynamic> event) async {`
- Line 357: `final type = event['type'] as String?;`
- Line 360: `case 'start':`
- Line 361: `if (_args['verbose'] as bool) {`
- Line 362: `print('ğŸ¬ Test suite started');`
- Line 365: `case 'suite':`
- Line 366: `_handleSuite(event);`
- Line 368: `case 'testStart':`
- Line 369: `_handleTestStart(event);`
- Line 371: `case 'testDone':`
- Line 372: `_handleTestDone(event);`
- Line 374: `case 'done':`
- Line 375: `_handleDone(event);`
- Line 377: `case 'error':`
- Line 378: `_handleError(event);`
- Line 387: `void _handleSuite(Map<String, dynamic> event) {`
- Line 388: `final suite = event['suite'] as Map<String, dynamic>;`
- Line 389: `final id = suite['id'] as int;`
- Line 390: `final path = suite['path'] as String?;`
- Line 393: `_suiteIdToPath[id.toString()] = path;`
- Line 394: `if (_args['verbose'] as bool) {`
- Line 395: `print('ğŸ“ Suite $id: $path');`
- Line 401: `void _handleTestStart(Map<String, dynamic> event) {`
- Line 402: `final test = event['test'] as Map<String, dynamic>;`
- Line 403: `final id = test['id'] as int;`
- Line 404: `final name = test['name'] as String;`
- Line 405: `final groupIDs = test['groupIDs'] as List<dynamic>?;`
- Line 406: `final suiteID = test['suiteID'] as int?;`
- Line 408: `_testIdToName[id.toString()] = name;`
- Line 412: `final suitePath = _suiteIdToPath[suiteID.toString()];`
- Line 414: `_testIdToFile[id.toString()] = suitePath;`
- Line 416: `_testIdToFile[id.toString()] = 'unknown_file.dart';`
- Line 419: `_testIdToFile[id.toString()] = 'unknown_file.dart';`
- Line 422: `if (groupIDs != null && groupIDs.isNotEmpty) {`
- Line 423: `_testIdToGroup[id.toString()] = 'group_${groupIDs.first}';`
- Line 428: `void _handleTestDone(Map<String, dynamic> event) {`
- Line 431: `if (event.containsKey('testID')) {`
- Line 432: `id = event['testID'] as int;`
- Line 433: `} else if (event.containsKey('test')) {`
- Line 434: `final test = event['test'] as Map<String, dynamic>;`
- Line 435: `id = test['id'] as int;`
- Line 437: `if (_args['verbose'] as bool) {`
- Line 438: `print('âš ï¸  testDone event missing testID and test fields');`
- Line 443: `final result = event['result'] as String;`
- Line 444: `final time = event['time'] as int?;`
- Line 446: `_totalTests++;`
- Line 448: `if (result == 'success') {`
- Line 449: `_passedTests++;`
- Line 452: `final name = _testIdToName[id.toString()] ?? 'Unknown Test';`
- Line 453: `final filePath = _testIdToFile[id.toString()] ?? 'unknown_file.dart';`
- Line 454: `final group = _testIdToGroup[id.toString()];`
- Line 456: `final failedTest = FailedTest(`
- Line 460: `error: event['error']?.toString(),`
- Line 461: `stackTrace: event['stackTrace']?.toString(),`
- Line 462: `runtime: time != null ? Duration(milliseconds: time) : null,`
- Line 463: `testId: id.toString(),`
- Line 466: `_failedTests.add(failedTest);`
- Line 469: `final maxFailures = int.tryParse(_args['max-failures'] as String) ?? 0;`
- Line 470: `if (maxFailures > 0 && _failedTests.length >= maxFailures) {`
- Line 471: `print('âš ï¸  Reached maximum failure limit ($maxFailures)');`
- Line 477: `void _handleDone(Map<String, dynamic> event) {`
- Line 478: `final success = event['success'] as bool? ?? false;`
- Line 479: `if (_args['verbose'] as bool) {`
- Line 480: `print('ğŸ Test suite completed. Success: $success');`
- Line 485: `void _handleError(Map<String, dynamic> event) {`
- Line 486: `final error = event['error'] as String? ?? 'Unknown error';`
- Line 487: `if (_args['verbose'] as bool) {`
- Line 488: `print('âŒ Test error: $error');`
- Line 493: `Future<void> _displayResults(TestResults results) async {`
- Line 494: `print('ğŸ“Š TEST EXECUTION SUMMARY');`
- Line 495: `print('=' * 50);`
- Line 496: `print('Total Tests:      ${results.totalTests}');`
- Line 497: `print('Passed:           ${results.passedTests}');`
- Line 498: `print('Failed:           ${results.failedCount}');`
- Line 499: `print('Success Rate:     ${results.successRate.toStringAsFixed(1)}%');`
- Line 500: `print('Execution Time:   ${_formatDuration(results.totalTime)}');`
- Line 501: `print('');`
- Line 503: `if (results.failedTests.isEmpty) {`
- Line 504: `print('ğŸ‰ All tests passed! No failed tests to rerun.');`
- Line 508: `print('âŒ FAILED TESTS (${results.failedCount})');`
- Line 509: `print('=' * 50);`
- Line 512: `if (_args['group-by-file'] as bool) {`
- Line 513: `final groupedTests = <String, List<FailedTest>>{};`
- Line 514: `for (final test in results.failedTests) {`
- Line 515: `groupedTests.putIfAbsent(test.filePath, () => []).add(test);`
- Line 518: `for (final entry in groupedTests.entries) {`
- Line 519: `print('\nğŸ“ ${entry.key} (${entry.value.length} failures)');`
- Line 520: `for (final test in entry.value) {`
- Line 521: `print('   â€¢ ${test.name}');`
- Line 522: `if (test.error != null && _args['verbose'] as bool) {`
- Line 523: `print('     Error: ${test.error}');`
- Line 528: `for (var i = 0; i < results.failedTests.length; i++) {`
- Line 529: `final test = results.failedTests[i];`
- Line 530: `print('${i + 1}. ${test.filePath}: ${test.name}');`
- Line 531: `if (test.error != null && _args['verbose'] as bool) {`
- Line 532: `print('   Error: ${test.error}');`
- Line 537: `if (!(_args['list-only'] as bool)) {`
- Line 538: `print('\nğŸ”„ RERUN COMMANDS');`
- Line 539: `print('=' * 50);`
- Line 540: `_generateRerunCommands(results.failedTests);`
- Line 545: `void _generateRerunCommands(List<FailedTest> failedTests) {`
- Line 546: `if (_args['group-by-file'] as bool) {`
- Line 548: `final groupedTests = <String, List<FailedTest>>{};`
- Line 549: `for (final test in failedTests) {`
- Line 550: `groupedTests.putIfAbsent(test.filePath, () => []).add(test);`
- Line 553: `for (final entry in groupedTests.entries) {`
- Line 554: `final testNames = entry.value.map((t) => t.name).toList();`
- Line 555: `final namePattern = testNames.map(_escapeRegex).join('|');`
- Line 557: `print('\n# Rerun failed tests in ${entry.key}:');`
- Line 558: `print('flutter test ${entry.key} --name "$namePattern"');`
- Line 562: `for (var i = 0; i < failedTests.length; i++) {`
- Line 563: `final test = failedTests[i];`
- Line 564: `print('\n# Rerun test ${i + 1}:');`
- Line 565: `print(`
- Line 566: `'flutter test ${test.filePath} --name "${_escapeRegex(test.name)}"',`
- Line 572: `if (failedTests.length > 1) {`
- Line 574: `failedTests.map((t) => _escapeRegex(t.name)).toSet().join('|');`
- Line 575: `print('\n# Rerun ALL failed tests:');`
- Line 576: `print('flutter test --name "$allNames"');`
- Line 579: `print(`
- Line 585: `Future<void> _rerunFailedTests(List<FailedTest> failedTests) async {`
- Line 586: `if (failedTests.isEmpty) return;`
- Line 589: `final groupedTests = <String, List<FailedTest>>{};`
- Line 590: `for (final test in failedTests) {`
- Line 591: `groupedTests.putIfAbsent(test.filePath, () => []).add(test);`
- Line 594: `for (final entry in groupedTests.entries) {`
- Line 595: `final testNames = entry.value.map((t) => t.name).toList();`
- Line 596: `final namePattern = testNames.map(_escapeRegex).join('|');`
- Line 598: `print('ğŸ”„ Rerunning ${testNames.length} failed tests in ${entry.key}...');`
- Line 600: `final rerunArgs = [`
- Line 602: `entry.key,`
- Line 608: `final result = await Process.run(`
- Line 611: `workingDirectory: Directory.current.path,`
- Line 614: `if (result.exitCode == 0) {`
- Line 615: `print('âœ… All retested failures now pass in ${entry.key}');`
- Line 617: `print('âŒ Some tests still failing in ${entry.key}');`
- Line 618: `if (_args['verbose'] as bool) {`
- Line 619: `print('   Exit code: ${result.exitCode}');`
- Line 620: `if (result.stderr.toString().isNotEmpty) {`
- Line 621: `print('   Stderr: ${result.stderr}');`
- Line 626: `print('âŒ Error rerunning tests: $e');`
- Line 632: `Future<void> _saveResults(TestResults results, String testPath) async {`
- Line 633: `final timestamp = results.timestamp;`
- Line 636: `final jsonData = {`
- Line 637: `'metadata': {`
- Line 640: `'generated': timestamp.toIso8601String(),`
- Line 643: `'summary': {`
- Line 644: `'totalTests': results.totalTests,`
- Line 645: `'passedTests': results.passedTests,`
- Line 646: `'failedTests': results.failedCount,`
- Line 647: `'successRate': results.successRate,`
- Line 648: `'executionTime': results.totalTime.inMilliseconds,`
- Line 650: `'failedTests': results.failedTests`
- Line 651: `.map(`
- Line 652: `(test) => {`
- Line 653: `'name': test.name,`
- Line 654: `'filePath': test.filePath,`
- Line 655: `'group': test.group,`
- Line 656: `'error': test.error,`
- Line 657: `'stackTrace': test.stackTrace,`
- Line 658: `'runtime': test.runtime?.inMilliseconds,`
- Line 659: `'testId': test.testId,`
- Line 662: `.toList(),`
- Line 666: `final markdown = StringBuffer();`
- Line 667: `markdown.writeln('# ğŸ”´ Failed Test Report');`
- Line 668: `markdown.writeln();`
- Line 669: `markdown.writeln('**Generated:** ${timestamp.toLocal()}');`
- Line 670: `markdown.writeln('**Test Path:** `$testPath`');`
- Line 671: `markdown.writeln();`
- Line 673: `markdown.writeln('## ğŸ“Š Summary');`
- Line 674: `markdown.writeln();`
- Line 675: `markdown.writeln('| Metric | Value |');`
- Line 676: `markdown.writeln('|--------|-------|');`
- Line 677: `markdown.writeln('| Total Tests | ${results.totalTests} |');`
- Line 678: `markdown.writeln('| Passed | âœ… ${results.passedTests} |');`
- Line 679: `markdown.writeln('| Failed | âŒ ${results.failedCount} |');`
- Line 680: `markdown.writeln('| Success Rate | ${results.successRate.toStringAsFixed(1)}%...`
- Line 681: `markdown.writeln('| Execution Time | ${_formatDuration(results.totalTime)} |');`
- Line 682: `markdown.writeln();`
- Line 684: `if (results.failedTests.isNotEmpty) {`
- Line 685: `markdown.writeln('## âŒ Failed Tests');`
- Line 686: `markdown.writeln();`
- Line 689: `final groupedTests = <String, List<FailedTest>>{};`
- Line 690: `for (final test in results.failedTests) {`
- Line 691: `groupedTests.putIfAbsent(test.filePath, () => []).add(test);`
- Line 694: `for (final entry in groupedTests.entries) {`
- Line 695: `markdown.writeln('### ${entry.key}');`
- Line 696: `markdown.writeln();`
- Line 697: `for (final test in entry.value) {`
- Line 698: `markdown.writeln('#### ${test.name}');`
- Line 699: `if (test.group != null) {`
- Line 700: `markdown.writeln('**Group:** ${test.group}');`
- Line 702: `if (test.runtime != null) {`
- Line 703: `markdown.writeln('**Runtime:** ${_formatDuration(test.runtime!)}');`
- Line 705: `if (test.error != null) {`
- Line 706: `markdown.writeln();`
- Line 707: `markdown.writeln('**Error:**');`
- Line 708: `markdown.writeln('```');`
- Line 709: `markdown.writeln(test.error);`
- Line 710: `markdown.writeln('```');`
- Line 712: `if (test.stackTrace != null && _args['verbose'] as bool) {`
- Line 713: `markdown.writeln();`
- Line 714: `markdown.writeln('**Stack Trace:**');`
- Line 715: `markdown.writeln('```');`
- Line 716: `markdown.writeln(test.stackTrace);`
- Line 717: `markdown.writeln('```');`
- Line 719: `markdown.writeln();`
- Line 725: `final pathParts = testPath.split('/');`
- Line 726: `final moduleName = pathParts.length > 1 ? pathParts.last : 'tests';`
- Line 729: `final simpleTimestamp =`
- Line 730: `'${timestamp.hour.toString().padLeft(2, '0')}${timestamp.minute.toString().pa...`
- Line 731: `'${timestamp.day.toString().padLeft(2, '0')}${timestamp.month.toString().padL...`
- Line 734: `final reportPath = await ReportUtils.writeUnifiedReport(`
- Line 735: `moduleName: '$moduleName-fo',`
- Line 737: `markdownContent: markdown.toString(),`
- Line 740: `verbose: _args['verbose'] as bool,`
- Line 743: `print('ğŸ’¾ Results saved to: $reportPath');`
- Line 747: `Stream<FileSystemEvent> _watchDirectory(String path) async* {`
- Line 748: `final directory = Directory(path);`
- Line 749: `await for (final event in directory.watch(recursive: true)) {`
- Line 755: `String _escapeRegex(String input) {`
- Line 756: `return input.replaceAllMapped(`
- Line 757: `RegExp(r'[.*+?^${}()|[\]\\]'),`
- Line 758: `(match) => '\\${match.group(0)}',`
- Line 763: `String _formatDuration(Duration duration) {`
- Line 764: `if (duration.inMinutes > 0) {`
- Line 765: `return '${duration.inMinutes}m ${duration.inSeconds % 60}s';`
- Line 767: `return '${duration.inSeconds}.${(duration.inMilliseconds % 1000).toString().p...`
- Line 772: `void _showUsage() {`
- Line 773: `print('Failed Test Extractor - Extract and rerun only failing tests\n');`
- Line 774: `print(`
- Line 777: `print('Options:');`
- Line 778: `print(_parser.usage);`
- Line 779: `print('\nExamples:');`
- Line 780: `print('  flutter pub run analyzer/failed_test_extractor.dart test/');`
- Line 781: `print(`
- Line 784: `print(`

</details>

### ğŸ“„ `run_all_lib.dart`

**Uncovered line numbers:**
```
92-93, 96-97, 100-101, 104-105, 108, 111, 114-115, 117, 120-121, 123, 127, 132, 136, 139-141, 144-146, 148-153, 156-161, 164, 166, 168-169, 172-173, 176, 180-181, 183-184, 189-190, 192-193, 196, 199, 204-205, 209-210, 215, 218-219, 221, 224-225, 227, 232, 236, 239-241, 243-245, 247-252, 255-260, 263, 265-266, 269-270, 273, 277-278, 280-281, 286-287, 289-290, 293, 296, 300-301, 304-305, 308, 312-313, 315, 320-322, 324, 327, 332-333, 337-338, 343, 345, 350-352, 356-357, 359-360, 363-364, 368-373, 377-378, 383-386, 389-390, 392, 397-400, 403-410, 413, 418, 421-430, 433-449, 452, 454-455, 457, 459-461, 463-467, 469, 472-476, 478, 481-484, 488-493, 495, 497-498, 502-503, 507-516, 521-531, 535-538, 541-543, 545, 548-552, 555-557, 559, 561, 564-576, 579-580, 585-588, 590-591, 594-596, 599-600, 607-609, 616, 619-623, 627, 630-631, 633-634, 639-642, 644-645, 651-652, 654-655, 657, 659, 663, 668, 671, 674-675, 678, 680, 682-688, 690-697, 699-704, 707-710, 713-715, 717-721, 723-727, 729-734, 736, 742-745, 747-749, 751-754, 756-757, 759-760, 763-767, 770, 776-780, 782-784, 786-787, 791-792, 795-796, 799-801, 804, 806-807, 811, 814, 817, 820-821, 823, 827-828, 831, 833, 835-837, 840, 842-843, 846, 853, 855, 857-859, 862, 866-868, 871, 875-877, 880, 889-890, 893, 895, 897-899, 907, 909, 911-913, 918-920, 928-929, 937-945, 948-951, 954, 956-958, 961-964, 966-967
```

<details>
<summary>Click to see uncovered code snippets</summary>

- Line 92: `Future<void> runAll() async {`
- Line 93: `printHeader();`
- Line 96: `print('\nğŸ“Š Step 1/2: Analyzing test coverage...');`
- Line 97: `final coverageSuccess = await runCoverageTool();`
- Line 100: `print('\nğŸ§ª Step 2/2: Analyzing test reliability...');`
- Line 101: `final analyzerSuccess = await runTestAnalyzer();`
- Line 104: `print('\nğŸ“ Generating unified report...');`
- Line 105: `await generateUnifiedReport();`
- Line 108: `printSummary(coverageSuccess: coverageSuccess, analyzerSuccess: analyzerSucce...`
- Line 111: `Future<bool> runCoverageTool() async {`
- Line 114: `String sourcePath = testPath;`
- Line 115: `if (testPath.startsWith('test')) {`
- Line 117: `sourcePath = testPath.replaceFirst('test', 'lib');`
- Line 120: `final derivedFile = File(sourcePath);`
- Line 121: `final derivedDir = Directory(sourcePath);`
- Line 123: `if (!derivedFile.existsSync() && !derivedDir.existsSync()) {`
- Line 127: `} else if (testPath == 'lib') {`
- Line 132: `final args = <String>[`
- Line 136: `testPath, // Pass testPath for consistent naming`
- Line 139: `if (verbose) {`
- Line 140: `args.add('--verbose');`
- Line 141: `print('  [DEBUG] Running coverage_tool with args: $sourcePath $testPath');`
- Line 144: `final process = await Process.start('dart', args);`
- Line 145: `final output = <String>[];`
- Line 146: `final errors = <String>[];`
- Line 148: `process.stdout`
- Line 149: `.transform(utf8.decoder)`
- Line 150: `.transform(const LineSplitter())`
- Line 151: `.listen((line) {`
- Line 152: `output.add(line);`
- Line 153: `if (verbose) print(line);`
- Line 156: `process.stderr`
- Line 157: `.transform(utf8.decoder)`
- Line 158: `.transform(const LineSplitter())`
- Line 159: `.listen((line) {`
- Line 160: `errors.add(line);`
- Line 161: `if (verbose) print('  [ERROR] $line');`
- Line 164: `final exitCode = await process.exitCode;`
- Line 166: `if (exitCode == 0) {`
- Line 168: `await Future<void>.delayed(const Duration(milliseconds: 100));`
- Line 169: `print('  âœ… Coverage analysis complete');`
- Line 172: `final coverageReport = await findLatestReport('test_report_coverage');`
- Line 173: `if (verbose) print('  ğŸ“Š Coverage report found: $coverageReport');`
- Line 176: `final jsonData = await ReportUtils.extractJsonFromReport(`
- Line 180: `if (verbose) {`
- Line 181: `print('  ğŸ” JSON extraction result: ${jsonData != null ? 'SUCCESS' : 'FAILED'...`
- Line 183: `print('  ğŸ“‹ JSON keys: ${jsonData.keys.toList()}');`
- Line 184: `print('  ğŸ“Š Coverage summary: ${jsonData['summary']}');`
- Line 189: `results['coverage'] = jsonData;`
- Line 190: `reportPaths['coverage'] = coverageReport;`
- Line 192: `if (verbose) {`
- Line 193: `print('  ğŸ“„ Coverage report retained: $coverageReport');`
- Line 196: `if (verbose) print('  âš ï¸  Failed to extract JSON from coverage report');`
- Line 199: `if (verbose) print('  âš ï¸  No coverage report found');`
- Line 204: `print('  âŒ Coverage analysis failed with exit code $exitCode');`
- Line 205: `failures.add('coverage_tool');`
- Line 209: `print('  âŒ Coverage tool error: $e');`
- Line 210: `failures.add('coverage_tool');`
- Line 215: `Future<bool> runTestAnalyzer() async {`
- Line 218: `String actualTestPath = testPath;`
- Line 219: `if (testPath.startsWith('lib')) {`
- Line 221: `actualTestPath = testPath.replaceFirst('lib', 'test');`
- Line 224: `if (actualTestPath.endsWith('.dart') && !actualTestPath.endsWith('_test.dart'...`
- Line 225: `actualTestPath = actualTestPath.replaceFirst('.dart', '_test.dart');`
- Line 227: `} else if (!testPath.startsWith('test')) {`
- Line 232: `final args = <String>[`
- Line 236: `'--runs=$runs',`
- Line 239: `if (performance) args.add('--performance');`
- Line 240: `if (verbose) args.add('--verbose');`
- Line 241: `if (parallel) args.add('--parallel');`
- Line 243: `final process = await Process.start('dart', args);`
- Line 244: `final output = <String>[];`
- Line 245: `final errors = <String>[];`
- Line 247: `process.stdout`
- Line 248: `.transform(utf8.decoder)`
- Line 249: `.transform(const LineSplitter())`
- Line 250: `.listen((line) {`
- Line 251: `output.add(line);`
- Line 252: `if (verbose) print(line);`
- Line 255: `process.stderr`
- Line 256: `.transform(utf8.decoder)`
- Line 257: `.transform(const LineSplitter())`
- Line 258: `.listen((line) {`
- Line 259: `errors.add(line);`
- Line 260: `if (verbose) print('  [ERROR] $line');`
- Line 263: `final exitCode = await process.exitCode;`
- Line 265: `if (exitCode == 0) {`
- Line 266: `print('  âœ… Test analysis complete');`
- Line 269: `final analyzerReport = await findLatestReport('test_report_analyzer');`
- Line 270: `if (verbose) print('  ğŸ“Š Analyzer report found: $analyzerReport');`
- Line 273: `final jsonData = await ReportUtils.extractJsonFromReport(`
- Line 277: `if (verbose) {`
- Line 278: `print('  ğŸ” JSON extraction result: ${jsonData != null ? 'SUCCESS' : 'FAILED'...`
- Line 280: `print('  ğŸ“‹ JSON keys: ${jsonData.keys.toList()}');`
- Line 281: `print('  ğŸ“Š Test analysis summary: ${jsonData['summary']}');`
- Line 286: `results['test_analysis'] = jsonData;`
- Line 287: `reportPaths['analyzer'] = analyzerReport;`
- Line 289: `if (verbose) {`
- Line 290: `print('  ğŸ“„ Analyzer report retained: $analyzerReport');`
- Line 293: `if (verbose) print('  âš ï¸  Failed to extract JSON from analyzer report');`
- Line 296: `if (verbose) print('  âš ï¸  No analyzer report found');`
- Line 300: `} else if (exitCode == 1) {`
- Line 301: `print('  âš ï¸  Test analysis complete with test failures');`
- Line 304: `final analyzerReport = await findLatestReport('test_report_analyzer');`
- Line 305: `if (verbose) print('  ğŸ“Š Analyzer report found: $analyzerReport');`
- Line 308: `final jsonData = await ReportUtils.extractJsonFromReport(`
- Line 312: `if (verbose) {`
- Line 313: `print('  ğŸ” JSON extraction result: ${jsonData != null ? 'SUCCESS' : 'FAILED'...`
- Line 315: `print('  ğŸ“‹ JSON keys: ${jsonData.keys.toList()}');`
- Line 320: `results['test_analysis'] = jsonData;`
- Line 321: `reportPaths['analyzer'] = analyzerReport;`
- Line 322: `if (verbose) print('  ğŸ“„ Analyzer report retained: $analyzerReport');`
- Line 324: `if (verbose) print('  âš ï¸  Failed to extract JSON from analyzer report');`
- Line 327: `if (verbose) print('  âš ï¸  No analyzer report found');`
- Line 332: `print('  âŒ Test analysis failed with exit code $exitCode');`
- Line 333: `failures.add('test_analyzer');`
- Line 337: `print('  âŒ Test analyzer error: $e');`
- Line 338: `failures.add('test_analyzer');`
- Line 343: `Future<String?> findLatestReport(String prefix) async {`
- Line 345: `final reportDir = await ReportUtils.getReportDirectory();`
- Line 350: `String s when s.contains('_coverage') => 'code_coverage',`
- Line 351: `String s when s.contains('_analyzer') => 'analyzer',`
- Line 352: `String s when s.contains('_failed') => 'failed',`
- Line 356: `final searchDir = p.join(reportDir, subdir);`
- Line 357: `final dir = Directory(searchDir);`
- Line 359: `if (verbose) {`
- Line 360: `print('  ğŸ” Looking for reports with prefix: $prefix in $searchDir');`
- Line 363: `if (!await dir.exists()) {`
- Line 364: `if (verbose) print('  âš ï¸  Report directory does not exist: $searchDir');`
- Line 368: `final files = <FileSystemEntity>[];`
- Line 369: `await for (final file in dir.list()) {`
- Line 370: `if (verbose) print('  ğŸ“„ Found file: ${file.path}');`
- Line 371: `if (file is File && file.path.contains(prefix)) {`
- Line 372: `if (verbose) print('  âœ… File matches prefix: ${file.path}');`
- Line 373: `files.add(file);`
- Line 377: `if (files.isEmpty) {`
- Line 378: `if (verbose) print('  âš ï¸  No files found matching prefix: $prefix');`
- Line 383: `files.sort((a, b) {`
- Line 384: `final aStat = (a as File).statSync();`
- Line 385: `final bStat = (b as File).statSync();`
- Line 386: `return bStat.modified.compareTo(aStat.modified);`
- Line 389: `if (verbose) print('  ğŸ“‹ Selected latest report: ${files.first.path}');`
- Line 390: `return files.first.path;`
- Line 392: `if (verbose) print('  âš ï¸  Could not find latest report: $e');`
- Line 397: `Future<void> generateUnifiedReport() async {`
- Line 398: `final report = StringBuffer();`
- Line 399: `final coverage = results['coverage'] as Map<String, dynamic>?;`
- Line 400: `final testAnalysis = results['test_analysis'] as Map<String, dynamic>?;`
- Line 403: `final coverageSummary = coverage?['summary'] as Map<String, dynamic>?;`
- Line 404: `final testSummary = testAnalysis?['summary'] as Map<String, dynamic>?;`
- Line 405: `final overallCoverage = toDouble(coverageSummary?['overall_coverage']);`
- Line 406: `final passRate = toDouble(testSummary?['pass_rate']);`
- Line 407: `final stabilityScore = toDouble(testSummary?['stability_score']);`
- Line 408: `final totalTests = testSummary?['total_tests'] as int? ?? 0;`
- Line 409: `final consistentFailures = testSummary?['consistent_failures'] as int? ?? 0;`
- Line 410: `final flakyTests = testSummary?['flaky_tests'] as int? ?? 0;`
- Line 413: `final healthScore = calculateHealthScore(`
- Line 418: `final healthStatus = getHealthStatus(healthScore);`
- Line 421: `report.writeln('# ğŸ“Š Test Suite Health Dashboard');`
- Line 422: `report.writeln();`
- Line 423: `report.writeln('> **Overall Health:** $healthStatus **${healthScore.toStringA...`
- Line 424: `report.writeln();`
- Line 425: `report.writeln('**Generated:** ${DateTime.now().toLocal()}');`
- Line 426: `report.writeln('**Module:** `$testPath`');`
- Line 427: `report.writeln('**Analysis Runs:** $runs');`
- Line 428: `report.writeln();`
- Line 429: `report.writeln('---');`
- Line 430: `report.writeln();`
- Line 433: `report.writeln('## ğŸ¯ At-a-Glance Summary');`
- Line 434: `report.writeln();`
- Line 435: `report.writeln('| Metric | Value | Status |');`
- Line 436: `report.writeln('|--------|-------|--------|');`
- Line 437: `report.writeln(`
- Line 438: `'| **Test Coverage** | ${overallCoverage?.toStringAsFixed(1) ?? "N/A"}% | ${g...`
- Line 439: `report.writeln(`
- Line 440: `'| **Pass Rate** | ${passRate?.toStringAsFixed(1) ?? "N/A"}% | ${getPassRateS...`
- Line 441: `report.writeln(`
- Line 442: `'| **Stability** | ${stabilityScore?.toStringAsFixed(1) ?? "N/A"}% | ${getSta...`
- Line 443: `report.writeln(`
- Line 444: `'| **Total Tests** | $totalTests | ${totalTests > 0 ? "âœ…" : "âš ï¸"} |');`
- Line 445: `report.writeln(`
- Line 446: `'| **Failures** | $consistentFailures | ${consistentFailures == 0 ? "âœ…" : "âŒ"...`
- Line 447: `report.writeln(`
- Line 448: `'| **Flaky Tests** | $flakyTests | ${flakyTests == 0 ? "âœ…" : "âš ï¸"} |');`
- Line 449: `report.writeln();`
- Line 452: `final insights = generateInsights();`
- Line 454: `.where((i) => i['severity'] == 'ğŸ”´ Critical')`
- Line 455: `.toList();`
- Line 457: `insights.where((i) => i['severity'] == 'ğŸŸ  Warning').toList();`
- Line 459: `if (criticalIssues.isNotEmpty || warnings.isNotEmpty) {`
- Line 460: `report.writeln('## ğŸš¨ Issues Requiring Attention');`
- Line 461: `report.writeln();`
- Line 463: `if (criticalIssues.isNotEmpty) {`
- Line 464: `report.writeln('### ğŸ”´ Critical');`
- Line 465: `report.writeln();`
- Line 466: `for (var i = 0; i < criticalIssues.length; i++) {`
- Line 467: `report.writeln('${i + 1}. ${criticalIssues[i]['message']}');`
- Line 469: `report.writeln();`
- Line 472: `if (warnings.isNotEmpty) {`
- Line 473: `report.writeln('### ğŸŸ  Warnings');`
- Line 474: `report.writeln();`
- Line 475: `for (var i = 0; i < warnings.length; i++) {`
- Line 476: `report.writeln('${i + 1}. ${warnings[i]['message']}');`
- Line 478: `report.writeln();`
- Line 481: `report.writeln('## âœ… All Systems Green');`
- Line 482: `report.writeln();`
- Line 483: `report.writeln('No issues detected. Test suite is healthy!');`
- Line 484: `report.writeln();`
- Line 488: `report.writeln('## âš¡ Quick Actions');`
- Line 489: `report.writeln();`
- Line 490: `final recommendations = generateRecommendations();`
- Line 491: `if (recommendations.isNotEmpty) {`
- Line 492: `for (var i = 0; i < recommendations.length; i++) {`
- Line 493: `report.writeln('${i + 1}. ${recommendations[i]}');`
- Line 495: `report.writeln();`
- Line 497: `report.writeln('âœ… No actions required. Continue maintaining current quality s...`
- Line 498: `report.writeln();`
- Line 502: `report.writeln('## ğŸ“ˆ Detailed Metrics');`
- Line 503: `report.writeln();`
- Line 507: `report.writeln('### Code Coverage');`
- Line 508: `report.writeln();`
- Line 509: `report.writeln('```');`
- Line 510: `report.writeln(`
- Line 511: `'â”œâ”€ Overall:  ${overallCoverage?.toStringAsFixed(1) ?? "N/A"}%');`
- Line 512: `report.writeln('â”œâ”€ Lines:    ${coverageSummary['covered_lines']}/${coverageSu...`
- Line 513: `report.writeln('â”œâ”€ Uncovered: ${coverageSummary['uncovered_lines']} lines');`
- Line 514: `report.writeln('â””â”€ Files:    ${coverageSummary['files_analyzed']} analyzed');`
- Line 515: `report.writeln('```');`
- Line 516: `report.writeln();`
- Line 521: `report.writeln('### Test Reliability');`
- Line 522: `report.writeln();`
- Line 523: `report.writeln('```');`
- Line 524: `report.writeln('â”œâ”€ Total Tests:      $totalTests');`
- Line 525: `report.writeln('â”œâ”€ Pass Rate:        ${passRate?.toStringAsFixed(1) ?? "N/A"}...`
- Line 526: `report.writeln('â”œâ”€ Stability Score:  ${stabilityScore?.toStringAsFixed(1) ?? ...`
- Line 527: `report.writeln('â”œâ”€ Passed:           ${testSummary['passed_consistently']}');`
- Line 528: `report.writeln('â”œâ”€ Failed:           $consistentFailures');`
- Line 529: `report.writeln('â””â”€ Flaky:            $flakyTests');`
- Line 530: `report.writeln('```');`
- Line 531: `report.writeln();`
- Line 535: `report.writeln('## ğŸ“‘ Detailed Reports');`
- Line 536: `report.writeln();`
- Line 537: `report.writeln('For in-depth analysis, see specialized reports:');`
- Line 538: `report.writeln();`
- Line 541: `if (reportPaths.containsKey('analyzer')) {`
- Line 542: `final analyzerFile = p.basename(reportPaths['analyzer']!);`
- Line 543: `report.writeln('- ğŸ“Š **[Test Reliability Analysis](../analyzer/$analyzerFile)...`
- Line 545: `report.writeln('- ğŸ“Š **Test Reliability Analysis** - âš ï¸ Not available');`
- Line 548: `if (reportPaths.containsKey('failed')) {`
- Line 549: `final failedFile = p.basename(reportPaths['failed']!);`
- Line 550: `report.writeln('- ğŸ”´ **[Failed Tests Report](../failed/$failedFile)** - Failu...`
- Line 551: `} else if (flakyTests > 0 || consistentFailures > 0) {`
- Line 552: `report.writeln('- ğŸ”´ **Failed Tests Report** - âš ï¸ Not generated (check logs)');`
- Line 555: `if (reportPaths.containsKey('coverage')) {`
- Line 556: `final coverageFile = p.basename(reportPaths['coverage']!);`
- Line 557: `report.writeln('- ğŸ“ˆ **[Coverage Analysis](../code_coverage/$coverageFile)** ...`
- Line 559: `report.writeln('- ğŸ“ˆ **Coverage Analysis** - âš ï¸ Not available');`
- Line 561: `report.writeln();`
- Line 564: `report.writeln('---');`
- Line 565: `report.writeln();`
- Line 566: `report.writeln('### ğŸ”§ Execution Details');`
- Line 567: `report.writeln();`
- Line 568: `report.writeln('| Tool | Status |');`
- Line 569: `report.writeln('|------|--------|');`
- Line 570: `report.writeln(`
- Line 571: `'| Coverage Analysis | ${failures.contains("coverage_tool") ? "âŒ Failed" : "âœ…...`
- Line 572: `report.writeln(`
- Line 573: `'| Test Reliability Analysis | ${failures.contains("test_analyzer") ? "âŒ Fail...`
- Line 574: `report.writeln();`
- Line 575: `report.writeln('*Generated by Unified Test Analysis Orchestrator*');`
- Line 576: `report.writeln();`
- Line 579: `report.writeln('---');`
- Line 580: `report.writeln(`
- Line 585: `final now = DateTime.now();`
- Line 586: `final timestamp =`
- Line 587: `'${now.hour.toString().padLeft(2, '0')}${now.minute.toString().padLeft(2, '0'...`
- Line 588: `'${now.day.toString().padLeft(2, '0')}${now.month.toString().padLeft(2, '0')}...`
- Line 590: `final moduleName = extractModuleName();`
- Line 591: `final reportPath = await ReportUtils.writeUnifiedReport(`
- Line 594: `markdownContent: report.toString(),`
- Line 595: `jsonData: {`
- Line 596: `'metadata': {`
- Line 599: `'generated': now.toIso8601String(),`
- Line 600: `'test_path': testPath,`
- Line 607: `'tool_status': {`
- Line 608: `'coverage_tool': !failures.contains('coverage_tool'),`
- Line 609: `'test_analyzer': !failures.contains('test_analyzer'),`
- Line 616: `print('  âœ… Unified report saved to: $reportPath');`
- Line 619: `final analysisData = results['test_analysis'] as Map<String, dynamic>?;`
- Line 620: `final analysisSummary = analysisData?['summary'] as Map<String, dynamic>?;`
- Line 621: `final numConsistentFailures = analysisSummary?['consistent_failures'] as int?...`
- Line 622: `final numFlakyTests = analysisSummary?['flaky_tests'] as int? ?? 0;`
- Line 623: `final hasFailures = numConsistentFailures > 0 || numFlakyTests > 0;`
- Line 627: `await generateFailedReport(results, moduleName, timestamp);`
- Line 630: `if (verbose) print('\nğŸ§¹ No failures - cleaning up old failed reports...');`
- Line 631: `await ReportUtils.cleanOldReports(`
- Line 633: `prefixPatterns: ['test_report_failed'],`
- Line 634: `verbose: verbose,`
- Line 639: `final reportDir = await ReportUtils.getReportDirectory();`
- Line 640: `final failedDir = Directory(p.join(reportDir, 'failed'));`
- Line 641: `if (await failedDir.exists()) {`
- Line 642: `final isEmpty = await failedDir.list().isEmpty;`
- Line 644: `await failedDir.delete();`
- Line 645: `if (verbose) print('  ğŸ—‘ï¸  Removed empty failed directory');`
- Line 651: `if (verbose) print('\nğŸ§¹ Cleaning up old reports...');`
- Line 652: `await ReportUtils.cleanOldReports(`
- Line 654: `prefixPatterns: ['test_report_coverage', 'test_report_analyzer', 'test_report...`
- Line 655: `verbose: verbose,`
- Line 657: `if (verbose) print('  âœ… Cleanup complete');`
- Line 659: `print('  âš ï¸  Could not save unified report: $e');`
- Line 663: `Future<void> generateFailedReport(`
- Line 668: `final testAnalysis = results['test_analysis'] as Map<String, dynamic>?;`
- Line 671: `final summary = testAnalysis['summary'] as Map<String, dynamic>?;`
- Line 674: `final consistentFailures = summary['consistent_failures'] as int? ?? 0;`
- Line 675: `final flakyTests = summary['flaky_tests'] as int? ?? 0;`
- Line 678: `if (consistentFailures == 0 && flakyTests == 0) return;`
- Line 680: `print('\nğŸ“ Generating failed test report...');`
- Line 682: `final markdown = StringBuffer();`
- Line 683: `markdown.writeln('# ğŸ”´ Failed Test Report');`
- Line 684: `markdown.writeln();`
- Line 685: `markdown.writeln('**Generated:** ${DateTime.now().toLocal()}');`
- Line 686: `markdown.writeln('**Test Path:** `$testPath`');`
- Line 687: `markdown.writeln('**Source:** Unified Test Analysis Orchestrator');`
- Line 688: `markdown.writeln();`
- Line 690: `markdown.writeln('## ğŸ“Š Summary');`
- Line 691: `markdown.writeln();`
- Line 692: `markdown.writeln('| Metric | Value |');`
- Line 693: `markdown.writeln('|--------|-------|');`
- Line 694: `markdown.writeln(`
- Line 695: `'| Total Tests | ${summary['total_tests'] ?? 'N/A'} |');`
- Line 696: `markdown.writeln(`
- Line 697: `'| Passed Consistently | ${summary['passed_consistently'] ?? 'N/A'} |');`
- Line 699: `.writeln('| Consistent Failures | âŒ $consistentFailures |');`
- Line 700: `markdown.writeln('| Flaky Tests | âš ï¸ $flakyTests |');`
- Line 701: `final passRate = summary['pass_rate'] as num?;`
- Line 702: `markdown.writeln(`
- Line 703: `'| Pass Rate | ${passRate?.toStringAsFixed(1) ?? 'N/A'}% |');`
- Line 704: `markdown.writeln();`
- Line 707: `if (consistentFailures > 0) {`
- Line 708: `markdown.writeln('## âŒ Consistent Failures');`
- Line 709: `markdown.writeln('*Tests that failed all runs*');`
- Line 710: `markdown.writeln();`
- Line 713: `testAnalysis['consistent_failures'] as List<dynamic>?;`
- Line 714: `if (failures != null && failures.isNotEmpty) {`
- Line 715: `for (final failure in failures) {`
- Line 717: `final testName = failureMap['test_name'] ?? 'Unknown';`
- Line 718: `final file = failureMap['file'] ?? 'Unknown';`
- Line 719: `final failureType = failureMap['failure_type'] ?? 'Unknown';`
- Line 720: `final category = failureMap['category'] ?? '';`
- Line 721: `final suggestion = failureMap['suggestion'] ?? '';`
- Line 723: `markdown.writeln('### $testName');`
- Line 724: `markdown.writeln('**File:** `$file`');`
- Line 725: `markdown.writeln('**Type:** $failureType');`
- Line 726: `if (category is String && category.isNotEmpty) {`
- Line 727: `markdown.writeln('**Category:** $category');`
- Line 729: `if (suggestion is String && suggestion.isNotEmpty) {`
- Line 730: `markdown.writeln();`
- Line 731: `markdown.writeln('**Suggested Fix:**');`
- Line 732: `markdown.writeln('```');`
- Line 733: `markdown.writeln(suggestion);`
- Line 734: `markdown.writeln('```');`
- Line 736: `markdown.writeln();`
- Line 742: `if (flakyTests > 0) {`
- Line 743: `markdown.writeln('## âš¡ Flaky Tests');`
- Line 744: `markdown.writeln('*Tests with intermittent failures*');`
- Line 745: `markdown.writeln();`
- Line 747: `final flaky = testAnalysis['flaky_tests'] as List<dynamic>?;`
- Line 748: `if (flaky != null && flaky.isNotEmpty) {`
- Line 749: `for (final test in flaky) {`
- Line 751: `final testName = testMap['test_name'] ?? 'Unknown';`
- Line 752: `final file = testMap['file'] ?? 'Unknown';`
- Line 753: `final successRate = testMap['success_rate'] as num?;`
- Line 754: `final runs = testMap['runs'] as Map<String, dynamic>?;`
- Line 756: `markdown.writeln('### $testName');`
- Line 757: `markdown.writeln('**File:** `$file`');`
- Line 759: `markdown.writeln(`
- Line 760: `'**Success Rate:** ${successRate.toStringAsFixed(1)}%');`
- Line 763: `if (runs != null && runs.isNotEmpty) {`
- Line 764: `markdown.writeln('**Run Results:**');`
- Line 765: `for (final entry in runs.entries) {`
- Line 766: `final status = entry.value == true ? 'âœ…' : 'âŒ';`
- Line 767: `markdown.writeln('- ${entry.key}: $status');`
- Line 770: `markdown.writeln();`
- Line 776: `markdown.writeln('## ğŸ’¡ Recommendations');`
- Line 777: `markdown.writeln();`
- Line 778: `if (consistentFailures > 0) {`
- Line 779: `markdown.writeln(`
- Line 780: `'1. **ğŸ”´ Critical:** Fix $consistentFailures consistently failing tests immed...`
- Line 782: `if (flakyTests > 0) {`
- Line 783: `markdown.writeln(`
- Line 784: `'${consistentFailures > 0 ? '2' : '1'}. **âš ï¸ Important:** Investigate and sta...`
- Line 786: `markdown.writeln();`
- Line 787: `markdown.writeln(`
- Line 791: `final jsonData = {`
- Line 792: `'metadata': {`
- Line 795: `'generated': DateTime.now().toIso8601String(),`
- Line 796: `'test_path': testPath,`
- Line 799: `'summary': {`
- Line 800: `'totalTests': summary['total_tests'] ?? 0,`
- Line 801: `'passedConsistently': summary['passed_consistently'] ?? 0,`
- Line 804: `'passRate': summary['pass_rate'] ?? 0.0,`
- Line 806: `'consistent_failures': testAnalysis['consistent_failures'] ?? <dynamic>[],`
- Line 807: `'flaky_tests': testAnalysis['flaky_tests'] ?? <dynamic>[],`
- Line 811: `final failedReportPath = await ReportUtils.writeUnifiedReport(`
- Line 814: `markdownContent: markdown.toString(),`
- Line 817: `verbose: verbose,`
- Line 820: `reportPaths['failed'] = failedReportPath;`
- Line 821: `print('  âœ… Failed test report saved to: $failedReportPath');`
- Line 823: `print('  âš ï¸  Could not save failed report: $e');`
- Line 827: `List<Map<String, String>> generateInsights() {`
- Line 828: `final insights = <Map<String, String>>[];`
- Line 831: `final coverage = results['coverage'] as Map<String, dynamic>?;`
- Line 833: `final summary = coverage['summary'] as Map<String, dynamic>?;`
- Line 835: `final overallCoverage = toDouble(summary['overall_coverage']);`
- Line 836: `if (overallCoverage != null && overallCoverage < 80) {`
- Line 837: `insights.add({`
- Line 840: `'Coverage is ${overallCoverage.toStringAsFixed(1)}% - below 80% threshold',`
- Line 842: `} else if (overallCoverage != null && overallCoverage < 90) {`
- Line 843: `insights.add({`
- Line 846: `'Coverage is ${overallCoverage.toStringAsFixed(1)}% - could be improved',`
- Line 853: `final testAnalysis = results['test_analysis'] as Map<String, dynamic>?;`
- Line 855: `final summary = testAnalysis['summary'] as Map<String, dynamic>?;`
- Line 857: `final failures = summary['consistent_failures'] as int?;`
- Line 858: `if (failures != null && failures > 0) {`
- Line 859: `insights.add({`
- Line 862: `'$failures tests failing consistently - requires immediate attention',`
- Line 866: `final flakyTests = summary['flaky_tests'] as int?;`
- Line 867: `if (flakyTests != null && flakyTests > 0) {`
- Line 868: `insights.add({`
- Line 871: `'$flakyTests flaky tests detected - investigate test isolation',`
- Line 875: `final passRate = toDouble(summary['pass_rate']);`
- Line 876: `if (passRate != null && passRate < 95) {`
- Line 877: `insights.add({`
- Line 880: `'Pass rate is ${passRate.toStringAsFixed(1)}% - aim for 95%+ for production',`
- Line 889: `List<String> generateRecommendations() {`
- Line 890: `final recommendations = <String>[];`
- Line 893: `final coverage = results['coverage'] as Map<String, dynamic>?;`
- Line 895: `final summary = coverage['summary'] as Map<String, dynamic>?;`
- Line 897: `final overallCoverage = toDouble(summary['overall_coverage']);`
- Line 898: `if (overallCoverage != null && overallCoverage < 80) {`
- Line 899: `recommendations.add(`
- Line 907: `final testAnalysis = results['test_analysis'] as Map<String, dynamic>?;`
- Line 909: `final summary = testAnalysis['summary'] as Map<String, dynamic>?;`
- Line 911: `final failures = summary['consistent_failures'] as int?;`
- Line 912: `if (failures != null && failures > 0) {`
- Line 913: `recommendations.add(`
- Line 918: `final flakyTests = summary['flaky_tests'] as int?;`
- Line 919: `if (flakyTests != null && flakyTests > 0) {`
- Line 920: `recommendations.add(`
- Line 928: `if (recommendations.isEmpty) {`
- Line 929: `recommendations.add(`
- Line 937: `void printHeader() {`
- Line 938: `print('\n${"â•" * 70}');`
- Line 939: `print('   UNIFIED TEST ANALYSIS ORCHESTRATOR');`
- Line 940: `print('${"â•" * 70}\n');`
- Line 941: `print('ğŸ“ Test Path: $testPath');`
- Line 942: `print('ğŸ”„ Analysis Runs: $runs');`
- Line 943: `print('âš¡ Performance: ${performance ? "Enabled" : "Disabled"}');`
- Line 944: `print('ğŸ”Š Verbose: ${verbose ? "Enabled" : "Disabled"}');`
- Line 945: `print('');`
- Line 948: `void printSummary({required bool coverageSuccess, required bool analyzerSucce...`
- Line 949: `print('\n${"â•" * 70}');`
- Line 950: `print('   SUMMARY');`
- Line 951: `print('${"â•" * 70}\n');`
- Line 954: `print('âœ… All tools completed successfully!');`
- Line 956: `print('âš ï¸  Some tools encountered issues:');`
- Line 957: `if (!coverageSuccess) print('  - Coverage Tool: Failed');`
- Line 958: `if (!analyzerSuccess) print('  - Test Analyzer: Failed');`
- Line 961: `print('\nğŸ“Š Results:');`
- Line 962: `print('  - Tools run: 2');`
- Line 963: `print('  - Tools succeeded: ${coverageSuccess && analyzerSuccess ? 2 : 1}');`
- Line 964: `print('  - Tools failed: ${failures.length}');`
- Line 966: `print('\nğŸ“ Reports saved to: test_analyzer_reports/');`
- Line 967: `print('');`

</details>

### ğŸ“„ `test_analyzer_lib.dart`

**Uncovered line numbers:**
```
126-127, 131, 134-135, 139, 142, 145-146, 150-151, 155-156, 160, 163-164, 168-169, 173, 175-177, 179, 183, 185-187, 189-190, 192, 195-197, 201-202, 204, 206, 208, 211-215, 221, 226-228, 231-233, 237-238, 240, 242, 245-246, 251-252, 258, 262-263, 266-267, 271-275, 277, 280, 283-284, 287-290, 292, 294-295, 298, 301, 303-304, 306-308, 317-318, 322, 328, 330-331, 333-334, 337-338, 340, 343, 352, 354-356, 362-366, 371-373, 376-379, 382-383, 385, 393, 396-397, 399, 401, 405-407, 409-410, 413, 415-416, 419, 421, 423, 426, 429-430, 434-435, 442-444, 446, 449-451, 454, 457, 460, 465-467, 469, 472-474, 477, 480-484, 490-491, 498, 504-505, 507-508, 512, 514, 520, 523, 525, 529, 534, 537, 539, 543, 548, 557, 560-561, 565, 567, 569, 571-574, 576, 582, 585, 588, 591, 599-600, 603-604, 606-608, 611, 613-617, 619, 624-625, 627-628, 630, 633, 638-643, 646-648, 652-654, 656-657, 663-664, 667-671, 674-676, 679, 683, 685-688, 693-696, 703-708, 710-711, 714-715, 718-719, 722-723, 727, 732, 735-738, 740-741, 744-749, 754-759, 761-762, 764-766, 768-769, 771-772, 774-775, 778, 780, 782, 785, 787, 789, 792-793, 796-797, 805, 812-814, 816, 818-822, 824, 828-835, 837, 842-844, 846-853, 856, 860-862, 864, 867-869, 871-873, 875, 877, 880-881, 884, 887-892, 894-901, 905-906, 910-912, 915, 918-923, 925-926, 930-933, 935, 940-945, 947-954, 956, 960-961, 965-967, 970, 974-978, 980-982, 985-987, 989-993, 995-996, 999, 1003-1005, 1007-1009, 1013, 1015-1018, 1020-1025, 1027-1028, 1030-1031, 1033-1034, 1036-1037, 1039, 1041-1044, 1047-1052, 1054, 1058-1059, 1061, 1063, 1067-1069, 1071-1073, 1076-1079, 1081, 1083, 1085-1091, 1093-1094, 1096-1097, 1099, 1101-1105, 1107-1111, 1113, 1115, 1119-1120, 1123, 1126-1127, 1130, 1135-1136, 1138, 1141-1143, 1147-1149, 1153-1159, 1165-1167, 1172-1174, 1178-1180, 1182-1184, 1186, 1190-1193, 1195-1197, 1199-1203, 1206-1208, 1215-1218, 1221, 1224-1225, 1228-1230, 1232, 1235-1236, 1241, 1247-1251, 1253-1257, 1260-1269, 1271-1272, 1274-1275, 1279-1281, 1285-1289, 1292, 1294, 1297-1309, 1311, 1316-1319, 1321-1323, 1325, 1327-1333, 1335, 1340-1344, 1347-1349, 1355, 1358, 1364, 1367-1368, 1371-1373, 1378, 1383, 1385-1392, 1394-1403, 1406-1409, 1411-1415, 1417-1418, 1421-1428, 1431, 1436-1439, 1441-1447, 1449-1452, 1454-1456, 1458, 1463-1466, 1468-1469, 1471-1472, 1475-1476, 1479-1481, 1483-1485, 1489, 1492, 1495, 1498, 1500, 1504-1507, 1510-1512, 1514-1516, 1518-1520, 1522-1523, 1525, 1527-1528, 1530, 1532-1533, 1535, 1537, 1540-1542, 1545-1547, 1551-1552, 1554-1557, 1559-1560, 1563-1566, 1569-1571, 1576-1579, 1585-1587, 1591, 1594-1595, 1597-1598, 1600-1603, 1605-1607, 1609-1612, 1616-1618, 1622-1624, 1628, 1631-1632, 1634-1635, 1638-1640, 1644-1645, 1647-1650, 1652-1653, 1655, 1658, 1661-1663, 1666-1668, 1671-1676, 1678, 1680, 1684-1687, 1694, 1696, 1698-1700, 1702, 1705-1706, 1708-1709, 1712, 1714-1716, 1718-1719, 1723-1726, 1730, 1733-1735, 1742, 1749-1751, 1754, 1756-1760, 1762, 1766, 1768-1773, 1775, 1780-1782, 1784-1791, 1794, 1798-1800, 1802, 1807, 1809, 1811, 1813-1814, 1816, 1818, 1820, 1824-1825, 1829, 1832-1834, 1836, 1839-1841, 1845-1847, 1853-1855, 1861-1863, 1869-1875, 1881, 1883-1886, 1889-1890, 1894-1895, 1899, 1901-1902, 1904-1905, 1907-1908, 1911, 1914-1917, 1922-1923, 1925, 1927-1929, 1931, 1935-1940, 1944, 1948-1953, 1958-1962, 1967-1973, 1979, 1982, 1984, 1986-1989, 1993, 1995-1996, 1998-2000, 2004, 2007-2009, 2017-2019, 2023, 2031, 2033-2034, 2036-2037, 2039, 2042, 2045-2052, 2056, 2058-2060, 2063-2064, 2071-2072, 2075-2077, 2083-2086, 2091-2092, 2095-2100, 2102-2103, 2107-2109, 2115-2116, 2119-2120, 2122-2123, 2127-2130, 2136-2138, 2141-2143, 2146-2147, 2150-2152, 2157-2159, 2162-2167, 2170, 2173, 2175, 2179-2181, 2183, 2188-2189, 2191-2193, 2195-2196, 2199-2200, 2202-2205, 2207-2211, 2217, 2219-2223, 2228-2232, 2234, 2236-2239, 2243-2244, 2247-2250, 2252, 2254-2255, 2258-2260, 2264, 2266-2267, 2271-2273, 2280, 2282-2283, 2285-2288, 2292, 2320-2321, 2323-2326, 2328, 2332, 2336, 2338, 2340-2341, 2344, 2352, 2358-2359, 2361, 2363-2366, 2368, 2371-2375, 2378-2380, 2385-2387, 2391-2394, 2399-2401, 2405-2408, 2411-2413, 2419, 2434, 2439-2441, 2444-2446, 2449-2450, 2452, 2456, 2467, 2482, 2490, 2492, 2494, 2496, 2498, 2500-2501, 2517, 2530, 2532-2539, 2541-2543, 2547-2549, 2555-2557, 2563-2565, 2570, 2575, 2577, 2594, 2597-2598
```

<details>
<summary>Click to see uncovered code snippets</summary>

- Line 126: `Future<void> run() async {`
- Line 127: `_printHeader();`
- Line 131: `final testFiles = await _discoverTestFiles();`
- Line 134: `if (dependencyAnalysis) {`
- Line 135: `await _analyzeTestDependencies(testFiles);`
- Line 139: `await _runTestsMultipleTimes(testFiles);`
- Line 142: `_analyzeFailures();`
- Line 145: `if (performanceMode) {`
- Line 146: `_analyzePerformance();`
- Line 150: `if (mutationTesting) {`
- Line 151: `await _runMutationTesting(testFiles);`
- Line 155: `if (impactAnalysis) {`
- Line 156: `await _analyzeTestImpact(testFiles);`
- Line 160: `await _generateReport();`
- Line 163: `if (interactive && failures.isNotEmpty) {`
- Line 164: `await _enterInteractiveMode();`
- Line 168: `if (watch) {`
- Line 169: `await _enterWatchMode();`
- Line 173: `exit(consistentFailures.isEmpty ? 0 : 1);`
- Line 175: `print('${red}Error: $e$reset');`
- Line 176: `if (verbose) {`
- Line 177: `print('$gray$stackTrace$reset');`
- Line 179: `exit(2);`
- Line 183: `void _printHeader() {`
- Line 185: `print('$blue${"â•" * width}$reset');`
- Line 186: `print(`
- Line 187: `'$blue$bold${_center("Flutter/Dart Test Analyzer", width)}$reset',`
- Line 189: `print(`
- Line 190: `'$blue${_center("Advanced Test Debugging & Performance Tool", width)}$reset',`
- Line 192: `print('$blue${"â•" * width}$reset');`
- Line 195: `String _center(String text, int width) {`
- Line 196: `final padding = (width - text.length) ~/ 2;`
- Line 197: `return ' ' * padding + text;`
- Line 201: `Future<List<String>> _discoverTestFiles() async {`
- Line 202: `print('\n$yellowâ–¶ Discovering test files...$reset');`
- Line 204: `final testFiles = <String>[];`
- Line 206: `if (targetFiles.isNotEmpty) {`
- Line 208: `testFiles.addAll(targetFiles);`
- Line 211: `final testDir = Directory('test');`
- Line 212: `if (await testDir.exists()) {`
- Line 213: `await for (final entity in testDir.list(recursive: true)) {`
- Line 214: `if (entity is File && entity.path.endsWith('_test.dart')) {`
- Line 215: `testFiles.add(entity.path);`
- Line 221: `print('  $greenâœ“$reset Found ${testFiles.length} test files');`
- Line 226: `Future<void> _runTestsMultipleTimes(List<String> testFiles) async {`
- Line 227: `print(`
- Line 228: `'\n$yellowâ–¶ Running tests ${runCount}x to identify patterns...$reset',`
- Line 231: `if (parallel) {`
- Line 232: `print(`
- Line 233: `'  ${cyan}Parallel execution enabled with $maxWorkers workers$reset',`
- Line 237: `for (var run = 1; run <= runCount; run++) {`
- Line 238: `print('\n  ${cyan}Run $run of $runCount:$reset');`
- Line 240: `if (parallel) {`
- Line 242: `await _runTestsInParallel(testFiles, run);`
- Line 245: `for (final testFile in testFiles) {`
- Line 246: `await _runSingleTest(testFile, run);`
- Line 251: `if (run < runCount) {`
- Line 252: `await Future<void>.delayed(const Duration(milliseconds: 500));`
- Line 258: `Future<void> _runTestsInParallel(`
- Line 262: `final chunks = <List<String>>[];`
- Line 263: `final chunkSize = (testFiles.length / maxWorkers).ceil();`
- Line 266: `for (var i = 0; i < testFiles.length; i += chunkSize) {`
- Line 267: `chunks.add(testFiles.skip(i).take(chunkSize).toList());`
- Line 271: `final futures = <Future<void>>[];`
- Line 272: `for (final chunk in chunks) {`
- Line 273: `futures.add(() async {`
- Line 274: `for (final testFile in chunk) {`
- Line 275: `await _runSingleTest(testFile, runNumber);`
- Line 277: `}());`
- Line 280: `await Future.wait(futures);`
- Line 283: `Future<void> _runSingleTest(String testFile, int runNumber) async {`
- Line 284: `final stopwatch = Stopwatch()..start();`
- Line 287: `final isFlutterProject = await File('pubspec.yaml').exists() &&`
- Line 288: `await File('pubspec.yaml')`
- Line 289: `.readAsString()`
- Line 290: `.then((content) => content.contains('flutter:'));`
- Line 292: `final result = await Process.run(`
- Line 294: `['test', '--reporter=json', testFile],`
- Line 295: `runInShell: Platform.isWindows,`
- Line 298: `stopwatch.stop();`
- Line 301: `final lines = result.stdout.toString().split('\n');`
- Line 303: `for (final line in lines) {`
- Line 304: `if (line.startsWith('{')) {`
- Line 306: `final json = jsonDecode(line);`
- Line 307: `if (json is Map<String, dynamic>) {`
- Line 308: `_processTestEvent(json, testFile, runNumber, stopwatch.elapsed);`
- Line 317: `if (result.stderr.toString().isNotEmpty) {`
- Line 318: `_captureStderrErrors(testFile, result.stderr.toString(), runNumber);`
- Line 322: `void _processTestEvent(`
- Line 328: `final type = json['type'];`
- Line 330: `if (type == 'testStart') {`
- Line 331: `final test = json['test'] as Map<String, dynamic>?;`
- Line 333: `final testName = (test['name'] as String?) ?? '';`
- Line 334: `final testId = test['id'] as int?;`
- Line 337: `if (testName.startsWith('loading ')) {`
- Line 338: `final filePath = testName.substring('loading '.length);`
- Line 340: `loadingEvents[testId] = LoadingEvent(`
- Line 343: `startTime: (json['time'] as int?) ?? 0,`
- Line 352: `_testIdMap[testId] = '$testFile::$testName';`
- Line 354: `testRuns.putIfAbsent(`
- Line 355: `'$testFile::$testName',`
- Line 356: `() => TestRun(`
- Line 362: `} else if (type == 'testDone') {`
- Line 363: `final numericTestId = json['testID'] as int?;`
- Line 364: `final result = json['result'] as String?;`
- Line 365: `final time = (json['time'] as int?) ?? 0;`
- Line 366: `final hidden = (json['hidden'] as bool?) ?? false;`
- Line 371: `loadingEvents.containsKey(numericTestId)) {`
- Line 372: `final loadingEvent = loadingEvents[numericTestId]!;`
- Line 373: `final loadTime = time - loadingEvent.startTime;`
- Line 376: `fileLoadTimes.putIfAbsent(`
- Line 377: `loadingEvent.filePath,`
- Line 378: `() => LoadingPerformance(`
- Line 379: `filePath: loadingEvent.filePath,`
- Line 382: `fileLoadTimes[loadingEvent.filePath]!`
- Line 383: `.addLoadTime(runNumber, loadTime, success: result == 'success');`
- Line 385: `loadingEvents.remove(numericTestId);`
- Line 393: `final testId = numericTestId != null ? _testIdMap[numericTestId] : null;`
- Line 396: `final fallbackId = '$testFile::test_$numericTestId';`
- Line 397: `testRuns.putIfAbsent(`
- Line 399: `() => TestRun(`
- Line 401: `testName: 'Test $numericTestId',`
- Line 405: `final testRun = testRuns[fallbackId]!;`
- Line 406: `testRun.results[runNumber] = result == 'success';`
- Line 407: `testRun.durations[runNumber] = time;`
- Line 409: `if (result != 'success') {`
- Line 410: `_recordFailure(fallbackId, runNumber, json);`
- Line 413: `final testRun = testRuns[testId];`
- Line 415: `testRun.results[runNumber] = result == 'success';`
- Line 416: `testRun.durations[runNumber] = time;`
- Line 419: `performance.putIfAbsent(`
- Line 421: `() => TestPerformance(`
- Line 423: `testName: testRun.testName,`
- Line 426: `performance[testId]!.addDuration(time.toDouble());`
- Line 429: `if (result != 'success') {`
- Line 430: `_recordFailure(testId, runNumber, json);`
- Line 434: `} else if (type == 'error') {`
- Line 435: `_processErrorEvent(json, testFile, runNumber);`
- Line 442: `void _recordFailure(String testId, int runNumber, Map<String, dynamic> json) {`
- Line 443: `final error = json['error'] ?? '';`
- Line 444: `final stackTrace = json['stackTrace'] ?? '';`
- Line 446: `final failure = TestFailure(`
- Line 449: `error: error.toString(),`
- Line 450: `stackTrace: stackTrace.toString(),`
- Line 451: `timestamp: DateTime.now(),`
- Line 454: `failures.putIfAbsent(testId, () => []).add(failure);`
- Line 457: `_detectFailurePattern(failure);`
- Line 460: `void _processErrorEvent(`
- Line 465: `final error = json['error'] ?? '';`
- Line 466: `final stackTrace = json['stackTrace'] ?? '';`
- Line 467: `final testId = json['testID']?.toString() ?? '$testFile::unknown';`
- Line 469: `final failure = TestFailure(`
- Line 472: `error: error.toString(),`
- Line 473: `stackTrace: stackTrace.toString(),`
- Line 474: `timestamp: DateTime.now(),`
- Line 477: `failures.putIfAbsent(testId, () => []).add(failure);`
- Line 480: `void _captureStderrErrors(String testFile, String stderr, int runNumber) {`
- Line 481: `if (verbose) {`
- Line 482: `print('    ${gray}stderr from $testFile (run $runNumber):$reset');`
- Line 483: `print(`
- Line 484: `'    $red${stderr.split('\n').map((l) => '    $l').join('\n')}$reset',`
- Line 490: `void _detectFailurePattern(TestFailure failure) {`
- Line 491: `final error = failure.error.toLowerCase();`
- Line 498: `if (error.contains('assertion') || error.contains('expect')) {`
- Line 504: `RegExp(r'expected[: ]+(.+?)(?:,|$)', caseSensitive: false)`
- Line 505: `.firstMatch(failure.error);`
- Line 507: `RegExp(r'actual[: ]+(.+?)(?:,|$)', caseSensitive: false)`
- Line 508: `.firstMatch(failure.error);`
- Line 512: `'Expected: ${expectedMatch.group(1)?.trim()}\nActual: ${actualMatch.group(1)?...`
- Line 514: `} else if (error.contains('null') || error.contains('nosuchmethoderror')) {`
- Line 520: `RegExp(r"'(\w+)' was called on null").firstMatch(failure.error);`
- Line 523: `'Add null check for ${propertyMatch.group(1)} or ensure proper initialization';`
- Line 525: `} else if (error.contains('timeout')) {`
- Line 529: `} else if (error.contains('rangeError') || error.contains('index')) {`
- Line 534: `final indexMatch = RegExp(r'index[: ]+(\d+)').firstMatch(failure.error);`
- Line 537: `'Check array bounds before accessing index ${indexMatch.group(1)}';`
- Line 539: `} else if (error.contains('type') || error.contains('cast')) {`
- Line 543: `} else if (error.contains('file') || error.contains('io')) {`
- Line 548: `} else if (error.contains('network') || error.contains('socket')) {`
- Line 557: `patterns[failure.testId] = FailurePattern(`
- Line 560: `count: (patterns[failure.testId]?.count ?? 0) + 1,`
- Line 561: `suggestion: suggestion ?? _generateSmartSuggestion(failure),`
- Line 565: `String _generateSmartSuggestion(TestFailure failure) {`
- Line 567: `final lines = failure.stackTrace.split('\n');`
- Line 569: `for (final line in lines) {`
- Line 571: `if (line.contains('.dart:') &&`
- Line 572: `!line.contains('package:') &&`
- Line 573: `!line.contains('dart:')) {`
- Line 574: `final match = RegExp(r'(\w+\.dart):(\d+):(\d+)').firstMatch(line);`
- Line 576: `return 'Check ${match.group(1)} at line ${match.group(2)}';`
- Line 582: `if (failure.error.contains('setState')) {`
- Line 585: `if (failure.error.contains('disposed')) {`
- Line 588: `if (failure.error.contains('future')) {`
- Line 591: `if (failure.error.contains('stream')) {`
- Line 599: `void _analyzeFailures() {`
- Line 600: `print('\n$yellowâ–¶ Analyzing failure patterns...$reset');`
- Line 603: `final testsWithoutResults = <String>[];`
- Line 604: `final setupTeardownHooks = <String>[];`
- Line 606: `for (final entry in testRuns.entries) {`
- Line 607: `final testId = entry.key;`
- Line 608: `final run = entry.value;`
- Line 611: `if (run.results.isEmpty) {`
- Line 613: `if (testId.contains('(setUpAll)') ||`
- Line 614: `testId.contains('(tearDownAll)') ||`
- Line 615: `testId.contains('(setUp)') ||`
- Line 616: `testId.contains('(tearDown)')) {`
- Line 617: `setupTeardownHooks.add(testId);`
- Line 619: `testsWithoutResults.add(testId);`
- Line 624: `testsWithResults++;`
- Line 625: `final failureCount = run.results.values.where((r) => !r).length;`
- Line 627: `if (failureCount > 0) {`
- Line 628: `if (failureCount == runCount) {`
- Line 630: `consistentFailures.add(testId);`
- Line 633: `flakyTests.add(testId);`
- Line 638: `print('  $greenâœ“$reset Analysis complete');`
- Line 639: `print('    â€¢ Tests with results: $testsWithResults/${testRuns.length}');`
- Line 640: `print('    â€¢ Consistent failures: ${consistentFailures.length}');`
- Line 641: `print('    â€¢ Flaky tests: ${flakyTests.length}');`
- Line 642: `print(`
- Line 643: `'    â€¢ Passing tests: ${testsWithResults - consistentFailures.length - flakyT...`
- Line 646: `if (setupTeardownHooks.isNotEmpty) {`
- Line 647: `print(`
- Line 648: `'    $dimâ€¢ Setup/teardown hooks: ${setupTeardownHooks.length}$reset',`
- Line 652: `if (testsWithoutResults.isNotEmpty) {`
- Line 653: `print(`
- Line 654: `'    $yellowâš  ${testsWithoutResults.length} tests had no results recorded:$re...`
- Line 656: `for (final testId in testsWithoutResults) {`
- Line 657: `print('      $dimâ€¢ $testId$reset');`
- Line 663: `void _analyzePerformance() {`
- Line 664: `print('\n$yellowâ–¶ Analyzing test performance...$reset');`
- Line 667: `final slowTests = performance.entries`
- Line 668: `.where((e) => e.value.averageDuration > slowTestThreshold * 1000)`
- Line 669: `.toList()`
- Line 670: `..sort(`
- Line 671: `(a, b) => b.value.averageDuration.compareTo(a.value.averageDuration),`
- Line 674: `if (slowTests.isNotEmpty) {`
- Line 675: `print(`
- Line 676: `'  $yellowâš $reset Found ${slowTests.length} slow tests (>${slowTestThreshold}...`
- Line 679: `print('  $greenâœ“$reset All tests run within performance threshold');`
- Line 683: `if (fileLoadTimes.isNotEmpty) {`
- Line 685: `fileLoadTimes.values.where((p) => p.averageLoadTime > 500).toList();`
- Line 686: `if (slowLoading.isNotEmpty) {`
- Line 687: `print(`
- Line 688: `'  $yellowâš $reset Found ${slowLoading.length} slow-loading test files (>500ms)',`
- Line 693: `fileLoadTimes.values.where((p) => p.hasFailures).toList();`
- Line 694: `if (failedLoading.isNotEmpty) {`
- Line 695: `print(`
- Line 696: `'  $redâœ—$reset ${failedLoading.length} test file(s) had loading failures',`
- Line 703: `Future<void> _generateReport() async {`
- Line 704: `_printReportHeader();`
- Line 705: `_printSummaryStatistics();`
- Line 706: `_printConsistentFailures();`
- Line 707: `_printFlakyTests();`
- Line 708: `_printFailurePatterns();`
- Line 710: `if (performanceMode) {`
- Line 711: `_printPerformanceMetrics();`
- Line 714: `if (generateFixes) {`
- Line 715: `_printSuggestedFixes();`
- Line 718: `_printTestReliabilityMatrix();`
- Line 719: `_printActionableInsights();`
- Line 722: `if (generateReport) {`
- Line 723: `await _saveReportToFile();`
- Line 727: `Future<void> _saveReportToFile() async {`
- Line 732: `final report = StringBuffer();`
- Line 735: `report.writeln('# ğŸ§ª Test Analysis Report');`
- Line 736: `report.writeln('**Generated:** ${DateTime.now().toIso8601String()}');`
- Line 737: `report.writeln(`
- Line 738: `'**Test Path:** `${targetFiles.isNotEmpty ? targetFiles.first : "all tests"}`',`
- Line 740: `report.writeln('**Analysis Runs:** $runCount');`
- Line 741: `report.writeln();`
- Line 744: `final total = testRuns.length;`
- Line 745: `final passed = total - consistentFailures.length - flakyTests.length;`
- Line 746: `final passRate = total > 0 ? (passed / total * 100) : 0.0;`
- Line 747: `final stabilityScore = total > 0`
- Line 748: `? ((total - consistentFailures.length - flakyTests.length * 0.5) /`
- Line 749: `total *`
- Line 754: `report.writeln('## ğŸ“Š Executive Summary');`
- Line 755: `report.writeln();`
- Line 756: `report.writeln('| Metric | Value | Status |');`
- Line 757: `report.writeln('|--------|-------|--------|');`
- Line 758: `report.writeln(`
- Line 759: `'| **Overall Pass Rate** | **${passRate.toStringAsFixed(1)}%** | ${_getStatus...`
- Line 761: `report.writeln(`
- Line 762: `'| **Test Stability** | **${stabilityScore.toStringAsFixed(1)}%** | ${_getSta...`
- Line 764: `report.writeln('| Total Tests | $total | - |');`
- Line 765: `report.writeln(`
- Line 766: `'| Passed Consistently | $passed | ${passed == total ? "âœ…" : passed > total *...`
- Line 768: `report.writeln(`
- Line 769: `'| Consistent Failures | ${consistentFailures.length} | ${consistentFailures....`
- Line 771: `report.writeln(`
- Line 772: `'| Flaky Tests | ${flakyTests.length} | ${flakyTests.isEmpty ? "âœ…" : flakyTes...`
- Line 774: `report.writeln('| Test Runs | $runCount | - |');`
- Line 775: `report.writeln();`
- Line 778: `final healthStatus = passRate >= 95`
- Line 780: `: passRate >= 80`
- Line 782: `: passRate >= 60`
- Line 785: `final healthBadge = passRate >= 95`
- Line 787: `: passRate >= 80`
- Line 789: `: passRate >= 60`
- Line 792: `report.writeln('### Test Suite Health: $healthBadge **$healthStatus**');`
- Line 793: `report.writeln();`
- Line 796: `report.writeln('## ğŸ“ˆ Test Reliability Matrix');`
- Line 797: `report.writeln();`
- Line 805: `final buckets = <String, int>{`
- Line 812: `for (final entry in testRuns.entries) {`
- Line 813: `final testId = entry.key;`
- Line 814: `final run = entry.value;`
- Line 816: `if (run.results.isEmpty) {`
- Line 818: `if (testId.contains('(setUpAll)') ||`
- Line 819: `testId.contains('(tearDownAll)') ||`
- Line 820: `testId.contains('(setUp)') ||`
- Line 821: `testId.contains('(tearDown)')) {`
- Line 822: `setupTeardownHooks++;`
- Line 824: `testsWithoutResults++;`
- Line 828: `testsWithResults++;`
- Line 829: `final successRate = run.results.values.where((r) => r).length / runCount;`
- Line 830: `if (successRate == 1.0) {`
- Line 831: `buckets['100% reliable'] = buckets['100% reliable']! + 1;`
- Line 832: `} else if (successRate >= 0.66) {`
- Line 833: `buckets['66-99% reliable'] = buckets['66-99% reliable']! + 1;`
- Line 834: `} else if (successRate >= 0.33) {`
- Line 835: `buckets['33-65% reliable'] = buckets['33-65% reliable']! + 1;`
- Line 837: `buckets['0-32% reliable'] = buckets['0-32% reliable']! + 1;`
- Line 842: `if (setupTeardownHooks > 0) {`
- Line 843: `report.writeln(`
- Line 844: `'> â„¹ï¸ **Setup/Teardown Hooks:** $setupTeardownHooks lifecycle hooks detected',`
- Line 846: `for (final entry in testRuns.entries) {`
- Line 847: `final testId = entry.key;`
- Line 848: `if (entry.value.results.isEmpty &&`
- Line 849: `(testId.contains('(setUpAll)') ||`
- Line 850: `testId.contains('(tearDownAll)') ||`
- Line 851: `testId.contains('(setUp)') ||`
- Line 852: `testId.contains('(tearDown)'))) {`
- Line 853: `report.writeln('>   â€¢ $testId');`
- Line 856: `report.writeln();`
- Line 860: `if (testsWithoutResults > 0) {`
- Line 861: `report.writeln(`
- Line 862: `'> â„¹ï¸ **Note:** $testsWithoutResults test(s) discovered but no results record...`
- Line 864: `report.writeln();`
- Line 867: `report.writeln('| Reliability Level | Count | Percentage | Visual |');`
- Line 868: `report.writeln('|-------------------|-------|------------|--------|');`
- Line 869: `for (final entry in buckets.entries) {`
- Line 871: `testsWithResults > 0 ? (entry.value / testsWithResults * 100) : 0.0;`
- Line 872: `final bar = _generateBar(percentage, 20);`
- Line 873: `final icon = entry.key.contains('100%')`
- Line 875: `: entry.key.contains('66-99%')`
- Line 877: `: entry.key.contains('33-65%')`
- Line 880: `report.writeln(`
- Line 881: `'| $icon ${entry.key} | ${entry.value} | ${percentage.toStringAsFixed(1)}% | ...`
- Line 884: `report.writeln();`
- Line 887: `if (consistentFailures.isNotEmpty) {`
- Line 888: `report.writeln('## âŒ Consistent Failures');`
- Line 889: `report.writeln('*Tests that failed all $runCount runs*');`
- Line 890: `report.writeln();`
- Line 891: `report.writeln('| Test Name | File | Failure Type | Priority |');`
- Line 892: `report.writeln('|-----------|------|--------------|----------|');`
- Line 894: `for (final testId in consistentFailures.take(20)) {`
- Line 895: `final parts = testId.split('::');`
- Line 896: `final file = _getRelativePath(parts[0]).split('/').last;`
- Line 897: `final test = parts.length > 1 ? parts[1] : 'unknown';`
- Line 898: `final pattern = patterns[testId];`
- Line 899: `final category = pattern?.category ?? 'Unknown';`
- Line 900: `final priority = pattern?.type == FailureType.nullError ||`
- Line 901: `pattern?.type == FailureType.assertion`
- Line 905: `report.writeln(`
- Line 906: `'| `${_truncate(test, 40)}` | `$file` | $category | $priority |',`
- Line 910: `if (consistentFailures.length > 20) {`
- Line 911: `report.writeln(`
- Line 912: `'| ... | *${consistentFailures.length - 20} more failures* | ... | ... |',`
- Line 915: `report.writeln();`
- Line 918: `report.writeln('### ğŸ”§ Fix Suggestions');`
- Line 919: `report.writeln();`
- Line 920: `final suggestions = <String, Set<String>>{};`
- Line 921: `for (final testId in consistentFailures) {`
- Line 922: `final pattern = patterns[testId];`
- Line 923: `if (pattern?.suggestion != null) {`
- Line 925: `.putIfAbsent(pattern!.category, () => {})`
- Line 926: `.add(pattern.suggestion!);`
- Line 930: `for (final entry in suggestions.entries.take(5)) {`
- Line 931: `report.writeln('**${entry.key}:**');`
- Line 932: `for (final suggestion in entry.value.take(3)) {`
- Line 933: `report.writeln('- $suggestion');`
- Line 935: `report.writeln();`
- Line 940: `if (flakyTests.isNotEmpty) {`
- Line 941: `report.writeln('## âš¡ Flaky Tests');`
- Line 942: `report.writeln('*Tests with intermittent failures*');`
- Line 943: `report.writeln();`
- Line 944: `report.writeln('| Test Name | File | Success Rate | Flakiness Level |');`
- Line 945: `report.writeln('|-----------|------|--------------|-----------------|');`
- Line 947: `for (final testId in flakyTests.take(15)) {`
- Line 948: `final parts = testId.split('::');`
- Line 949: `final file = _getRelativePath(parts[0]).split('/').last;`
- Line 950: `final test = parts.length > 1 ? parts[1] : 'unknown';`
- Line 951: `final run = testRuns[testId]!;`
- Line 952: `final successCount = run.results.values.where((r) => r).length;`
- Line 953: `final successRate = successCount / runCount * 100;`
- Line 954: `final flakiness = successRate >= 75`
- Line 956: `: successRate >= 50`
- Line 960: `report.writeln(`
- Line 961: `'| `${_truncate(test, 40)}` | `$file` | ${successRate.toStringAsFixed(0)}% | ...`
- Line 965: `if (flakyTests.length > 15) {`
- Line 966: `report.writeln(`
- Line 967: `'| ... | *${flakyTests.length - 15} more flaky tests* | ... | ... |',`
- Line 970: `report.writeln();`
- Line 974: `if (patterns.isNotEmpty) {`
- Line 975: `report.writeln('## ğŸ” Failure Pattern Analysis');`
- Line 976: `report.writeln();`
- Line 977: `report.writeln('| Pattern Type | Count | Percentage | Visual |');`
- Line 978: `report.writeln('|--------------|-------|------------|--------|');`
- Line 980: `final patternsByType = <FailureType, int>{};`
- Line 981: `for (final pattern in patterns.values) {`
- Line 982: `patternsByType[pattern.type] = (patternsByType[pattern.type] ?? 0) + 1;`
- Line 985: `final totalPatterns = patternsByType.values.fold(0, (a, b) => a + b);`
- Line 986: `final sorted = patternsByType.entries.toList()`
- Line 987: `..sort((a, b) => b.value.compareTo(a.value));`
- Line 989: `for (final entry in sorted) {`
- Line 990: `final typeName = entry.key.toString().split('.').last;`
- Line 991: `final formattedName = typeName[0].toUpperCase() + typeName.substring(1);`
- Line 992: `final percentage = entry.value / totalPatterns * 100;`
- Line 993: `final bar = _generateBar(percentage, 20);`
- Line 995: `report.writeln(`
- Line 996: `'| $formattedName | ${entry.value} | ${percentage.toStringAsFixed(1)}% | $bar...`
- Line 999: `report.writeln();`
- Line 1003: `if (performanceMode && performance.isNotEmpty) {`
- Line 1004: `report.writeln('## â±ï¸ Performance Analysis');`
- Line 1005: `report.writeln();`
- Line 1007: `final sorted = performance.entries.toList()`
- Line 1008: `..sort(`
- Line 1009: `(a, b) => b.value.averageDuration.compareTo(a.value.averageDuration),`
- Line 1013: `performance.values.fold(0.0, (sum, p) => sum + p.totalDuration);`
- Line 1015: `performance.isNotEmpty ? totalTime / performance.length / 1000 : 0.0;`
- Line 1016: `final slowTests = performance.values`
- Line 1017: `.where((p) => p.averageDuration > slowTestThreshold * 1000)`
- Line 1018: `.length;`
- Line 1020: `report.writeln('### Performance Overview');`
- Line 1021: `report.writeln();`
- Line 1022: `report.writeln('| Metric | Value | Status |');`
- Line 1023: `report.writeln('|--------|-------|--------|');`
- Line 1024: `report.writeln(`
- Line 1025: `'| Total Execution Time | ${(totalTime / 1000).toStringAsFixed(2)}s | - |',`
- Line 1027: `report.writeln(`
- Line 1028: `'| Average Test Time | ${avgTestTime.toStringAsFixed(3)}s | ${avgTestTime < 0...`
- Line 1030: `report.writeln(`
- Line 1031: `'| Slow Tests (>${slowTestThreshold}s) | $slowTests | ${slowTests == 0 ? "âœ…" ...`
- Line 1033: `report.writeln(`
- Line 1034: `'| Fastest Test | ${(sorted.last.value.minDuration / 1000).toStringAsFixed(3)...`
- Line 1036: `report.writeln(`
- Line 1037: `'| Slowest Test | ${(sorted.first.value.maxDuration / 1000).toStringAsFixed(3...`
- Line 1039: `report.writeln();`
- Line 1041: `report.writeln('### Top 10 Slowest Tests');`
- Line 1042: `report.writeln();`
- Line 1043: `report.writeln('| # | Test Name | Avg Time | Max Time | Status |');`
- Line 1044: `report.writeln('|---|-----------|----------|----------|--------|');`
- Line 1047: `for (final entry in sorted.take(10)) {`
- Line 1048: `final parts = entry.key.split('::');`
- Line 1049: `final test = parts.length > 1 ? parts[1] : 'unknown';`
- Line 1050: `final avgTime = entry.value.averageDuration / 1000;`
- Line 1051: `final maxTime = entry.value.maxDuration / 1000;`
- Line 1052: `final status = avgTime > slowTestThreshold`
- Line 1054: `: avgTime > slowTestThreshold * 0.5`
- Line 1058: `report.writeln(`
- Line 1059: `'| $rank | `${_truncate(test, 35)}` | ${avgTime.toStringAsFixed(2)}s | ${maxT...`
- Line 1061: `rank++;`
- Line 1063: `report.writeln();`
- Line 1067: `if (fileLoadTimes.isNotEmpty) {`
- Line 1068: `report.writeln('## ğŸ“¦ Test Loading Performance');`
- Line 1069: `report.writeln();`
- Line 1071: `final sortedLoadTimes = fileLoadTimes.entries.toList()`
- Line 1072: `..sort(`
- Line 1073: `(a, b) => b.value.averageLoadTime.compareTo(a.value.averageLoadTime),`
- Line 1076: `final totalLoadTime = fileLoadTimes.values`
- Line 1077: `.map((p) => p.averageLoadTime)`
- Line 1078: `.reduce((a, b) => a + b);`
- Line 1079: `final avgLoadTime = totalLoadTime / fileLoadTimes.length;`
- Line 1081: `fileLoadTimes.values.where((p) => p.averageLoadTime > 500).length;`
- Line 1083: `fileLoadTimes.values.where((p) => p.hasFailures).length;`
- Line 1085: `report.writeln('### Loading Metrics');`
- Line 1086: `report.writeln();`
- Line 1087: `report.writeln('| Metric | Value | Status |');`
- Line 1088: `report.writeln('|--------|-------|--------|');`
- Line 1089: `report.writeln('| Total Files Loaded | ${fileLoadTimes.length} | - |');`
- Line 1090: `report.writeln(`
- Line 1091: `'| Average Load Time | ${avgLoadTime.toStringAsFixed(1)}ms | ${avgLoadTime < ...`
- Line 1093: `report.writeln(`
- Line 1094: `'| Slow Loading (>500ms) | $slowFiles | ${slowFiles == 0 ? "âœ…" : slowFiles < ...`
- Line 1096: `report.writeln(`
- Line 1097: `'| Failed to Load | $failedFiles | ${failedFiles == 0 ? "âœ…" : "âŒ"} |',`
- Line 1099: `report.writeln();`
- Line 1101: `if (sortedLoadTimes.isNotEmpty) {`
- Line 1102: `report.writeln('### File Load Times');`
- Line 1103: `report.writeln();`
- Line 1104: `report.writeln('| File | Avg Load Time | Max Load Time | Status |');`
- Line 1105: `report.writeln('|------|---------------|---------------|--------|');`
- Line 1107: `for (final entry in sortedLoadTimes) {`
- Line 1108: `final fileName = entry.key.split('/').last;`
- Line 1109: `final avgTime = entry.value.averageLoadTime;`
- Line 1110: `final maxTime = entry.value.maxLoadTime;`
- Line 1111: `final status = entry.value.hasFailures`
- Line 1113: `: avgTime > 1000`
- Line 1115: `: avgTime > 500`
- Line 1119: `report.writeln(`
- Line 1120: `'| `${_truncate(fileName, 40)}` | ${avgTime.toStringAsFixed(1)}ms | ${maxTime...`
- Line 1123: `report.writeln();`
- Line 1126: `if (slowFiles > 0 || failedFiles > 0) {`
- Line 1127: `report.writeln(`
- Line 1130: `report.writeln();`
- Line 1135: `report.writeln('## ğŸ’¡ Actionable Insights & Recommendations');`
- Line 1136: `report.writeln();`
- Line 1138: `final insights = <String, String>{};`
- Line 1141: `if (consistentFailures.isNotEmpty) {`
- Line 1142: `insights['ğŸ”´ Critical'] =`
- Line 1143: `'Fix ${consistentFailures.length} consistently failing tests immediately';`
- Line 1147: `if (flakyTests.length > total * 0.1) {`
- Line 1148: `insights['ğŸŸ  Warning'] =`
- Line 1149: `'${(flakyTests.length / total * 100).toStringAsFixed(1)}% of tests are flaky ...`
- Line 1153: `if (performanceMode) {`
- Line 1154: `final slowCount = performance.values`
- Line 1155: `.where((p) => p.averageDuration > slowTestThreshold * 1000)`
- Line 1156: `.length;`
- Line 1157: `if (slowCount > 0) {`
- Line 1158: `insights['â±ï¸ Performance'] =`
- Line 1159: `'$slowCount tests exceed ${slowTestThreshold}s - consider optimization or par...`
- Line 1165: `patterns.values.where((p) => p.type == FailureType.nullError).length;`
- Line 1166: `if (nullErrors > 3) {`
- Line 1167: `insights['ğŸ” Pattern'] =`
- Line 1172: `patterns.values.where((p) => p.type == FailureType.timeout).length;`
- Line 1173: `if (timeouts > 0) {`
- Line 1174: `insights['â° Timeout'] =`
- Line 1178: `if (insights.isNotEmpty) {`
- Line 1179: `report.writeln('### Priority Actions');`
- Line 1180: `report.writeln();`
- Line 1182: `for (final entry in insights.entries) {`
- Line 1183: `report.writeln('$priority. **${entry.key}**: ${entry.value}');`
- Line 1184: `priority++;`
- Line 1186: `report.writeln();`
- Line 1190: `report.writeln('### Best Practices Checklist');`
- Line 1191: `report.writeln();`
- Line 1192: `report.writeln(`
- Line 1193: `'- [ ] All tests pass consistently (${consistentFailures.isEmpty ? "âœ…" : "âŒ"})',`
- Line 1195: `report.writeln('- [ ] No flaky tests (${flakyTests.isEmpty ? "âœ…" : "âŒ"})');`
- Line 1196: `report.writeln(`
- Line 1197: `'- [ ] Tests run in < ${slowTestThreshold}s (${performance.values.where((p) =...`
- Line 1199: `report.writeln('- [ ] Test coverage > 80% (run coverage tool to verify)');`
- Line 1200: `report.writeln('- [ ] Tests are isolated and independent');`
- Line 1201: `report.writeln('- [ ] Error scenarios are tested');`
- Line 1202: `report.writeln('- [ ] Async operations properly handled');`
- Line 1203: `report.writeln();`
- Line 1206: `report.writeln('---');`
- Line 1207: `report.writeln('*Generated by test_analyzer.dart v2.0 - Enhanced Edition*');`
- Line 1208: `report.writeln(`
- Line 1215: `final now = DateTime.now();`
- Line 1216: `final timestamp =`
- Line 1217: `'${now.hour.toString().padLeft(2, '0')}${now.minute.toString().padLeft(2, '0'...`
- Line 1218: `'${now.day.toString().padLeft(2, '0')}${now.month.toString().padLeft(2, '0')}...`
- Line 1221: `final pathName = _extractPathName();`
- Line 1224: `final jsonData = <String, dynamic>{`
- Line 1225: `'metadata': {`
- Line 1228: `'generated': now.toIso8601String(),`
- Line 1229: `'test_path': targetFiles.isNotEmpty ? targetFiles.first : 'all tests',`
- Line 1230: `'analysis_runs': runCount,`
- Line 1232: `'summary': {`
- Line 1235: `'consistent_failures': consistentFailures.length,`
- Line 1236: `'flaky_tests': flakyTests.length,`
- Line 1241: `'reliability_matrix': {`
- Line 1247: `'consistent_failures': consistentFailures`
- Line 1248: `.map((testId) {`
- Line 1249: `final parts = testId.split('::');`
- Line 1250: `final pattern = patterns[testId];`
- Line 1251: `return {`
- Line 1253: `'file': parts[0],`
- Line 1254: `'test_name': parts.length > 1 ? parts[1] : 'unknown',`
- Line 1255: `'failure_type': pattern?.type.toString().split('.').last,`
- Line 1256: `'category': pattern?.category,`
- Line 1257: `'suggestion': pattern?.suggestion,`
- Line 1260: `.toList()`
- Line 1261: `.take(50)`
- Line 1262: `.toList(),`
- Line 1263: `'flaky_tests': flakyTests`
- Line 1264: `.map((testId) {`
- Line 1265: `final parts = testId.split('::');`
- Line 1266: `final run = testRuns[testId]!;`
- Line 1267: `final successCount = run.results.values.where((r) => r).length;`
- Line 1268: `final successRate = successCount / runCount * 100;`
- Line 1269: `return {`
- Line 1271: `'file': parts[0],`
- Line 1272: `'test_name': parts.length > 1 ? parts[1] : 'unknown',`
- Line 1274: `'runs': Map<String, bool>.fromEntries(`
- Line 1275: `run.results.entries.map((e) => MapEntry('run_${e.key}', e.value)),`
- Line 1279: `.toList()`
- Line 1280: `.take(50)`
- Line 1281: `.toList(),`
- Line 1285: `if (performanceMode && performance.isNotEmpty) {`
- Line 1286: `final sorted = performance.entries.toList()`
- Line 1287: `..sort(`
- Line 1288: `(a, b) =>`
- Line 1289: `b.value.averageDuration.compareTo(a.value.averageDuration),`
- Line 1292: `performance.values.fold(0.0, (sum, p) => sum + p.totalDuration);`
- Line 1294: `jsonData['performance'] = {`
- Line 1297: `performance.isNotEmpty ? totalTime / performance.length : 0.0,`
- Line 1298: `'slow_test_threshold_ms': slowTestThreshold * 1000,`
- Line 1299: `'slow_tests_count': performance.values`
- Line 1300: `.where((p) => p.averageDuration > slowTestThreshold * 1000)`
- Line 1301: `.length,`
- Line 1302: `'top_10_slowest': sorted.take(10).map((entry) {`
- Line 1303: `final parts = entry.key.split('::');`
- Line 1304: `return {`
- Line 1305: `'test_id': entry.key,`
- Line 1306: `'test_name': parts.length > 1 ? parts[1] : 'unknown',`
- Line 1307: `'average_duration_ms': entry.value.averageDuration,`
- Line 1308: `'max_duration_ms': entry.value.maxDuration,`
- Line 1309: `'min_duration_ms': entry.value.minDuration,`
- Line 1311: `}).toList(),`
- Line 1316: `if (fileLoadTimes.isNotEmpty) {`
- Line 1317: `final totalLoadTime = fileLoadTimes.values`
- Line 1318: `.map((p) => p.averageLoadTime)`
- Line 1319: `.reduce((a, b) => a + b);`
- Line 1321: `jsonData['loading_performance'] = {`
- Line 1322: `'total_files': fileLoadTimes.length,`
- Line 1323: `'average_load_time_ms': totalLoadTime / fileLoadTimes.length,`
- Line 1325: `fileLoadTimes.values.where((p) => p.averageLoadTime > 500).length,`
- Line 1327: `fileLoadTimes.values.where((p) => p.hasFailures).length,`
- Line 1328: `'files': fileLoadTimes.entries.map((entry) {`
- Line 1329: `return {`
- Line 1330: `'file': entry.key,`
- Line 1331: `'average_load_time_ms': entry.value.averageLoadTime,`
- Line 1332: `'max_load_time_ms': entry.value.maxLoadTime,`
- Line 1333: `'has_failures': entry.value.hasFailures,`
- Line 1335: `}).toList(),`
- Line 1340: `if (patterns.isNotEmpty) {`
- Line 1341: `final patternsByType = <FailureType, int>{};`
- Line 1342: `for (final pattern in patterns.values) {`
- Line 1343: `patternsByType[pattern.type] =`
- Line 1344: `(patternsByType[pattern.type] ?? 0) + 1;`
- Line 1347: `jsonData['failure_patterns'] = Map<String, int>.fromEntries(`
- Line 1348: `patternsByType.entries.map(`
- Line 1349: `(entry) => MapEntry(entry.key.toString().split('.').last, entry.value),`
- Line 1355: `final reportPath = await ReportUtils.writeUnifiedReport(`
- Line 1358: `markdownContent: report.toString(),`
- Line 1364: `print('$greenâœ… Report saved to: $reportPath$reset');`
- Line 1367: `if (consistentFailures.isNotEmpty || flakyTests.isNotEmpty) {`
- Line 1368: `await _saveFailedReport(timestamp, pathName, jsonData);`
- Line 1371: `print('\n$yellowâš ï¸ Could not save report to file: $e$reset');`
- Line 1372: `if (verbose) {`
- Line 1373: `print('  Error details: $stackTrace');`
- Line 1378: `Future<void> _saveFailedReport(`
- Line 1383: `print('$cyanğŸ“ Generating failed test report...$reset');`
- Line 1385: `final markdown = StringBuffer();`
- Line 1386: `markdown.writeln('# ğŸ”´ Failed Test Report');`
- Line 1387: `markdown.writeln();`
- Line 1388: `markdown.writeln('**Generated:** ${DateTime.now().toLocal()}');`
- Line 1389: `markdown.writeln('**Test Path:** `${targetFiles.isNotEmpty ? targetFiles.firs...`
- Line 1390: `markdown.writeln('**Source:** Test Analyzer');`
- Line 1391: `markdown.writeln('**Analysis Runs:** $runCount');`
- Line 1392: `markdown.writeln();`
- Line 1394: `markdown.writeln('## ğŸ“Š Summary');`
- Line 1395: `markdown.writeln();`
- Line 1396: `markdown.writeln('| Metric | Value |');`
- Line 1397: `markdown.writeln('|--------|-------|');`
- Line 1398: `markdown.writeln('| Total Tests | ${testRuns.length} |');`
- Line 1399: `markdown.writeln('| Passed Consistently | ${testRuns.length - consistentFailu...`
- Line 1400: `markdown.writeln('| Consistent Failures | âŒ ${consistentFailures.length} |');`
- Line 1401: `markdown.writeln('| Flaky Tests | âš ï¸ ${flakyTests.length} |');`
- Line 1402: `markdown.writeln('| Pass Rate | ${(testRuns.isNotEmpty ? ((testRuns.length - ...`
- Line 1403: `markdown.writeln();`
- Line 1406: `if (consistentFailures.isNotEmpty) {`
- Line 1407: `markdown.writeln('## âŒ Consistent Failures');`
- Line 1408: `markdown.writeln('*Tests that failed all $runCount runs*');`
- Line 1409: `markdown.writeln();`
- Line 1411: `for (final testId in consistentFailures) {`
- Line 1412: `final parts = testId.split('::');`
- Line 1413: `final fileName = parts.isNotEmpty ? parts[0] : 'Unknown';`
- Line 1414: `final testName = parts.length > 1 ? parts[1] : 'Unknown';`
- Line 1415: `final pattern = patterns[testId];`
- Line 1417: `markdown.writeln('### $testName');`
- Line 1418: `markdown.writeln('**File:** `$fileName`');`
- Line 1421: `markdown.writeln('**Type:** ${pattern.type.toString().split('.').last}');`
- Line 1422: `markdown.writeln('**Category:** ${pattern.category}');`
- Line 1423: `if (pattern.suggestion != null && pattern.suggestion!.isNotEmpty) {`
- Line 1424: `markdown.writeln();`
- Line 1425: `markdown.writeln('**Suggested Fix:**');`
- Line 1426: `markdown.writeln('```');`
- Line 1427: `markdown.writeln(pattern.suggestion);`
- Line 1428: `markdown.writeln('```');`
- Line 1431: `markdown.writeln();`
- Line 1436: `if (flakyTests.isNotEmpty) {`
- Line 1437: `markdown.writeln('## âš¡ Flaky Tests');`
- Line 1438: `markdown.writeln('*Tests with intermittent failures*');`
- Line 1439: `markdown.writeln();`
- Line 1441: `for (final testId in flakyTests) {`
- Line 1442: `final parts = testId.split('::');`
- Line 1443: `final fileName = parts.isNotEmpty ? parts[0] : 'Unknown';`
- Line 1444: `final testName = parts.length > 1 ? parts[1] : 'Unknown';`
- Line 1445: `final run = testRuns[testId]!;`
- Line 1446: `final successCount = run.results.values.where((r) => r).length;`
- Line 1447: `final successRate = successCount / runCount * 100;`
- Line 1449: `markdown.writeln('### $testName');`
- Line 1450: `markdown.writeln('**File:** `$fileName`');`
- Line 1451: `markdown.writeln('**Success Rate:** ${successRate.toStringAsFixed(1)}%');`
- Line 1452: `markdown.writeln('**Run Results:**');`
- Line 1454: `for (final entry in run.results.entries) {`
- Line 1455: `final status = entry.value ? 'âœ…' : 'âŒ';`
- Line 1456: `markdown.writeln('- Run ${entry.key}: $status');`
- Line 1458: `markdown.writeln();`
- Line 1463: `markdown.writeln('## ğŸ’¡ Recommendations');`
- Line 1464: `markdown.writeln();`
- Line 1465: `if (consistentFailures.isNotEmpty) {`
- Line 1466: `markdown.writeln('1. **ğŸ”´ Critical:** Fix ${consistentFailures.length} consis...`
- Line 1468: `if (flakyTests.isNotEmpty) {`
- Line 1469: `markdown.writeln('${consistentFailures.isNotEmpty ? '2' : '1'}. **âš ï¸ Importan...`
- Line 1471: `markdown.writeln();`
- Line 1472: `markdown.writeln('For detailed analysis and stack traces, see the full analyz...`
- Line 1475: `final jsonData = {`
- Line 1476: `'metadata': {`
- Line 1479: `'generated': DateTime.now().toIso8601String(),`
- Line 1480: `'test_path': targetFiles.isNotEmpty ? targetFiles.first : 'all tests',`
- Line 1481: `'analysis_runs': runCount,`
- Line 1483: `'summary': analyzerData['summary'],`
- Line 1484: `'consistent_failures': analyzerData['consistent_failures'],`
- Line 1485: `'flaky_tests': analyzerData['flaky_tests'],`
- Line 1489: `final failedReportPath = await ReportUtils.writeUnifiedReport(`
- Line 1492: `markdownContent: markdown.toString(),`
- Line 1495: `verbose: verbose,`
- Line 1498: `print('$greenâœ… Failed test report saved to: $failedReportPath$reset');`
- Line 1500: `print('$yellowâš ï¸ Could not save failed report: $e$reset');`
- Line 1504: `void _printReportHeader() {`
- Line 1505: `print('\n$green${"â•" * 70}$reset');`
- Line 1506: `print('$green$bold                      TEST ANALYSIS REPORT$reset');`
- Line 1507: `print('$green${"â•" * 70}$reset\n');`
- Line 1510: `void _printSummaryStatistics() {`
- Line 1511: `print('$cyanğŸ“Š Summary Statistics$reset');`
- Line 1512: `print('â”€' * 50);`
- Line 1514: `final total = testRuns.length;`
- Line 1515: `final passed = total - consistentFailures.length - flakyTests.length;`
- Line 1516: `final passRate = total > 0 ? (passed / total * 100) : 0.0;`
- Line 1518: `_printStatRow('Total tests', total.toString());`
- Line 1519: `_printStatRow('Passed consistently', passed.toString(), green);`
- Line 1520: `_printStatRow(`
- Line 1522: `consistentFailures.length.toString(),`
- Line 1523: `consistentFailures.isNotEmpty ? red : green,`
- Line 1525: `_printStatRow(`
- Line 1527: `flakyTests.length.toString(),`
- Line 1528: `flakyTests.isNotEmpty ? yellow : green,`
- Line 1530: `_printStatRow(`
- Line 1532: `'${passRate.toStringAsFixed(1)}%',`
- Line 1533: `_getColorForPercentage(passRate),`
- Line 1535: `_printStatRow('Test runs', runCount.toString());`
- Line 1537: `print('');`
- Line 1540: `void _printStatRow(String label, String value, [String? valueColor]) {`
- Line 1541: `final dots = '.' * (40 - label.length);`
- Line 1542: `print('  $label$gray$dots$reset ${valueColor ?? ''}$value$reset');`
- Line 1545: `void _printConsistentFailures() {`
- Line 1546: `if (consistentFailures.isEmpty) {`
- Line 1547: `print('$greenâœ… No consistent failures found!$reset\n');`
- Line 1551: `print('$redâŒ Consistent Failures (failed all $runCount runs)$reset');`
- Line 1552: `print('â”€' * 70);`
- Line 1554: `for (final testId in consistentFailures.take(10)) {`
- Line 1555: `final parts = testId.split('::');`
- Line 1556: `final file = _getRelativePath(parts[0]);`
- Line 1557: `final test = parts.length > 1 ? parts[1] : 'unknown';`
- Line 1559: `print('\n  $redâ–¸$reset $test');`
- Line 1560: `print('    ${gray}File: $file$reset');`
- Line 1563: `final testFailures = failures[testId] ?? [];`
- Line 1564: `if (testFailures.isNotEmpty) {`
- Line 1565: `final failure = testFailures.first;`
- Line 1566: `final pattern = patterns[testId];`
- Line 1569: `print('    ${yellow}Type:$reset ${pattern.category}');`
- Line 1570: `if (pattern.suggestion != null) {`
- Line 1571: `print('    ${magenta}Fix:$reset ${pattern.suggestion}');`
- Line 1576: `if (verbose) {`
- Line 1577: `final errorLines = failure.error.split('\n').take(3);`
- Line 1578: `for (final line in errorLines) {`
- Line 1579: `print('    $gray$line$reset');`
- Line 1585: `if (consistentFailures.length > 10) {`
- Line 1586: `print(`
- Line 1587: `'\n  $gray... and ${consistentFailures.length - 10} more consistent failures$...`
- Line 1591: `print('');`
- Line 1594: `void _printFlakyTests() {`
- Line 1595: `if (flakyTests.isEmpty) return;`
- Line 1597: `print('$yellowâš¡ Flaky Tests (intermittent failures)$reset');`
- Line 1598: `print('â”€' * 70);`
- Line 1600: `for (final testId in flakyTests.take(10)) {`
- Line 1601: `final parts = testId.split('::');`
- Line 1602: `final file = _getRelativePath(parts[0]);`
- Line 1603: `final test = parts.length > 1 ? parts[1] : 'unknown';`
- Line 1605: `final run = testRuns[testId]!;`
- Line 1606: `final successCount = run.results.values.where((r) => r).length;`
- Line 1607: `final failureCount = runCount - successCount;`
- Line 1609: `print('\n  $yellowâ–¸$reset $test');`
- Line 1610: `print('    ${gray}File: $file$reset');`
- Line 1611: `print(`
- Line 1612: `'    ${gray}Results: $successCount passed, $failureCount failed$reset',`
- Line 1616: `final pattern = patterns[testId];`
- Line 1617: `if (pattern != null && pattern.suggestion != null) {`
- Line 1618: `print('    ${magenta}Hint:$reset ${pattern.suggestion}');`
- Line 1622: `if (flakyTests.length > 10) {`
- Line 1623: `print(`
- Line 1624: `'\n  $gray... and ${flakyTests.length - 10} more flaky tests$reset',`
- Line 1628: `print('');`
- Line 1631: `void _printFailurePatterns() {`
- Line 1632: `if (patterns.isEmpty) return;`
- Line 1634: `print('$cyanğŸ” Failure Patterns$reset');`
- Line 1635: `print('â”€' * 50);`
- Line 1638: `final patternsByType = <FailureType, int>{};`
- Line 1639: `for (final pattern in patterns.values) {`
- Line 1640: `patternsByType[pattern.type] = (patternsByType[pattern.type] ?? 0) + 1;`
- Line 1644: `final sorted = patternsByType.entries.toList()`
- Line 1645: `..sort((a, b) => b.value.compareTo(a.value));`
- Line 1647: `for (final entry in sorted) {`
- Line 1648: `final type = entry.key;`
- Line 1649: `final count = entry.value;`
- Line 1650: `final bar = 'â–ˆ' * (count * 2).clamp(0, 30);`
- Line 1652: `var typeName = type.toString().split('.').last;`
- Line 1653: `typeName = typeName[0].toUpperCase() + typeName.substring(1);`
- Line 1655: `print('  ${typeName.padRight(15)} $cyan$bar$reset $count');`
- Line 1658: `print('');`
- Line 1661: `void _printPerformanceMetrics() {`
- Line 1662: `print('$cyanâ±ï¸ Performance Metrics$reset');`
- Line 1663: `print('â”€' * 50);`
- Line 1666: `final sorted = performance.entries.toList()`
- Line 1667: `..sort(`
- Line 1668: `(a, b) => b.value.averageDuration.compareTo(a.value.averageDuration),`
- Line 1671: `print('\n  ${yellow}Slowest tests:$reset');`
- Line 1672: `for (final entry in sorted.take(5)) {`
- Line 1673: `final parts = entry.key.split('::');`
- Line 1674: `final test = parts.length > 1 ? parts[1] : 'unknown';`
- Line 1675: `final avgTime = entry.value.averageDuration / 1000;`
- Line 1676: `final maxTime = entry.value.maxDuration / 1000;`
- Line 1678: `final color = avgTime > slowTestThreshold`
- Line 1680: `: avgTime > slowTestThreshold * 0.5`
- Line 1684: `print('    $color${avgTime.toStringAsFixed(2)}s$reset $test');`
- Line 1685: `if (verbose) {`
- Line 1686: `print(`
- Line 1687: `'      ${gray}Max: ${maxTime.toStringAsFixed(2)}s, Min: ${(entry.value.minDur...`
- Line 1694: `performance.values.fold(0.0, (sum, p) => sum + p.totalDuration);`
- Line 1696: `performance.isNotEmpty ? totalTime / performance.length / 1000 : 0.0;`
- Line 1698: `print('\n  ${cyan}Overall:$reset');`
- Line 1699: `print('    Total time: ${(totalTime / 1000).toStringAsFixed(2)}s');`
- Line 1700: `print('    Average test time: ${avgTestTime.toStringAsFixed(3)}s');`
- Line 1702: `print('');`
- Line 1705: `void _printSuggestedFixes() {`
- Line 1706: `if (patterns.isEmpty) return;`
- Line 1708: `print('$magentağŸ”§ Suggested Fixes$reset');`
- Line 1709: `print('â”€' * 70);`
- Line 1712: `final suggestionsByType = <String, List<String>>{};`
- Line 1714: `for (final entry in patterns.entries) {`
- Line 1715: `if (entry.value.suggestion != null) {`
- Line 1716: `final category = entry.value.category;`
- Line 1718: `.putIfAbsent(category, () => [])`
- Line 1719: `.add('â€¢ ${entry.value.suggestion}');`
- Line 1723: `for (final entry in suggestionsByType.entries) {`
- Line 1724: `print('\n  $yellow${entry.key}:$reset');`
- Line 1725: `for (final suggestion in entry.value.take(3)) {`
- Line 1726: `print('    $suggestion');`
- Line 1730: `print('');`
- Line 1733: `void _printTestReliabilityMatrix() {`
- Line 1734: `print('$cyanğŸ“ˆ Test Reliability Matrix$reset');`
- Line 1735: `print('â”€' * 50);`
- Line 1742: `final buckets = <String, int>{`
- Line 1749: `for (final entry in testRuns.entries) {`
- Line 1750: `final testId = entry.key;`
- Line 1751: `final run = entry.value;`
- Line 1754: `if (run.results.isEmpty) {`
- Line 1756: `if (testId.contains('(setUpAll)') ||`
- Line 1757: `testId.contains('(tearDownAll)') ||`
- Line 1758: `testId.contains('(setUp)') ||`
- Line 1759: `testId.contains('(tearDown)')) {`
- Line 1760: `setupTeardownHooks++;`
- Line 1762: `testsWithoutResults++;`
- Line 1766: `final successRate = run.results.values.where((r) => r).length / runCount;`
- Line 1768: `if (successRate == 1.0) {`
- Line 1769: `buckets['100% reliable'] = buckets['100% reliable']! + 1;`
- Line 1770: `} else if (successRate >= 0.66) {`
- Line 1771: `buckets['66-99% reliable'] = buckets['66-99% reliable']! + 1;`
- Line 1772: `} else if (successRate >= 0.33) {`
- Line 1773: `buckets['33-65% reliable'] = buckets['33-65% reliable']! + 1;`
- Line 1775: `buckets['0-32% reliable'] = buckets['0-32% reliable']! + 1;`
- Line 1780: `if (setupTeardownHooks > 0) {`
- Line 1781: `print(`
- Line 1782: `'  $dimâ„¹ï¸  $setupTeardownHooks setup/teardown hooks detected$reset',`
- Line 1784: `for (final entry in testRuns.entries) {`
- Line 1785: `final testId = entry.key;`
- Line 1786: `if (entry.value.results.isEmpty &&`
- Line 1787: `(testId.contains('(setUpAll)') ||`
- Line 1788: `testId.contains('(tearDownAll)') ||`
- Line 1789: `testId.contains('(setUp)') ||`
- Line 1790: `testId.contains('(tearDown)'))) {`
- Line 1791: `print('  $dim  â€¢ $testId$reset');`
- Line 1794: `print('');`
- Line 1798: `if (testsWithoutResults > 0) {`
- Line 1799: `print(`
- Line 1800: `'  $dimâ„¹ï¸  $testsWithoutResults test(s) discovered but no results recorded$re...`
- Line 1802: `print('');`
- Line 1807: `buckets.values.isEmpty || buckets.values.every((v) => v == 0)`
- Line 1809: `: buckets.values.reduce(math.max);`
- Line 1811: `for (final entry in buckets.entries) {`
- Line 1813: `maxValue > 0 ? (entry.value / maxValue * 30).round() : 0;`
- Line 1814: `final bar = 'â–ˆ' * barLength;`
- Line 1816: `final color = entry.key.contains('100%')`
- Line 1818: `: entry.key.contains('66-99%')`
- Line 1820: `: entry.key.contains('33-65%')`
- Line 1824: `print(`
- Line 1825: `'  ${entry.key.padRight(15)} $color$bar$reset ${entry.value} tests',`
- Line 1829: `print('');`
- Line 1832: `void _printActionableInsights() {`
- Line 1833: `print('$magentağŸ’¡ Actionable Insights$reset');`
- Line 1834: `print('â”€' * 50);`
- Line 1836: `final insights = <String>[];`
- Line 1839: `if (consistentFailures.isNotEmpty) {`
- Line 1840: `insights.add(`
- Line 1841: `'${red}Critical:$reset Fix ${consistentFailures.length} consistently failing ...`
- Line 1845: `if (flakyTests.length > testRuns.length * 0.1) {`
- Line 1846: `insights.add(`
- Line 1847: `'${yellow}Warning:$reset ${(flakyTests.length / testRuns.length * 100).toStri...`
- Line 1853: `patterns.values.where((p) => p.type == FailureType.nullError).length;`
- Line 1854: `if (nullErrors > 3) {`
- Line 1855: `insights.add(`
- Line 1861: `patterns.values.where((p) => p.type == FailureType.timeout).length;`
- Line 1862: `if (timeouts > 0) {`
- Line 1863: `insights.add(`
- Line 1869: `if (performanceMode) {`
- Line 1870: `final slowCount = performance.values`
- Line 1871: `.where((p) => p.averageDuration > slowTestThreshold * 1000)`
- Line 1872: `.length;`
- Line 1873: `if (slowCount > 0) {`
- Line 1874: `insights.add(`
- Line 1875: `'$slowCount tests exceed ${slowTestThreshold}s - consider optimization or par...`
- Line 1881: `final stabilityScore = testRuns.isEmpty`
- Line 1883: `: ((testRuns.length -`
- Line 1884: `consistentFailures.length -`
- Line 1885: `flakyTests.length * 0.5) /`
- Line 1886: `testRuns.length *`
- Line 1889: `insights.add(`
- Line 1890: `'Overall test stability: ${_getStabilityEmoji(stabilityScore)} ${stabilitySco...`
- Line 1894: `for (final insight in insights) {`
- Line 1895: `print('  â€¢ $insight');`
- Line 1899: `print('\n  ${cyan}Recommendations:$reset');`
- Line 1901: `if (consistentFailures.isNotEmpty) {`
- Line 1902: `print('    1. Focus on fixing consistent failures first');`
- Line 1904: `if (flakyTests.isNotEmpty) {`
- Line 1905: `print('    2. Add retry logic or improve test isolation for flaky tests');`
- Line 1907: `if (patterns.values.any((p) => p.type == FailureType.timeout)) {`
- Line 1908: `print('    3. Review async operations and add proper wait conditions');`
- Line 1911: `print('');`
- Line 1914: `String _getStabilityEmoji(double score) {`
- Line 1915: `if (score >= 95) return 'ğŸŸ¢';`
- Line 1916: `if (score >= 80) return 'ğŸŸ¡';`
- Line 1917: `if (score >= 60) return 'ğŸŸ ';`
- Line 1922: `Future<void> _analyzeTestDependencies(List<String> testFiles) async {`
- Line 1923: `print('\n$yellowâ–¶ Analyzing test dependencies...$reset');`
- Line 1925: `final dependencies = <String, Set<String>>{};`
- Line 1927: `for (final testFile in testFiles) {`
- Line 1928: `final file = File(testFile);`
- Line 1929: `if (!await file.exists()) continue;`
- Line 1931: `final content = await file.readAsString();`
- Line 1935: `final importPattern = RegExp(r'''import\s+['"]([^'"]+)['"];''');`
- Line 1936: `for (final match in importPattern.allMatches(content)) {`
- Line 1937: `final import = match.group(1)!;`
- Line 1938: `if (!import.startsWith('dart:') &&`
- Line 1939: `!import.startsWith('package:flutter/')) {`
- Line 1940: `imports.add(import);`
- Line 1944: `dependencies[testFile] = imports;`
- Line 1948: `print('\n  ${cyan}Test Dependency Graph:$reset');`
- Line 1949: `for (final entry in dependencies.entries) {`
- Line 1950: `final testName = entry.key.split('/').last;`
- Line 1951: `print('    $greenâ–¸$reset $testName');`
- Line 1952: `for (final dep in entry.value) {`
- Line 1953: `print('      $grayâ””â”€$reset $dep');`
- Line 1958: `final circular = _findCircularDependencies(dependencies);`
- Line 1959: `if (circular.isNotEmpty) {`
- Line 1960: `print('\n  $redâš  Circular dependencies detected:$reset');`
- Line 1961: `for (final cycle in circular) {`
- Line 1962: `print('    ${cycle.join(' â†’ ')}');`
- Line 1967: `final isolated = dependencies.entries`
- Line 1968: `.where((e) => e.value.isEmpty)`
- Line 1969: `.map((e) => e.key)`
- Line 1970: `.toList();`
- Line 1971: `if (isolated.isNotEmpty) {`
- Line 1972: `print(`
- Line 1973: `'\n  $greenâœ“ Isolated tests (no dependencies):$reset ${isolated.length}',`
- Line 1979: `List<List<String>> _findCircularDependencies(`
- Line 1982: `final cycles = <List<String>>[];`
- Line 1984: `final recursionStack = <String>[];`
- Line 1986: `void dfs(String node) {`
- Line 1987: `if (recursionStack.contains(node)) {`
- Line 1988: `final cycleStart = recursionStack.indexOf(node);`
- Line 1989: `cycles.add(recursionStack.sublist(cycleStart).toList()..add(node));`
- Line 1993: `if (visited.contains(node)) return;`
- Line 1995: `visited.add(node);`
- Line 1996: `recursionStack.add(node);`
- Line 1998: `for (final dep in dependencies[node] ?? <String>{}) {`
- Line 1999: `if (dependencies.containsKey(dep)) {`
- Line 2000: `dfs(dep);`
- Line 2004: `recursionStack.removeLast();`
- Line 2007: `for (final node in dependencies.keys) {`
- Line 2008: `if (!visited.contains(node)) {`
- Line 2009: `dfs(node);`
- Line 2017: `Future<void> _runMutationTesting(List<String> testFiles) async {`
- Line 2018: `print('\n$yellowâ–¶ Running mutation testing...$reset');`
- Line 2019: `print(`
- Line 2023: `final mutations = <String, int>{`
- Line 2031: `for (final testFile in testFiles) {`
- Line 2033: `.replaceFirst('test/', 'lib/')`
- Line 2034: `.replaceFirst('_test.dart', '.dart');`
- Line 2036: `final source = File(sourceFile);`
- Line 2037: `if (!await source.exists()) continue;`
- Line 2039: `print('\n  ${cyan}Mutating: ${sourceFile.split('/').last}$reset');`
- Line 2042: `final content = await source.readAsString();`
- Line 2045: `mutations['Operator mutations'] = mutations['Operator mutations']! +`
- Line 2046: `RegExp(r'[+\-*/%<>]=?').allMatches(content).length;`
- Line 2047: `mutations['Literal mutations'] = mutations['Literal mutations']! +`
- Line 2048: `RegExp(r'\b\d+\b').allMatches(content).length;`
- Line 2049: `mutations['Statement deletions'] = mutations['Statement deletions']! +`
- Line 2050: `RegExp(';').allMatches(content).length ~/ 2;`
- Line 2051: `mutations['Condition inversions'] = mutations['Condition inversions']! +`
- Line 2052: `RegExp(r'if\s*\(').allMatches(content).length;`
- Line 2056: `print('\n  ${cyan}Mutation Testing Summary:$reset');`
- Line 2058: `for (final entry in mutations.entries) {`
- Line 2059: `print('    ${entry.key}: ${entry.value}');`
- Line 2060: `totalMutations += entry.value;`
- Line 2063: `print('\n  ${yellow}Total potential mutations: $totalMutations$reset');`
- Line 2064: `print(`
- Line 2071: `print(`
- Line 2072: `'\n  ${cyan}Mutation Score: ${_getMutationScoreEmoji(mutationScore)} ${mutati...`
- Line 2075: `if (mutationScore < 80) {`
- Line 2076: `print('  $redâš  Low mutation score indicates weak test coverage$reset');`
- Line 2077: `print(`
- Line 2083: `String _getMutationScoreEmoji(double score) {`
- Line 2084: `if (score >= 90) return 'ğŸŸ¢';`
- Line 2085: `if (score >= 80) return 'ğŸŸ¡';`
- Line 2086: `if (score >= 70) return 'ğŸŸ ';`
- Line 2091: `Future<void> _analyzeTestImpact(List<String> testFiles) async {`
- Line 2092: `print('\n$yellowâ–¶ Analyzing test impact...$reset');`
- Line 2095: `final gitDiff = await Process.run('git', ['diff', '--name-only', 'HEAD~1']);`
- Line 2096: `final changedFiles = gitDiff.stdout`
- Line 2097: `.toString()`
- Line 2098: `.split('\n')`
- Line 2099: `.where((f) => f.isNotEmpty)`
- Line 2100: `.toList();`
- Line 2102: `if (changedFiles.isEmpty) {`
- Line 2103: `print('  $greenâœ“$reset No code changes detected');`
- Line 2107: `print('  ${cyan}Changed files:$reset');`
- Line 2108: `for (final file in changedFiles) {`
- Line 2109: `print('    â€¢ $file');`
- Line 2115: `for (final changedFile in changedFiles) {`
- Line 2116: `if (changedFile.startsWith('lib/')) {`
- Line 2119: `.replaceFirst('lib/', 'test/')`
- Line 2120: `.replaceFirst('.dart', '_test.dart');`
- Line 2122: `if (testFiles.contains(testFile)) {`
- Line 2123: `impactedTests.add(testFile);`
- Line 2127: `for (final testFile in testFiles) {`
- Line 2128: `final content = await File(testFile).readAsString();`
- Line 2129: `if (content.contains(changedFile)) {`
- Line 2130: `impactedTests.add(testFile);`
- Line 2136: `print('\n  ${cyan}Impacted tests (${impactedTests.length}):$reset');`
- Line 2137: `for (final test in impactedTests) {`
- Line 2138: `print('    $greenâ–¸$reset ${test.split('/').last}');`
- Line 2141: `if (impactedTests.isEmpty) {`
- Line 2142: `print('  $yellowâš  No tests found for changed files$reset');`
- Line 2143: `print('  ${dim}Consider adding tests for the modified code$reset');`
- Line 2146: `(impactedTests.length / testFiles.length * 100).toStringAsFixed(1);`
- Line 2147: `print('\n  ${cyan}Impact scope: $percentage% of tests affected$reset');`
- Line 2150: `print('\n  $greenğŸ’¡ Optimization suggestion:$reset');`
- Line 2151: `print('    Run only impacted tests to save time:');`
- Line 2152: `print('    ${dim}dart test ${impactedTests.join(' ')}$reset');`
- Line 2157: `Future<void> _enterInteractiveMode() async {`
- Line 2158: `print('$cyanğŸ” Interactive Debug Mode$reset');`
- Line 2159: `print('Type test number to inspect, "q" to quit\n');`
- Line 2162: `final failedTests = [...consistentFailures, ...flakyTests];`
- Line 2163: `for (var i = 0; i < failedTests.length && i < 20; i++) {`
- Line 2164: `final parts = failedTests[i].split('::');`
- Line 2165: `final test = parts.length > 1 ? parts[1] : 'unknown';`
- Line 2166: `final icon = consistentFailures.contains(failedTests[i]) ? 'âŒ' : 'âš¡';`
- Line 2167: `print('  ${(i + 1).toString().padRight(3)} $icon $test');`
- Line 2170: `print('\n${cyan}Enter choice:$reset ');`
- Line 2173: `final input = stdin.readLineSync()?.trim() ?? '';`
- Line 2175: `if (input.toLowerCase() == 'q') {`
- Line 2179: `final index = int.tryParse(input);`
- Line 2180: `if (index != null && index > 0 && index <= failedTests.length) {`
- Line 2181: `await _inspectTest(failedTests[index - 1]);`
- Line 2183: `print('Invalid choice. Enter test number or "q" to quit:');`
- Line 2188: `Future<void> _inspectTest(String testId) async {`
- Line 2189: `print('\n$cyan${"â”€" * 70}$reset');`
- Line 2191: `final parts = testId.split('::');`
- Line 2192: `final file = parts[0];`
- Line 2193: `final test = parts.length > 1 ? parts[1] : 'unknown';`
- Line 2195: `print('${bold}Test:$reset $test');`
- Line 2196: `print('${bold}File:$reset ${_getRelativePath(file)}');`
- Line 2199: `final testFailures = failures[testId] ?? [];`
- Line 2200: `print('\n${yellow}Failure Details:$reset');`
- Line 2202: `for (var i = 0; i < testFailures.length; i++) {`
- Line 2203: `final failure = testFailures[i];`
- Line 2204: `print('\n  ${cyan}Run ${failure.runNumber}:$reset');`
- Line 2205: `print('  $red${failure.error}$reset');`
- Line 2207: `if (verbose) {`
- Line 2208: `print('\n  ${gray}Stack trace:$reset');`
- Line 2209: `final stackLines = failure.stackTrace.split('\n').take(10);`
- Line 2210: `for (final line in stackLines) {`
- Line 2211: `print('    $gray$line$reset');`
- Line 2217: `final pattern = patterns[testId];`
- Line 2219: `print('\n${yellow}Pattern Analysis:$reset');`
- Line 2220: `print('  Type: ${pattern.category}');`
- Line 2221: `print('  Occurrences: ${pattern.count}');`
- Line 2222: `if (pattern.suggestion != null) {`
- Line 2223: `print('  ${magenta}Suggestion:$reset ${pattern.suggestion}');`
- Line 2228: `print('\n${cyan}Options:$reset');`
- Line 2229: `print('  r - Re-run this test');`
- Line 2230: `print('  v - View test source code');`
- Line 2231: `print('  b - Back to list');`
- Line 2232: `print('Enter choice: ');`
- Line 2234: `final choice = stdin.readLineSync()?.trim() ?? '';`
- Line 2236: `if (choice == 'r') {`
- Line 2237: `await _rerunSingleTest(file, test);`
- Line 2238: `} else if (choice == 'v') {`
- Line 2239: `await _viewTestSource(file, test);`
- Line 2243: `Future<void> _rerunSingleTest(String file, String testName) async {`
- Line 2244: `print('\n${yellow}Re-running test...$reset');`
- Line 2247: `final isFlutterProject = await File('pubspec.yaml').exists() &&`
- Line 2248: `await File('pubspec.yaml')`
- Line 2249: `.readAsString()`
- Line 2250: `.then((content) => content.contains('flutter:'));`
- Line 2252: `final result = await Process.run(`
- Line 2254: `['test', '--name', testName, file],`
- Line 2255: `runInShell: Platform.isWindows,`
- Line 2258: `print(result.stdout);`
- Line 2259: `if (result.stderr.toString().isNotEmpty) {`
- Line 2260: `print('$red${result.stderr}$reset');`
- Line 2264: `Future<void> _viewTestSource(String file, String testName) async {`
- Line 2266: `final content = await File(file).readAsString();`
- Line 2267: `final lines = content.split('\n');`
- Line 2271: `for (var i = 0; i < lines.length; i++) {`
- Line 2272: `if (lines[i].contains("test('$testName'") ||`
- Line 2273: `lines[i].contains('test("$testName"')) {`
- Line 2280: `print('\n${cyan}Test Source:$reset');`
- Line 2282: `final start = (startLine - 2).clamp(0, lines.length);`
- Line 2283: `final end = (startLine + 20).clamp(0, lines.length);`
- Line 2285: `for (var i = start; i < end; i++) {`
- Line 2286: `final lineNum = (i + 1).toString().padLeft(4);`
- Line 2287: `final marker = i == startLine ? '>' : ' ';`
- Line 2288: `print('$gray$lineNum$marker$reset ${lines[i]}');`
- Line 2292: `print('${red}Could not read test source: $e$reset');`
- Line 2320: `String _extractPathName() {`
- Line 2321: `if (targetFiles.isNotEmpty) {`
- Line 2323: `final path = targetFiles.first`
- Line 2324: `.replaceAll(r'\', '/')`
- Line 2325: `.replaceAll(RegExp(r'/$'), ''); // Remove trailing slash`
- Line 2326: `final segments = path.split('/').where((s) => s.isNotEmpty).toList();`
- Line 2328: `if (segments.isEmpty) {`
- Line 2332: `var pathName = segments.last;`
- Line 2336: `if (pathName.endsWith('.dart')) {`
- Line 2338: `pathName = pathName.substring(0, pathName.length - 5);`
- Line 2340: `if (pathName.endsWith('_test')) {`
- Line 2341: `pathName = pathName.substring(0, pathName.length - 5);`
- Line 2344: `} else if (pathName == 'test') {`
- Line 2352: `return '$pathName$suffix';`
- Line 2358: `Future<void> _enterWatchMode() async {`
- Line 2359: `print('$cyanğŸ‘ï¸ Watch mode enabled. Press Ctrl+C to exit.$reset\n');`
- Line 2361: `final watcher = Directory('test').watch(recursive: true);`
- Line 2363: `await for (final event in watcher) {`
- Line 2364: `if (event.path.endsWith('_test.dart')) {`
- Line 2365: `print(`
- Line 2366: `'$yellowğŸ“ Test file changed: ${_getRelativePath(event.path)}$reset',`
- Line 2368: `print('${yellow}Re-running analysis...$reset\n');`
- Line 2371: `testRuns.clear();`
- Line 2372: `failures.clear();`
- Line 2373: `patterns.clear();`
- Line 2374: `flakyTests.clear();`
- Line 2375: `consistentFailures.clear();`
- Line 2378: `await _runTestsMultipleTimes([event.path]);`
- Line 2379: `_analyzeFailures();`
- Line 2380: `await _generateReport();`
- Line 2385: `String _getColorForPercentage(double percentage) {`
- Line 2386: `if (percentage >= 90) return green;`
- Line 2387: `if (percentage >= 70) return yellow;`
- Line 2391: `String _getRelativePath(String fullPath) {`
- Line 2392: `final cwd = Directory.current.path;`
- Line 2393: `if (fullPath.startsWith(cwd)) {`
- Line 2394: `return fullPath.substring(cwd.length + 1);`
- Line 2399: `String _getStatusBadge(double percentage) {`
- Line 2400: `if (percentage >= 90) return 'âœ…';`
- Line 2401: `if (percentage >= 70) return 'âš ï¸';`
- Line 2405: `String _generateBar(double percentage, int width) {`
- Line 2406: `final filled = (percentage / 100 * width).round();`
- Line 2407: `final empty = width - filled;`
- Line 2408: `return 'â–ˆ' * filled + 'â–‘' * empty;`
- Line 2411: `String _truncate(String str, int maxLength) {`
- Line 2412: `if (str.length <= maxLength) return str;`
- Line 2413: `return '${str.substring(0, maxLength - 3)}...';`
- Line 2419: `LoadingEvent({`
- Line 2434: `LoadingPerformance({required this.filePath});`
- Line 2439: `void addLoadTime(int runNumber, int loadTime, {required bool success}) {`
- Line 2440: `loadTimes[runNumber] = loadTime;`
- Line 2441: `loadSuccess[runNumber] = success;`
- Line 2444: `double get averageLoadTime {`
- Line 2445: `if (loadTimes.isEmpty) return 0;`
- Line 2446: `return loadTimes.values.reduce((a, b) => a + b) / loadTimes.length;`
- Line 2449: `int get maxLoadTime =>`
- Line 2450: `loadTimes.values.isEmpty ? 0 : loadTimes.values.reduce(math.max);`
- Line 2452: `bool get hasFailures => loadSuccess.values.any((success) => !success);`
- Line 2456: `TestRun({`
- Line 2467: `TestFailure({`
- Line 2482: `TestPerformance({`
- Line 2490: `double get averageDuration => durations.isEmpty`
- Line 2492: `: durations.reduce((a, b) => a + b) / durations.length;`
- Line 2494: `double get maxDuration => durations.isEmpty ? 0 : durations.reduce(math.max);`
- Line 2496: `double get minDuration => durations.isEmpty ? 0 : durations.reduce(math.min);`
- Line 2498: `double get totalDuration => durations.fold(0, (sum, d) => sum + d);`
- Line 2500: `void addDuration(double duration) {`
- Line 2501: `durations.add(duration);`
- Line 2517: `FailurePattern({`
- Line 2530: `void main(List<String> args) async {`
- Line 2532: `final verbose = args.contains('--verbose') || args.contains('-v');`
- Line 2533: `final interactive = args.contains('--interactive') || args.contains('-i');`
- Line 2534: `final performance = args.contains('--performance') || args.contains('-p');`
- Line 2535: `final watch = args.contains('--watch') || args.contains('-w');`
- Line 2536: `final noFixes = args.contains('--no-fixes');`
- Line 2537: `final noReport = args.contains('--no-report');`
- Line 2538: `final help = args.contains('--help') || args.contains('-h');`
- Line 2539: `final parallel = args.contains('--parallel');`
- Line 2541: `args.contains('--dependencies') || args.contains('-d');`
- Line 2542: `final mutationTesting = args.contains('--mutation') || args.contains('-m');`
- Line 2543: `final impactAnalysis = args.contains('--impact');`
- Line 2547: `for (final arg in args) {`
- Line 2548: `if (arg.startsWith('--runs=')) {`
- Line 2549: `runCount = int.tryParse(arg.substring(7)) ?? 3;`
- Line 2555: `for (final arg in args) {`
- Line 2556: `if (arg.startsWith('--slow=')) {`
- Line 2557: `slowThreshold = double.tryParse(arg.substring(7)) ?? 1.0;`
- Line 2563: `for (final arg in args) {`
- Line 2564: `if (arg.startsWith('--workers=')) {`
- Line 2565: `maxWorkers = int.tryParse(arg.substring(10)) ?? 4;`
- Line 2570: `_printUsage();`
- Line 2575: `final targetFiles = args.where((arg) => !arg.startsWith('-')).toList();`
- Line 2577: `final analyzer = TestAnalyzer(`
- Line 2594: `await analyzer.run();`
- Line 2597: `void _printUsage() {`
- Line 2598: `print('''`

</details>

### ğŸ“„ `coverage_tool_lib.dart`

**Uncovered line numbers:**
```
124-125, 128-130, 134, 137-139, 141, 143, 150-157, 160-163, 166-167, 172, 175-176, 178, 182, 185-186, 190-191, 195-196, 200-201, 204-205, 209-210, 215-222, 226-227, 231-238, 241-242, 245-246, 248, 250, 252-253, 255-257, 266-267, 269-270, 275-276, 278, 280, 283-285, 292-295, 303-305, 311, 319, 323, 326, 332, 335, 338-342, 346, 358-361, 365-368, 375-376, 378-380, 382, 384, 388-390, 392-394, 401, 403, 406-407, 409-410, 413, 415-416, 419, 424-425, 429-430, 434-435, 437, 440-442, 444, 446-447, 450-452, 455-457, 459, 465, 468-470, 475, 479, 481-482, 484, 488, 494-497, 500, 504-505, 509-512, 514, 519, 522, 524, 538, 540-541, 543, 548, 550, 565, 569-570, 572-575, 578-583, 585, 593-594, 598-599, 601-604, 609, 611-614, 616-624, 627-628, 630, 633, 635, 637, 639, 645-648, 654-656, 658-661, 665-666, 670, 673, 675, 677-680, 682-683, 687-688, 690, 694-695, 698-699, 701-704, 709-710, 712-715, 720, 723-726, 728-730, 733, 738-739, 742, 744, 748-749, 751-752, 754-755, 763-765, 768-771, 775-777, 783, 785-795, 798-799, 801-803, 805-807, 810, 812-814, 819-824, 828-830, 835-837, 843-844, 847, 849-851, 854, 860-862, 864-866, 871, 876, 878-885, 891-894, 900, 903-908, 910-914, 917, 919, 922-923, 925, 928-933, 936-938, 941-942, 945, 949-957, 959-960, 963, 967-968, 970-975, 977-978, 980-981, 983, 988-990, 993-995, 999-1003, 1006, 1010-1015, 1017, 1020-1021, 1025-1031, 1033-1034, 1036-1037, 1039-1040, 1044, 1048-1051, 1053-1056, 1059-1060, 1062, 1067-1068, 1070, 1074-1075, 1078, 1081-1085, 1088-1093, 1096-1098, 1100-1101, 1104-1107, 1110-1114, 1117, 1119-1124, 1128-1129, 1131, 1136-1137, 1139-1141, 1148-1152, 1155-1163, 1165, 1171-1175, 1178-1182, 1185-1189, 1192, 1195-1199, 1203-1206, 1208, 1211-1212, 1214, 1217-1219, 1222-1224, 1226, 1230-1239, 1241-1250, 1253-1261, 1264-1266, 1269-1270, 1273-1274, 1279-1280, 1283-1285, 1287, 1291-1292, 1294-1299, 1301, 1305-1307, 1309, 1314-1315, 1317, 1320, 1325-1326, 1329-1330, 1334, 1337, 1343, 1346, 1348, 1353-1354, 1356-1358, 1360-1362, 1364-1366, 1369, 1371, 1374-1376, 1379-1380, 1383-1387, 1389, 1393-1395, 1397, 1399, 1404, 1408-1410, 1412-1413, 1415, 1419-1420, 1422-1425, 1427-1429, 1431-1432, 1437-1439, 1445, 1451-1453, 1462-1466, 1469-1473, 1475, 1479-1481, 1483-1484, 1486-1487, 1494-1495, 1497-1498, 1501-1505, 1511-1513, 1515-1516, 1519, 1522-1524, 1527-1528, 1532-1533, 1536, 1538-1539, 1541, 1543, 1547-1548, 1550-1551, 1553-1557, 1562, 1566-1568, 1576-1577, 1581-1583, 1586-1587, 1592, 1595-1597, 1601-1602, 1604, 1607, 1609, 1611-1612, 1614-1616, 1619, 1624-1625, 1627, 1629-1630, 1632-1635, 1639, 1641-1642, 1644, 1648, 1650, 1653-1659, 1661-1663, 1669, 1673-1674, 1679-1680, 1682-1684, 1689-1690, 1692, 1694-1696, 1698-1699, 1703, 1705, 1710-1711, 1713-1714, 1717-1719, 1744, 1747-1750, 1752, 1756, 1760, 1762, 1764-1765, 1768, 1776, 1780-1781, 1790, 1792-1796, 1800-1801, 1804-1805, 1807-1812, 1818-1822, 1824, 1827, 1831, 1833, 1835, 1839-1841, 1843, 1847, 1850, 1853-1855, 1858, 1860-1862, 1865-1867, 1869-1870, 1873-1874, 1877, 1879, 1883-1885, 1888-1889, 1892, 1897-1902, 1905-1909, 1912-1913, 1916-1917, 1919-1920, 1930-1932, 1934-1941, 1948, 1953, 1964, 1966-1974, 1977-1980, 1987-1988, 1990-1994, 1996-2000, 2007-2009, 2018-2026, 2028-2034, 2036, 2042, 2044, 2048-2049, 2054, 2056-2058, 2060-2061, 2067, 2071-2073, 2077-2079, 2094-2108, 2111-2114, 2117-2118, 2121, 2124-2141, 2144-2146, 2149-2154, 2157, 2170, 2179, 2181-2187, 2189-2190, 2192-2193, 2196-2198
```

<details>
<summary>Click to see uncovered code snippets</summary>

- Line 124: `bool get isFlutterProject {`
- Line 125: `if (_isFlutterProject != null) return _isFlutterProject!;`
- Line 128: `final pubspecFile = File('pubspec.yaml');`
- Line 129: `if (!pubspecFile.existsSync()) {`
- Line 130: `_isFlutterProject = false;`
- Line 134: `final content = pubspecFile.readAsStringSync();`
- Line 137: `_isFlutterProject =`
- Line 138: `content.contains(RegExp(r'^\s*flutter:\s*$', multiLine: true)) ||`
- Line 139: `content.contains(RegExp(r'flutter:\s*sdk:', multiLine: true));`
- Line 141: `return _isFlutterProject!;`
- Line 143: `_isFlutterProject = false;`
- Line 150: `Future<void> analyze() async {`
- Line 151: `print('=' * 80);`
- Line 152: `print('FLUTTER COVERAGE ANALYZER v2.0 - 2025 Enhanced Edition');`
- Line 153: `print('=' * 80);`
- Line 154: `print('Analyzing: $libPath');`
- Line 155: `print('Tests: $testPath');`
- Line 156: `print('Mode: ${_getAnalysisMode()}');`
- Line 157: `print('');`
- Line 160: `if (incremental) {`
- Line 161: `changedFiles = await getChangedFiles();`
- Line 162: `if (changedFiles.isEmpty) {`
- Line 163: `print('âœ… No changed files to analyze');`
- Line 166: `print(`
- Line 167: `'ğŸ”„ Incremental mode: analyzing ${changedFiles.length} changed files',`
- Line 172: `await fixImportPaths();`
- Line 175: `if (parallel) {`
- Line 176: `await runParallelCoverage();`
- Line 178: `await runCoverage();`
- Line 182: `await analyzeCoverage();`
- Line 185: `if (baselineFile != null) {`
- Line 186: `await loadBaselineCoverage();`
- Line 190: `if (mutationTesting) {`
- Line 191: `await runMutationTesting();`
- Line 195: `if (testImpactAnalysis) {`
- Line 196: `await analyzeTestImpact();`
- Line 200: `if (generateReport) {`
- Line 201: `await generateCoverageReport();`
- Line 204: `if (exportJson) {`
- Line 205: `await exportJsonReport();`
- Line 209: `if (autoFix && uncoveredLines.isNotEmpty) {`
- Line 210: `await generateMissingTests();`
- Line 215: `baselineFile != null ? await getBaselineCoverage() : null;`
- Line 216: `if (thresholds.minimum > 0 ||`
- Line 217: `thresholds.warning > 0 ||`
- Line 218: `thresholds.failOnDecrease) {`
- Line 219: `print('\nğŸ“Š Validating coverage thresholds...');`
- Line 220: `print('  Current coverage: ${overallCoverage.toStringAsFixed(1)}%');`
- Line 221: `thresholdViolation =`
- Line 222: `!thresholds.validate(overallCoverage, baseline: baselineCoverage);`
- Line 226: `if (watchMode) {`
- Line 227: `await enterWatchMode();`
- Line 231: `String _getAnalysisMode() {`
- Line 232: `final modes = <String>[];`
- Line 233: `if (branchCoverage) modes.add('Branch');`
- Line 234: `if (incremental) modes.add('Incremental');`
- Line 235: `if (parallel) modes.add('Parallel');`
- Line 236: `if (mutationTesting) modes.add('Mutation');`
- Line 237: `if (watchMode) modes.add('Watch');`
- Line 238: `return modes.isEmpty ? 'Standard' : modes.join(', ');`
- Line 241: `Future<void> fixImportPaths() async {`
- Line 242: `print('ğŸ”§ Fixing import paths in test files...');`
- Line 245: `final testFile = File(testPath);`
- Line 246: `final testDir = Directory(testPath);`
- Line 248: `final testFiles = <File>[];`
- Line 250: `if (testFile.existsSync() && testPath.endsWith('_test.dart')) {`
- Line 252: `testFiles.add(testFile);`
- Line 253: `} else if (testDir.existsSync()) {`
- Line 255: `await for (final file in testDir.list(recursive: true)) {`
- Line 256: `if (file is File && file.path.endsWith('_test.dart')) {`
- Line 257: `testFiles.add(file);`
- Line 266: `final packageName = await getPackageName();`
- Line 267: `final projectRoot = Directory.current.path;`
- Line 269: `for (final file in testFiles) {`
- Line 270: `var content = await file.readAsString();`
- Line 275: `final importRegex = RegExp(r'''import\s+['"](.*?)['"];''');`
- Line 276: `final matches = importRegex.allMatches(content).toList();`
- Line 278: `for (final match in matches.reversed) {`
- Line 280: `final importPath = match.group(1)!;`
- Line 283: `if (importPath.startsWith('../')) {`
- Line 284: `final fixedImport = await _resolveImportPath(`
- Line 285: `file.path,`
- Line 292: `content = content.replaceRange(`
- Line 293: `match.start,`
- Line 294: `match.end,`
- Line 295: `"import '$fixedImport';",`
- Line 303: `if (hasChanges && content != originalContent) {`
- Line 304: `await file.writeAsString(content);`
- Line 305: `print('  âœ… Fixed imports in: ${file.path}');`
- Line 311: `Future<String?> _resolveImportPath(`
- Line 319: `final testFileDir = Directory(testFilePath).parent.path;`
- Line 323: `_normalizePath(_joinPath(testFileDir, importPath));`
- Line 326: `if (!File(absoluteImportPath).existsSync()) {`
- Line 332: `_getRelativePathFromRoot(absoluteImportPath, projectRoot);`
- Line 335: `if (relativeFromProjectRoot.startsWith('lib/')) {`
- Line 338: `relativeFromProjectRoot.substring(4); // Remove 'lib/' prefix`
- Line 339: `return 'package:$packageName/$packagePath';`
- Line 340: `} else if (relativeFromProjectRoot.startsWith('test/') ||`
- Line 341: `relativeFromProjectRoot.contains('helpers') ||`
- Line 342: `relativeFromProjectRoot.contains('mocks')) {`
- Line 346: `_calculateRelativePath(testFilePath, absoluteImportPath);`
- Line 358: `String _calculateRelativePath(String fromFile, String toFile) {`
- Line 359: `final fromDir = Directory(fromFile).parent.path;`
- Line 360: `final fromParts = _normalizePath(fromDir).split('/');`
- Line 361: `final toParts = _normalizePath(toFile).split('/');`
- Line 365: `final minLength = math.min(fromParts.length, toParts.length);`
- Line 366: `for (var i = 0; i < minLength; i++) {`
- Line 367: `if (fromParts[i] == toParts[i]) {`
- Line 368: `commonLength = i + 1;`
- Line 375: `final upLevels = fromParts.length - commonLength;`
- Line 376: `final downParts = toParts.skip(commonLength).toList();`
- Line 378: `final pathSegments = <String>[];`
- Line 379: `for (var i = 0; i < upLevels; i++) {`
- Line 380: `pathSegments.add('..');`
- Line 382: `pathSegments.addAll(downParts);`
- Line 384: `return pathSegments.join('/');`
- Line 388: `String _getRelativePathFromRoot(String absolutePath, String projectRoot) {`
- Line 389: `final normalizedAbsolute = _normalizePath(absolutePath);`
- Line 390: `final normalizedRoot = _normalizePath(projectRoot);`
- Line 392: `if (normalizedAbsolute.startsWith(normalizedRoot)) {`
- Line 393: `final relative = normalizedAbsolute.substring(normalizedRoot.length);`
- Line 394: `return relative.startsWith('/') ? relative.substring(1) : relative;`
- Line 401: `String _normalizePath(String path) {`
- Line 403: `path = path.replaceAll(r'\', '/');`
- Line 406: `final parts = path.split('/').where((part) => part.isNotEmpty).toList();`
- Line 407: `final resolved = <String>[];`
- Line 409: `for (final part in parts) {`
- Line 410: `if (part == '.') {`
- Line 413: `} else if (part == '..') {`
- Line 415: `if (resolved.isNotEmpty) {`
- Line 416: `resolved.removeLast();`
- Line 419: `resolved.add(part);`
- Line 424: `final result = resolved.join('/');`
- Line 425: `return path.startsWith('/') ? '/$result' : result;`
- Line 429: `String _joinPath(String base, String relative) {`
- Line 430: `if (relative.startsWith('/')) {`
- Line 434: `final normalizedBase = _normalizePath(base);`
- Line 435: `final normalizedRelative = _normalizePath(relative);`
- Line 437: `return '$normalizedBase/$normalizedRelative';`
- Line 440: `Future<String> getPackageName() async {`
- Line 441: `final pubspecFile = File('pubspec.yaml');`
- Line 442: `if (!pubspecFile.existsSync()) return 'supaflow';`
- Line 444: `final content = await pubspecFile.readAsString();`
- Line 446: `RegExp(r'^name:\s*(\S+)', multiLine: true).firstMatch(content);`
- Line 447: `return nameMatch?.group(1) ?? 'supaflow';`
- Line 450: `Future<void> runCoverage() async {`
- Line 451: `final projectType = isFlutterProject ? 'Flutter' : 'Dart';`
- Line 452: `print('\nğŸ“Š Running $projectType tests with coverage...');`
- Line 455: `final coverageDir = Directory('coverage');`
- Line 456: `if (coverageDir.existsSync()) {`
- Line 457: `await coverageDir.delete(recursive: true);`
- Line 459: `await coverageDir.create();`
- Line 465: `if (isFlutterProject) {`
- Line 468: `args = ['test', '--coverage', '--no-test-assets'];`
- Line 469: `if (branchCoverage) {`
- Line 470: `args.add('--branch-coverage');`
- Line 475: `args = ['test', '--coverage=coverage'];`
- Line 479: `if (incremental && changedFiles.isNotEmpty) {`
- Line 481: `final testFilesToRun = await getTestFilesForChangedFiles();`
- Line 482: `args.addAll(testFilesToRun);`
- Line 484: `args.add(testPath);`
- Line 488: `final result = await Process.run(`
- Line 494: `if (result.exitCode != 0) {`
- Line 495: `print('  âš ï¸  Some tests failed:');`
- Line 496: `if (result.stderr.toString().isNotEmpty) {`
- Line 497: `print(result.stderr);`
- Line 500: `print('  âœ… All tests passed');`
- Line 504: `if (!isFlutterProject) {`
- Line 505: `await _convertDartCoverageToLcov();`
- Line 509: `final lcovFile = File('coverage/lcov.info');`
- Line 510: `if (!lcovFile.existsSync() || lcovFile.lengthSync() == 0) {`
- Line 511: `print('  âš ï¸  Coverage file is empty, attempting alternative method...');`
- Line 512: `await runAlternativeCoverage();`
- Line 514: `print('  âœ… Coverage data generated: ${lcovFile.lengthSync()} bytes');`
- Line 519: `Future<void> _convertDartCoverageToLcov() async {`
- Line 522: `final formatResult = await Process.run(`
- Line 524: `[`
- Line 538: `if (formatResult.exitCode != 0) {`
- Line 540: `print('  Installing coverage package...');`
- Line 541: `await Process.run(`
- Line 543: `['pub', 'global', 'activate', 'coverage'],`
- Line 548: `await Process.run(`
- Line 550: `[`
- Line 565: `print('  âš ï¸  Failed to convert coverage format: $e');`
- Line 569: `Future<void> runAlternativeCoverage() async {`
- Line 570: `print('\nğŸ”„ Trying alternative coverage collection...');`
- Line 572: `final command = isFlutterProject ? 'flutter' : 'dart';`
- Line 573: `final testArgs = isFlutterProject`
- Line 574: `? ['test', '--coverage']`
- Line 575: `: ['test', '--coverage=coverage'];`
- Line 578: `final testDir = Directory(testPath);`
- Line 579: `if (testDir.existsSync()) {`
- Line 580: `await for (final file in testDir.list(recursive: true)) {`
- Line 581: `if (file is File && file.path.endsWith('_test.dart')) {`
- Line 582: `print('  Testing: ${file.path}');`
- Line 583: `await Process.run(`
- Line 585: `[...testArgs, file.path],`
- Line 593: `if (!isFlutterProject) {`
- Line 594: `await _convertDartCoverageToLcov();`
- Line 598: `Future<void> analyzeCoverage() async {`
- Line 599: `print('\nğŸ” Analyzing coverage data...');`
- Line 601: `final lcovFile = File('coverage/lcov.info');`
- Line 602: `if (!lcovFile.existsSync() || lcovFile.lengthSync() == 0) {`
- Line 603: `print('  âš ï¸  No coverage data available, performing manual analysis...');`
- Line 604: `await performManualAnalysis();`
- Line 609: `final lines = await lcovFile.readAsLines();`
- Line 611: `final coveredLines = <String, Set<int>>{};`
- Line 612: `final uncoveredLines = <String, Set<int>>{};`
- Line 613: `final totalLines = <String, int>{};`
- Line 614: `final hitLines = <String, int>{};`
- Line 616: `for (final line in lines) {`
- Line 617: `if (line.startsWith('SF:')) {`
- Line 618: `currentFile = line.substring(3);`
- Line 619: `coveredLines[currentFile] = {};`
- Line 620: `uncoveredLines[currentFile] = {};`
- Line 621: `} else if (line.startsWith('DA:')) {`
- Line 622: `final parts = line.substring(3).split(',');`
- Line 623: `final lineNum = int.parse(parts[0]);`
- Line 624: `final hits = int.parse(parts[1]);`
- Line 627: `if (hits > 0) {`
- Line 628: `coveredLines[currentFile]!.add(lineNum);`
- Line 630: `uncoveredLines[currentFile]!.add(lineNum);`
- Line 633: `} else if (line.startsWith('LF:')) {`
- Line 635: `totalLines[currentFile] = int.parse(line.substring(3));`
- Line 637: `} else if (line.startsWith('LH:')) {`
- Line 639: `hitLines[currentFile] = int.parse(line.substring(3));`
- Line 645: `coveredLinesData = coveredLines;`
- Line 646: `uncoveredLinesData = uncoveredLines;`
- Line 647: `totalLinesData = totalLines;`
- Line 648: `hitLinesData = hitLines;`
- Line 654: `final normalizedLibPath = libPath.startsWith('lib/')`
- Line 655: `? libPath.substring(4) // Remove 'lib/' prefix`
- Line 656: `: libPath;`
- Line 658: `for (final file in totalLines.keys) {`
- Line 659: `if (file.contains(normalizedLibPath)) {`
- Line 660: `totalLinesInPath += totalLines[file] ?? 0;`
- Line 661: `coveredLinesInPath += hitLines[file] ?? 0;`
- Line 665: `if (totalLinesInPath > 0) {`
- Line 666: `overallCoverage = (coveredLinesInPath / totalLinesInPath) * 100;`
- Line 670: `print('\nğŸ“ˆ Coverage Summary:');`
- Line 673: `libPath.startsWith('lib/') ? libPath.substring(4) : libPath;`
- Line 675: `for (final file in uncoveredLines.keys) {`
- Line 677: `if (file.contains(normalizedLibPath2) &&`
- Line 678: `uncoveredLines[file]!.isNotEmpty) {`
- Line 679: `print('  File: $file');`
- Line 680: `print('    Uncovered lines: ${uncoveredLines[file]!.toList()..sort()}');`
- Line 682: `.uncoveredLines`
- Line 683: `.addAll(uncoveredLines[file]!.map((l) => '$file:$l'));`
- Line 687: `if (this.uncoveredLines.isEmpty) {`
- Line 688: `print('  âœ… 100% coverage achieved!');`
- Line 690: `print('  âš ï¸  ${this.uncoveredLines.length} lines need coverage');`
- Line 694: `Future<void> performManualAnalysis() async {`
- Line 695: `print('  Performing manual coverage analysis...');`
- Line 698: `final sourceDir = Directory(libPath);`
- Line 699: `if (!sourceDir.existsSync()) return;`
- Line 701: `await for (final file in sourceDir.list(recursive: true)) {`
- Line 702: `if (file is File && file.path.endsWith('.dart')) {`
- Line 703: `final analysis = await analyzeSourceFile(file);`
- Line 704: `sourceFiles[file.path] = analysis;`
- Line 709: `final testDir = Directory(testPath);`
- Line 710: `if (!testDir.existsSync()) return;`
- Line 712: `await for (final file in testDir.list(recursive: true)) {`
- Line 713: `if (file is File && file.path.endsWith('_test.dart')) {`
- Line 714: `final analysis = await analyzeTestFile(file);`
- Line 715: `testFiles[file.path] = analysis;`
- Line 720: `matchTestedMethods();`
- Line 723: `Future<FileAnalysis> analyzeSourceFile(File file) async {`
- Line 724: `final content = await file.readAsString();`
- Line 725: `final lines = content.split('\n');`
- Line 726: `final analysis = FileAnalysis(file.path);`
- Line 728: `for (var i = 0; i < lines.length; i++) {`
- Line 729: `final line = lines[i].trim();`
- Line 730: `final lineNum = i + 1;`
- Line 733: `if (line.isEmpty || line.startsWith('//') || line.startsWith('///')) {`
- Line 738: `if (isTestableLine(line)) {`
- Line 739: `analysis.testableLines.add(lineNum);`
- Line 742: `final methodMatch = RegExp(r'(\w+)\s*\(').firstMatch(line);`
- Line 744: `analysis.methods.add(methodMatch.group(1)!);`
- Line 748: `if (line.contains('catch')) {`
- Line 749: `analysis.catchBlocks.add(lineNum);`
- Line 751: `if (line.contains('throw')) {`
- Line 752: `analysis.throwStatements.add(lineNum);`
- Line 754: `if (line.contains('if') || line.contains('else')) {`
- Line 755: `analysis.conditionals.add(lineNum);`
- Line 763: `Future<FileAnalysis> analyzeTestFile(File file) async {`
- Line 764: `final content = await file.readAsString();`
- Line 765: `final analysis = FileAnalysis(file.path);`
- Line 768: `final testRegex = RegExp('test\\(["\']([^"\']+)["\']');`
- Line 769: `final testMatches = testRegex.allMatches(content);`
- Line 770: `for (final match in testMatches) {`
- Line 771: `analysis.testDescriptions.add(match.group(1)!);`
- Line 775: `final methodCalls = RegExp(r'(\w+)\s*\(').allMatches(content);`
- Line 776: `for (final match in methodCalls) {`
- Line 777: `analysis.testedMethods.add(match.group(1)!);`
- Line 783: `bool isTestableLine(String line) {`
- Line 785: `return line.contains('if') ||`
- Line 786: `line.contains('for') ||`
- Line 787: `line.contains('while') ||`
- Line 788: `line.contains('return') ||`
- Line 789: `line.contains('throw') ||`
- Line 790: `line.contains('catch') ||`
- Line 791: `line.contains('switch') ||`
- Line 792: `line.contains('=') &&`
- Line 793: `!line.startsWith('final') &&`
- Line 794: `!line.startsWith('const') ||`
- Line 795: `RegExp(r'\w+\(.*\)').hasMatch(line);`
- Line 798: `void matchTestedMethods() {`
- Line 799: `print('\nğŸ”— Matching tested methods...');`
- Line 801: `for (final sourceFile in sourceFiles.values) {`
- Line 802: `final baseName = sourceFile.path.split('/').last.replaceAll('.dart', '');`
- Line 803: `final testFileName = '${baseName}_test.dart';`
- Line 805: `final testFile = testFiles.values.firstWhere(`
- Line 806: `(tf) => tf.path.endsWith(testFileName),`
- Line 807: `orElse: () => FileAnalysis(''),`
- Line 810: `if (testFile.path.isNotEmpty) {`
- Line 812: `for (final method in sourceFile.methods) {`
- Line 813: `if (!testFile.testedMethods.contains(method)) {`
- Line 814: `print('  âš ï¸  Method not tested: $method in ${sourceFile.path}');`
- Line 819: `if (sourceFile.catchBlocks.isNotEmpty) {`
- Line 820: `final hasErrorTests = testFile.testDescriptions.any(`
- Line 821: `(desc) =>`
- Line 822: `desc.toLowerCase().contains('error') ||`
- Line 823: `desc.toLowerCase().contains('exception') ||`
- Line 824: `desc.toLowerCase().contains('catch'),`
- Line 828: `print('  âš ï¸  Catch blocks not tested in ${sourceFile.path}');`
- Line 829: `uncoveredLines.addAll(`
- Line 830: `sourceFile.catchBlocks.map((l) => '${sourceFile.path}:$l'),`
- Line 835: `print('  âš ï¸  No test file for: ${sourceFile.path}');`
- Line 836: `uncoveredLines.addAll(`
- Line 837: `sourceFile.testableLines.map((l) => '${sourceFile.path}:$l'),`
- Line 843: `Future<void> generateCoverageReport() async {`
- Line 844: `print('\nğŸ“ Generating comprehensive coverage report...');`
- Line 847: `final now = DateTime.now();`
- Line 849: `final simpleTimestamp =`
- Line 850: `'${now.hour.toString().padLeft(2, '0')}${now.minute.toString().padLeft(2, '0'...`
- Line 851: `'${now.day.toString().padLeft(2, '0')}${now.month.toString().padLeft(2, '0')}...`
- Line 854: `final pathName = _extractPathName();`
- Line 860: `final report = StringBuffer();`
- Line 861: `report.writeln('# ğŸ“Š Coverage Report');`
- Line 862: `report.writeln();`
- Line 864: `report.writeln('**Generated:** ${DateTime.now()}');`
- Line 865: `report.writeln('**Module:** `$libPath`');`
- Line 866: `report.writeln();`
- Line 871: `final fileCoverages = <String, double>{};`
- Line 876: `libPath.startsWith('lib/') ? libPath.substring(4) : libPath;`
- Line 878: `for (final file in totalLinesData.keys) {`
- Line 879: `if (file.contains(normalizedLibPath3)) {`
- Line 880: `final total = totalLinesData[file] ?? 0;`
- Line 881: `final hits = hitLinesData[file] ?? 0;`
- Line 882: `totalLines += total;`
- Line 883: `coveredLines += hits;`
- Line 884: `if (total > 0) {`
- Line 885: `fileCoverages[file] = (hits / total) * 100;`
- Line 891: `if (totalLines == 0 && sourceFiles.isNotEmpty) {`
- Line 892: `for (final sourceFile in sourceFiles.values) {`
- Line 893: `totalLines += sourceFile.testableLines.length;`
- Line 894: `fileCoverages[sourceFile.path] = 0.0; // Manual analysis shows untested`
- Line 900: `totalLines > 0 ? (coveredLines / totalLines * 100) : 0;`
- Line 903: `report.writeln('## ğŸ“ˆ Executive Summary');`
- Line 904: `report.writeln();`
- Line 905: `report.writeln('| Metric | Value |');`
- Line 906: `report.writeln('|--------|-------|');`
- Line 907: `report.writeln(`
- Line 908: `'| **Overall Coverage** | **${overallPercentage.toStringAsFixed(1)}%** |',`
- Line 910: `report.writeln('| Total Lines | $totalLines |');`
- Line 911: `report.writeln('| Covered Lines | $coveredLines |');`
- Line 912: `report.writeln('| Uncovered Lines | ${totalLines - coveredLines} |');`
- Line 913: `report.writeln('| Files Analyzed | ${fileCoverages.length} |');`
- Line 914: `report.writeln();`
- Line 917: `final badge = overallPercentage >= 80`
- Line 919: `: overallPercentage >= 60`
- Line 922: `report.writeln(`
- Line 923: `'### Coverage Status: $badge ${overallPercentage >= 80 ? "Good" : overallPerc...`
- Line 925: `report.writeln();`
- Line 928: `if (branchCoverage ||`
- Line 929: `incremental ||`
- Line 930: `mutationTesting ||`
- Line 931: `baselineFile != null) {`
- Line 932: `report.writeln('## ğŸš€ Advanced Coverage Metrics (v2.0)');`
- Line 933: `report.writeln();`
- Line 936: `if (branchCoverage) {`
- Line 937: `report.writeln('### ğŸŒ¿ Branch Coverage');`
- Line 938: `report.writeln(`
- Line 941: `report.writeln('- **Status:** Enabled');`
- Line 942: `report.writeln(`
- Line 945: `report.writeln();`
- Line 949: `if (incremental) {`
- Line 950: `report.writeln('### ğŸ“ˆ Incremental Coverage');`
- Line 951: `report.writeln('Analyzing only changed files from git diff.');`
- Line 952: `final changedFiles = await getChangedFiles();`
- Line 953: `report.writeln('- **Changed Files:** ${changedFiles.length}');`
- Line 954: `if (changedFiles.isNotEmpty) {`
- Line 955: `report.writeln('- **Files:** ');`
- Line 956: `for (final file in changedFiles.take(5)) {`
- Line 957: `report.writeln('  - `${file.split('/').last}`');`
- Line 959: `if (changedFiles.length > 5) {`
- Line 960: `report.writeln('  - ... and ${changedFiles.length - 5} more');`
- Line 963: `report.writeln();`
- Line 967: `if (baselineFile != null) {`
- Line 968: `final baselineCov = await getBaselineCoverage();`
- Line 970: `final diff = overallPercentage - baselineCov;`
- Line 971: `final diffIcon = diff >= 0 ? 'ğŸ“ˆ' : 'ğŸ“‰';`
- Line 972: `final diffColor = diff >= 0 ? 'ğŸŸ¢' : 'ğŸ”´';`
- Line 973: `report.writeln('### ğŸ“Š Coverage Diff vs Baseline');`
- Line 974: `report.writeln(`
- Line 975: `'- **Baseline Coverage:** ${baselineCov.toStringAsFixed(1)}%',`
- Line 977: `report.writeln(`
- Line 978: `'- **Current Coverage:** ${overallPercentage.toStringAsFixed(1)}%',`
- Line 980: `report.writeln(`
- Line 981: `'- **Change:** $diffIcon ${diff >= 0 ? "+" : ""}${diff.toStringAsFixed(1)}% $...`
- Line 983: `report.writeln();`
- Line 988: `if (mutationTesting) {`
- Line 989: `report.writeln('### ğŸ§¬ Mutation Testing');`
- Line 990: `report.writeln(`
- Line 993: `report.writeln('- **Status:** Available (run with --mutation flag)');`
- Line 994: `report.writeln('- **Note:** This is a time-intensive operation');`
- Line 995: `report.writeln();`
- Line 999: `if (testImpactAnalysis) {`
- Line 1000: `report.writeln('### ğŸ¯ Test Impact Analysis');`
- Line 1001: `report.writeln('Mapping which tests cover which lines of code.');`
- Line 1002: `report.writeln('- **Status:** Enabled');`
- Line 1003: `report.writeln(`
- Line 1006: `report.writeln();`
- Line 1010: `if (parallel) {`
- Line 1011: `report.writeln('### âš¡ Performance Optimization');`
- Line 1012: `report.writeln('- **Parallel Execution:** Enabled');`
- Line 1013: `report.writeln('- **Workers:** ${Platform.numberOfProcessors}');`
- Line 1014: `report.writeln(`
- Line 1015: `'- **Speed Improvement:** ~${(Platform.numberOfProcessors * 0.7).toStringAsFi...`
- Line 1017: `report.writeln();`
- Line 1020: `report.writeln('---');`
- Line 1021: `report.writeln();`
- Line 1025: `if (thresholds.minimum > 0) {`
- Line 1026: `report.writeln('## ğŸ¯ Coverage Thresholds');`
- Line 1027: `report.writeln();`
- Line 1028: `report.writeln('| Threshold | Value | Status |');`
- Line 1029: `report.writeln('|-----------|-------|--------|');`
- Line 1030: `report.writeln(`
- Line 1031: `'| Minimum | ${thresholds.minimum.toStringAsFixed(1)}% | ${overallPercentage ...`
- Line 1033: `report.writeln(`
- Line 1034: `'| Warning | ${thresholds.warning.toStringAsFixed(1)}% | ${overallPercentage ...`
- Line 1036: `if (thresholds.failOnDecrease && baselineFile != null) {`
- Line 1037: `final baselineCov = await getBaselineCoverage();`
- Line 1039: `report.writeln(`
- Line 1040: `'| No Decrease | ${baselineCov.toStringAsFixed(1)}% | ${overallPercentage >= ...`
- Line 1044: `report.writeln();`
- Line 1048: `report.writeln('## ğŸ“ File Coverage Breakdown');`
- Line 1049: `report.writeln();`
- Line 1050: `report.writeln('| File | Coverage | Lines | Covered | Uncovered |');`
- Line 1051: `report.writeln('|------|----------|-------|---------|-----------|');`
- Line 1053: `for (final file in fileCoverages.keys) {`
- Line 1054: `final fileName = file.split('/').last;`
- Line 1055: `var total = totalLinesData[file] ?? 0;`
- Line 1056: `var hits = hitLinesData[file] ?? 0;`
- Line 1059: `if (total == 0) {`
- Line 1060: `final sourceFile = sourceFiles[file];`
- Line 1062: `total = sourceFile.testableLines.length;`
- Line 1067: `final percentage = fileCoverages[file]!;`
- Line 1068: `final statusIcon = percentage >= 80`
- Line 1070: `: percentage >= 60`
- Line 1074: `report.writeln(`
- Line 1075: `'| $statusIcon `$fileName` | **${percentage.toStringAsFixed(1)}%** | $total |...`
- Line 1078: `report.writeln();`
- Line 1081: `if (uncoveredLines.isNotEmpty) {`
- Line 1082: `report.writeln('## ğŸ” Uncovered Lines Detail');`
- Line 1083: `report.writeln();`
- Line 1084: `report.writeln('Below are the specific lines that need test coverage:');`
- Line 1085: `report.writeln();`
- Line 1088: `final uncoveredByFile = <String, List<int>>{};`
- Line 1089: `for (final lineStr in uncoveredLines) {`
- Line 1090: `final parts = lineStr.split(':');`
- Line 1091: `final file = parts[0];`
- Line 1092: `final lineNum = int.parse(parts[1]);`
- Line 1093: `uncoveredByFile.putIfAbsent(file, () => []).add(lineNum);`
- Line 1096: `for (final file in uncoveredByFile.keys) {`
- Line 1097: `final fileName = file.split('/').last;`
- Line 1098: `final lines = uncoveredByFile[file]!..sort();`
- Line 1100: `report.writeln('### ğŸ“„ `$fileName`');`
- Line 1101: `report.writeln();`
- Line 1104: `report.writeln('**Uncovered line numbers:**');`
- Line 1105: `report.writeln('```');`
- Line 1106: `report.writeln(_formatLineRanges(lines));`
- Line 1107: `report.writeln('```');`
- Line 1110: `final sourceFile = File(file);`
- Line 1111: `if (sourceFile.existsSync()) {`
- Line 1112: `report.writeln();`
- Line 1113: `report.writeln('<details>');`
- Line 1114: `report.writeln(`
- Line 1117: `report.writeln();`
- Line 1119: `final sourceLines = sourceFile.readAsLinesSync();`
- Line 1120: `for (final lineNum in lines) {`
- Line 1121: `if (lineNum <= sourceLines.length) {`
- Line 1122: `final line = sourceLines[lineNum - 1].trim();`
- Line 1123: `if (line.isNotEmpty && !line.startsWith('//')) {`
- Line 1124: `report.writeln('- Line $lineNum: `${_truncate(line, 80)}`');`
- Line 1128: `report.writeln();`
- Line 1129: `report.writeln('</details>');`
- Line 1131: `report.writeln();`
- Line 1136: `report.writeln('## ğŸ’¡ Recommendations');`
- Line 1137: `report.writeln();`
- Line 1139: `if (overallPercentage < 100) {`
- Line 1140: `report.writeln('To achieve 100% coverage, focus on:');`
- Line 1141: `report.writeln();`
- Line 1148: `for (final lineStr in uncoveredLines) {`
- Line 1149: `final parts = lineStr.split(':');`
- Line 1150: `if (parts.length >= 2) {`
- Line 1151: `final file = parts[0];`
- Line 1152: `final lineNum = int.parse(parts[1]);`
- Line 1155: `final sourceFile = File(file);`
- Line 1156: `if (sourceFile.existsSync()) {`
- Line 1157: `final lines = sourceFile.readAsLinesSync();`
- Line 1158: `if (lineNum <= lines.length) {`
- Line 1159: `final line = lines[lineNum - 1];`
- Line 1160: `if (line.contains('catch')) {`
- Line 1161: `catchBlocks++;`
- Line 1162: `} else if (line.contains('if') || line.contains('else'))`
- Line 1163: `conditionals++;`
- Line 1165: `otherLines++;`
- Line 1171: `if (catchBlocks > 0) {`
- Line 1172: `report.writeln('1. **Error Handling** ($catchBlocks catch blocks)');`
- Line 1173: `report.writeln('   - Add tests that throw exceptions');`
- Line 1174: `report.writeln('   - Test error recovery paths');`
- Line 1175: `report.writeln();`
- Line 1178: `if (conditionals > 0) {`
- Line 1179: `report.writeln('2. **Branch Coverage** ($conditionals conditionals)');`
- Line 1180: `report.writeln('   - Test both true and false conditions');`
- Line 1181: `report.writeln('   - Cover edge cases in if/else statements');`
- Line 1182: `report.writeln();`
- Line 1185: `if (otherLines > 0) {`
- Line 1186: `report.writeln('3. **Other Logic** ($otherLines lines)');`
- Line 1187: `report.writeln('   - Review untested methods');`
- Line 1188: `report.writeln('   - Add integration tests for complex flows');`
- Line 1189: `report.writeln();`
- Line 1192: `report.writeln(`
- Line 1195: `report.writeln();`
- Line 1196: `report.writeln('Next steps:');`
- Line 1197: `report.writeln('- Maintain coverage with pre-commit hooks');`
- Line 1198: `report.writeln('- Add coverage checks to CI/CD pipeline');`
- Line 1199: `report.writeln('- Consider adding mutation testing');`
- Line 1203: `report.writeln('## ğŸ› ï¸ How to Improve Coverage');`
- Line 1204: `report.writeln();`
- Line 1205: `report.writeln(`
- Line 1206: `'1. **Run with auto-fix:** `dart coverage_tool.dart $libPath --fix`',`
- Line 1208: `report.writeln(`
- Line 1211: `report.writeln(`
- Line 1212: `'3. **Run specific tests:** `flutter test $testPath`',`
- Line 1214: `report.writeln();`
- Line 1217: `if (exportJson) {`
- Line 1218: `report.writeln('## ğŸ“¦ Generated Artifacts');`
- Line 1219: `report.writeln();`
- Line 1222: `'analyzer/reports/test_coverages/${pathName}_data@$simpleTimestamp.json';`
- Line 1223: `report.writeln('- **JSON Report:** [`$jsonPath`]($jsonPath)');`
- Line 1224: `report.writeln('  - Machine-readable format for CI/CD integration');`
- Line 1226: `report.writeln();`
- Line 1230: `report.writeln('## ğŸ”§ Available Options');`
- Line 1231: `report.writeln();`
- Line 1232: `report.writeln('```bash');`
- Line 1233: `report.writeln('# Basic usage');`
- Line 1234: `report.writeln('dart analyzer/coverage_tool.dart lib/src/core');`
- Line 1235: `report.writeln();`
- Line 1236: `report.writeln('# With auto-fix');`
- Line 1237: `report.writeln('dart analyzer/coverage_tool.dart lib/src/core --fix');`
- Line 1238: `report.writeln();`
- Line 1239: `report.writeln('# Incremental coverage (changed files only)');`
- Line 1241: `.writeln('dart analyzer/coverage_tool.dart lib/src/core --incremental');`
- Line 1242: `report.writeln();`
- Line 1243: `report.writeln('# With branch coverage');`
- Line 1244: `report.writeln('dart analyzer/coverage_tool.dart lib/src/core --branch');`
- Line 1245: `report.writeln();`
- Line 1246: `report.writeln('# Parallel execution');`
- Line 1247: `report.writeln('dart analyzer/coverage_tool.dart lib/src/core --parallel');`
- Line 1248: `report.writeln();`
- Line 1249: `report.writeln('# With coverage diff');`
- Line 1250: `report.writeln(`
- Line 1253: `report.writeln();`
- Line 1254: `report.writeln('# Watch mode');`
- Line 1255: `report.writeln('dart analyzer/coverage_tool.dart lib/src/core --watch');`
- Line 1256: `report.writeln();`
- Line 1257: `report.writeln('# Export JSON report');`
- Line 1258: `report.writeln('dart analyzer/coverage_tool.dart lib/src/core --json');`
- Line 1259: `report.writeln();`
- Line 1260: `report.writeln('# With coverage thresholds');`
- Line 1261: `report.writeln(`
- Line 1264: `report.writeln();`
- Line 1265: `report.writeln('# All features');`
- Line 1266: `report.writeln(`
- Line 1269: `report.writeln('```');`
- Line 1270: `report.writeln();`
- Line 1273: `report.writeln('---');`
- Line 1274: `report.writeln(`
- Line 1279: `final jsonData = <String, dynamic>{`
- Line 1280: `'metadata': {`
- Line 1283: `'generated': now.toIso8601String(),`
- Line 1284: `'module': libPath,`
- Line 1285: `'test_path': testPath,`
- Line 1287: `'summary': {`
- Line 1291: `'uncovered_lines': totalLines - coveredLines,`
- Line 1292: `'files_analyzed': fileCoverages.length,`
- Line 1294: `'file_coverages': fileCoverages.entries.map((entry) {`
- Line 1295: `return {`
- Line 1296: `'file': entry.key,`
- Line 1297: `'coverage': entry.value,`
- Line 1298: `'total_lines': totalLinesData[entry.key],`
- Line 1299: `'covered_lines': hitLinesData[entry.key],`
- Line 1301: `}).toList(),`
- Line 1305: `if (incremental) {`
- Line 1306: `final changedFiles = await getChangedFiles();`
- Line 1307: `jsonData['incremental'] = {`
- Line 1309: `'changed_files_count': changedFiles.length,`
- Line 1314: `if (baselineFile != null) {`
- Line 1315: `final baselineCov = await getBaselineCoverage();`
- Line 1317: `jsonData['baseline_comparison'] = {`
- Line 1320: `'difference': overallPercentage - baselineCov,`
- Line 1325: `if (branchCoverage) {`
- Line 1326: `jsonData['branch_coverage'] = {'enabled': true};`
- Line 1329: `if (mutationTesting) {`
- Line 1330: `jsonData['mutation_testing'] = {'enabled': true};`
- Line 1334: `final reportPath = await ReportUtils.writeUnifiedReport(`
- Line 1337: `markdownContent: report.toString(),`
- Line 1343: `print('  âœ… Report saved to: $reportPath');`
- Line 1346: `await ReportUtils.cleanOldReports(`
- Line 1348: `prefixPatterns: ['test_report_coverage'],`
- Line 1353: `String _formatLineRanges(List<int> lines) {`
- Line 1354: `if (lines.isEmpty) return '';`
- Line 1356: `final ranges = <String>[];`
- Line 1357: `var start = lines[0];`
- Line 1358: `var end = lines[0];`
- Line 1360: `for (var i = 1; i < lines.length; i++) {`
- Line 1361: `if (lines[i] == end + 1) {`
- Line 1362: `end = lines[i];`
- Line 1364: `ranges.add(start == end ? '$start' : '$start-$end');`
- Line 1365: `start = lines[i];`
- Line 1366: `end = lines[i];`
- Line 1369: `ranges.add(start == end ? '$start' : '$start-$end');`
- Line 1371: `return ranges.join(', ');`
- Line 1374: `String _truncate(String str, int maxLength) {`
- Line 1375: `if (str.length <= maxLength) return str;`
- Line 1376: `return '${str.substring(0, maxLength - 3)}...';`
- Line 1379: `Future<void> generateMissingTests() async {`
- Line 1380: `print('\nğŸ”§ Generating missing test cases...');`
- Line 1383: `final uncoveredByFile = <String, List<int>>{};`
- Line 1384: `for (final line in uncoveredLines) {`
- Line 1385: `final parts = line.split(':');`
- Line 1386: `final file = parts[0];`
- Line 1387: `final lineNum = int.parse(parts[1]);`
- Line 1389: `uncoveredByFile.putIfAbsent(file, () => []).add(lineNum);`
- Line 1393: `for (final entry in uncoveredByFile.entries) {`
- Line 1394: `final sourceFile = File(entry.key);`
- Line 1395: `if (!sourceFile.existsSync()) continue;`
- Line 1397: `final testFile = await generateTestsForFile(sourceFile, entry.value);`
- Line 1399: `print('  âœ… Generated tests for: ${sourceFile.path}');`
- Line 1404: `Future<File?> generateTestsForFile(`
- Line 1408: `final fileName = sourceFile.path.split('/').last;`
- Line 1409: `final testFileName = fileName.replaceAll('.dart', '_test.dart');`
- Line 1410: `final testFilePath = '$testPath/$testFileName';`
- Line 1412: `final testFile = File(testFilePath);`
- Line 1413: `if (!testFile.existsSync()) {`
- Line 1415: `await testFile.create(recursive: true);`
- Line 1419: `final sourceContent = await sourceFile.readAsString();`
- Line 1420: `final sourceLines = sourceContent.split('\n');`
- Line 1422: `final testContent = StringBuffer();`
- Line 1423: `testContent.writeln('// Additional tests for uncovered lines');`
- Line 1424: `testContent.writeln('// Generated by coverage_tool.dart');`
- Line 1425: `testContent.writeln();`
- Line 1427: `for (final lineNum in uncoveredLines) {`
- Line 1428: `if (lineNum <= sourceLines.length) {`
- Line 1429: `final line = sourceLines[lineNum - 1];`
- Line 1431: `if (line.contains('catch')) {`
- Line 1432: `testContent.writeln("""`
- Line 1437: `""");`
- Line 1438: `} else if (line.contains('if') || line.contains('else')) {`
- Line 1439: `testContent.writeln("""`
- Line 1445: `""");`
- Line 1451: `final existingContent = await testFile.readAsString();`
- Line 1452: `if (!existingContent.contains('Additional tests for uncovered lines')) {`
- Line 1453: `await testFile.writeAsString('$existingContent\n$testContent');`
- Line 1462: `Future<List<String>> getChangedFiles() async {`
- Line 1463: `final result = await Process.run('git', ['diff', '--name-only', 'HEAD~1']);`
- Line 1464: `if (result.exitCode != 0) {`
- Line 1465: `print('âš ï¸  Could not get changed files, analyzing all files');`
- Line 1466: `return [];`
- Line 1469: `return result.stdout`
- Line 1470: `.toString()`
- Line 1471: `.split('\n')`
- Line 1472: `.where(`
- Line 1473: `(f) => f.endsWith('.dart') && !f.startsWith('test/') && f.isNotEmpty,`
- Line 1475: `.toList();`
- Line 1479: `Future<List<String>> getTestFilesForChangedFiles() async {`
- Line 1480: `final testFiles = <String>[];`
- Line 1481: `for (final sourceFile in changedFiles) {`
- Line 1483: `.replaceFirst('lib/', 'test/')`
- Line 1484: `.replaceFirst('.dart', '_test.dart');`
- Line 1486: `if (await File(testFile).exists()) {`
- Line 1487: `testFiles.add(testFile);`
- Line 1494: `Future<void> runParallelCoverage() async {`
- Line 1495: `print('\nğŸš€ Running parallel coverage analysis...');`
- Line 1497: `final testDir = Directory(testPath);`
- Line 1498: `if (!testDir.existsSync()) return;`
- Line 1501: `final testFiles = <String>[];`
- Line 1502: `await for (final file in testDir.list(recursive: true)) {`
- Line 1503: `if (file is File && file.path.endsWith('_test.dart')) {`
- Line 1504: `if (!shouldExclude(file.path)) {`
- Line 1505: `testFiles.add(file.path);`
- Line 1511: `final numWorkers = math.min(Platform.numberOfProcessors, 4);`
- Line 1512: `final chunks = <List<String>>[];`
- Line 1513: `final chunkSize = (testFiles.length / numWorkers).ceil();`
- Line 1515: `for (var i = 0; i < testFiles.length; i += chunkSize) {`
- Line 1516: `chunks.add(testFiles.skip(i).take(chunkSize).toList());`
- Line 1519: `print('  Running ${testFiles.length} tests across $numWorkers workers');`
- Line 1522: `final futures = <Future<void>>[];`
- Line 1523: `for (var i = 0; i < chunks.length; i++) {`
- Line 1524: `futures.add(runCoverageForChunk(chunks[i], i));`
- Line 1527: `await Future.wait(futures);`
- Line 1528: `await mergeCoverageReports();`
- Line 1532: `Future<void> runCoverageForChunk(List<String> testFiles, int chunkId) async {`
- Line 1533: `final args = [`
- Line 1536: `'--coverage-path=coverage/lcov_$chunkId.info',`
- Line 1538: `if (branchCoverage) {`
- Line 1539: `args.add('--branch-coverage');`
- Line 1541: `args.addAll(testFiles);`
- Line 1543: `await Process.run('flutter', args, runInShell: true);`
- Line 1547: `Future<void> mergeCoverageReports() async {`
- Line 1548: `print('  Merging coverage reports...');`
- Line 1550: `final coverageDir = Directory('coverage');`
- Line 1551: `final mergedLines = <String>[];`
- Line 1553: `await for (final file in coverageDir.list()) {`
- Line 1554: `if (file is File && file.path.contains('lcov_')) {`
- Line 1555: `final lines = await file.readAsLines();`
- Line 1556: `mergedLines.addAll(lines);`
- Line 1557: `await file.delete();`
- Line 1562: `await File('coverage/lcov.info').writeAsString(mergedLines.join('\n'));`
- Line 1566: `bool shouldExclude(String filePath) {`
- Line 1567: `for (final pattern in excludePatterns) {`
- Line 1568: `if (RegExp(pattern).hasMatch(filePath)) {`
- Line 1576: `Future<void> runMutationTesting() async {`
- Line 1577: `print('\nğŸ§¬ Running mutation testing...');`
- Line 1581: `await Process.run('dart', ['pub', 'deps'], runInShell: true);`
- Line 1582: `if (!checkResult.stdout.toString().contains('mutation_test')) {`
- Line 1583: `print(`
- Line 1586: `print('      dev_dependencies:');`
- Line 1587: `print('        mutation_test: ^1.0.0');`
- Line 1592: `final args = ['run', 'mutation_test'];`
- Line 1595: `final lcovFile = File('coverage/lcov.info');`
- Line 1596: `if (lcovFile.existsSync()) {`
- Line 1597: `args.addAll(['--coverage', 'coverage/lcov.info']);`
- Line 1601: `if (incremental && changedFiles.isNotEmpty) {`
- Line 1602: `args.addAll(changedFiles);`
- Line 1604: `args.add(libPath);`
- Line 1607: `final result = await Process.run('dart', args, runInShell: true);`
- Line 1609: `if (result.exitCode == 0) {`
- Line 1611: `final output = result.stdout.toString();`
- Line 1612: `final scoreMatch = RegExp(r'Mutation Score: (\d+)%').firstMatch(output);`
- Line 1614: `final score = int.parse(scoreMatch.group(1)!);`
- Line 1615: `mutationScore['overall'] = score;`
- Line 1616: `print('  âœ… Mutation Score: $score%');`
- Line 1619: `print('  âš ï¸  Mutation testing failed: ${result.stderr}');`
- Line 1624: `Future<void> analyzeTestImpact() async {`
- Line 1625: `print('\nğŸ¯ Analyzing test impact mapping...');`
- Line 1627: `lineToTestsMapping.clear();`
- Line 1629: `final testDir = Directory(testPath);`
- Line 1630: `if (!testDir.existsSync()) return;`
- Line 1632: `final testFiles = <String>[];`
- Line 1633: `await for (final file in testDir.list(recursive: true)) {`
- Line 1634: `if (file is File && file.path.endsWith('_test.dart')) {`
- Line 1635: `testFiles.add(file.path);`
- Line 1639: `for (final testFile in testFiles) {`
- Line 1641: `final tempCoverageFile = 'coverage/temp_${testFile.hashCode}.info';`
- Line 1642: `final result = await Process.run(`
- Line 1644: `['test', '--coverage', '--coverage-path=$tempCoverageFile', testFile],`
- Line 1648: `if (result.exitCode == 0 && await File(tempCoverageFile).exists()) {`
- Line 1650: `final lines = await File(tempCoverageFile).readAsLines();`
- Line 1653: `for (final line in lines) {`
- Line 1654: `if (line.startsWith('SF:')) {`
- Line 1655: `currentFile = line.substring(3);`
- Line 1656: `} else if (line.startsWith('DA:') && currentFile != null) {`
- Line 1657: `final parts = line.substring(3).split(',');`
- Line 1658: `final lineNum = int.parse(parts[0]);`
- Line 1659: `final hits = int.parse(parts[1]);`
- Line 1661: `if (hits > 0) {`
- Line 1662: `final lineKey = '$currentFile:$lineNum';`
- Line 1663: `lineToTestsMapping.putIfAbsent(lineKey, () => {}).add(testFile);`
- Line 1669: `await File(tempCoverageFile).delete();`
- Line 1673: `print(`
- Line 1674: `'  âœ… Mapped ${lineToTestsMapping.length} lines to their covering tests',`
- Line 1679: `Future<void> loadBaselineCoverage() async {`
- Line 1680: `if (baselineFile == null) return;`
- Line 1682: `final file = File(baselineFile!);`
- Line 1683: `if (!file.existsSync()) {`
- Line 1684: `print('âš ï¸  Baseline file not found: $baselineFile');`
- Line 1689: `final jsonStr = await file.readAsString();`
- Line 1690: `final json = jsonDecode(jsonStr) as Map<String, dynamic>;`
- Line 1692: `final baselineFiles = json['files'] as Map<String, dynamic>?;`
- Line 1694: `for (final entry in baselineFiles.entries) {`
- Line 1695: `final currentCoverage = (totalLinesData[entry.key] ?? 0) > 0`
- Line 1696: `? (hitLinesData[entry.key]! / totalLinesData[entry.key]!) * 100`
- Line 1698: `final baselineCoverage = entry.value as double;`
- Line 1699: `coverageDiff[entry.key] = currentCoverage - baselineCoverage;`
- Line 1703: `print('ğŸ“Š Loaded baseline coverage for comparison');`
- Line 1705: `print('âš ï¸  Could not load baseline: $e');`
- Line 1710: `Future<double?> getBaselineCoverage() async {`
- Line 1711: `if (baselineFile == null) return null;`
- Line 1713: `final file = File(baselineFile!);`
- Line 1714: `if (!file.existsSync()) return null;`
- Line 1717: `final jsonStr = await file.readAsString();`
- Line 1718: `final json = jsonDecode(jsonStr) as Map<String, dynamic>;`
- Line 1719: `return json['overall'] as double?;`
- Line 1744: `String _extractPathName() {`
- Line 1747: `final path = testPath`
- Line 1748: `.replaceAll(r'\', '/')`
- Line 1749: `.replaceAll(RegExp(r'/$'), ''); // Remove trailing slash`
- Line 1750: `final segments = path.split('/').where((s) => s.isNotEmpty).toList();`
- Line 1752: `if (segments.isEmpty) {`
- Line 1756: `var pathName = segments.last;`
- Line 1760: `if (pathName.endsWith('.dart')) {`
- Line 1762: `pathName = pathName.substring(0, pathName.length - 5);`
- Line 1764: `if (pathName.endsWith('_test')) {`
- Line 1765: `pathName = pathName.substring(0, pathName.length - 5);`
- Line 1768: `} else if (pathName == 'test') {`
- Line 1776: `return '$pathName$suffix';`
- Line 1780: `Future<void> exportJsonReport() async {`
- Line 1781: `print('\nğŸ“„ Exporting JSON report...');`
- Line 1790: `libPath.startsWith('lib/') ? libPath.substring(4) : libPath;`
- Line 1792: `for (final file in totalLinesData.keys) {`
- Line 1793: `if (file.contains(normalizedLibPath4)) {`
- Line 1794: `filteredTotalLines += totalLinesData[file] ?? 0;`
- Line 1795: `filteredCoveredLines += hitLinesData[file] ?? 0;`
- Line 1796: `filteredFileCount++;`
- Line 1800: `final filteredOverallCoverage = filteredTotalLines > 0`
- Line 1801: `? (filteredCoveredLines / filteredTotalLines * 100)`
- Line 1804: `final json = {`
- Line 1805: `'timestamp': DateTime.now().toIso8601String(),`
- Line 1807: `'libPath': libPath,`
- Line 1808: `'files': <String, dynamic>{},`
- Line 1809: `'uncovered': uncoveredLines`
- Line 1810: `.where((line) => line.contains(normalizedLibPath4))`
- Line 1811: `.toList(),`
- Line 1812: `'metrics': {`
- Line 1818: `'branch': branchCoverage ? branchCoverageData : null,`
- Line 1819: `'mutation': mutationScore.isNotEmpty ? mutationScore : null,`
- Line 1820: `'impact': testImpactAnalysis`
- Line 1821: `? {`
- Line 1822: `'mappedLines': lineToTestsMapping.length,`
- Line 1824: `lineToTestsMapping.values.expand((e) => e).toSet().length,`
- Line 1827: `'diff': coverageDiff.isNotEmpty ? coverageDiff : null,`
- Line 1831: `final filesMap = <String, dynamic>{};`
- Line 1833: `for (final file in totalLinesData.keys) {`
- Line 1835: `if (!file.contains(normalizedLibPath4)) {`
- Line 1839: `final total = totalLinesData[file] ?? 0;`
- Line 1840: `final hits = hitLinesData[file] ?? 0;`
- Line 1841: `final coverage = total > 0 ? (hits / total) * 100 : 0.0;`
- Line 1843: `filesMap[file] = {`
- Line 1847: `'uncoveredLines': uncoveredLinesData[file]?.toList() ?? [],`
- Line 1850: `json['files'] = filesMap;`
- Line 1853: `final reportsDir = Directory('analyzer/reports/test_coverages');`
- Line 1854: `if (!await reportsDir.exists()) {`
- Line 1855: `await reportsDir.create(recursive: true);`
- Line 1858: `final now = DateTime.now();`
- Line 1860: `final simpleTimestamp =`
- Line 1861: `'${now.hour.toString().padLeft(2, '0')}${now.minute.toString().padLeft(2, '0'...`
- Line 1862: `'${now.day.toString().padLeft(2, '0')}${now.month.toString().padLeft(2, '0')}...`
- Line 1865: `var pathName = testPath.replaceAll('/', '_').replaceAll(r'\', '_');`
- Line 1866: `if (pathName.startsWith('test_')) {`
- Line 1867: `pathName = pathName.substring(5);`
- Line 1869: `if (pathName.endsWith('_')) {`
- Line 1870: `pathName = pathName.substring(0, pathName.length - 1);`
- Line 1873: `final jsonFile = File(`
- Line 1874: `'analyzer/reports/test_coverages/${pathName}_data@$simpleTimestamp.json',`
- Line 1877: `.writeAsString(const JsonEncoder.withIndent('  ').convert(json));`
- Line 1879: `print('  âœ… JSON report saved to: ${jsonFile.path}');`
- Line 1883: `Future<void> enterWatchMode() async {`
- Line 1884: `print('\nğŸ‘ï¸  Entering watch mode...');`
- Line 1885: `print('Press Ctrl+C to exit\n');`
- Line 1888: `final sourceWatcher = Directory(libPath).watch(recursive: true);`
- Line 1889: `final testWatcher = Directory(testPath).watch(recursive: true);`
- Line 1892: `final watchStream = StreamGroup.merge([sourceWatcher, testWatcher]);`
- Line 1897: `await for (final event in watchStream) {`
- Line 1898: `if (event.path.endsWith('.dart')) {`
- Line 1899: `debounceTimer?.cancel();`
- Line 1900: `debounceTimer = Timer(const Duration(seconds: 1), () async {`
- Line 1901: `print('\nğŸ“ File changed: ${event.path}');`
- Line 1902: `print('Re-running coverage analysis...\n');`
- Line 1905: `uncoveredLines.clear();`
- Line 1906: `coveredLinesData.clear();`
- Line 1907: `uncoveredLinesData.clear();`
- Line 1908: `totalLinesData.clear();`
- Line 1909: `hitLinesData.clear();`
- Line 1912: `await runCoverage();`
- Line 1913: `await analyzeCoverage();`
- Line 1916: `print(`
- Line 1917: `'\nğŸ“Š Updated Coverage: ${overallCoverage.toStringAsFixed(1)}%',`
- Line 1919: `if (uncoveredLines.isNotEmpty) {`
- Line 1920: `print('  âš ï¸  ${uncoveredLines.length} lines need coverage');`
- Line 1930: `static Stream<T> merge<T>(List<Stream<T>> streams) {`
- Line 1931: `final controller = StreamController<T>();`
- Line 1932: `final subscriptions = <StreamSubscription<T>>[];`
- Line 1934: `for (final stream in streams) {`
- Line 1935: `subscriptions.add(`
- Line 1936: `stream.listen(`
- Line 1937: `controller.add,`
- Line 1938: `onError: controller.addError,`
- Line 1939: `onDone: () {`
- Line 1940: `if (subscriptions.every((s) => s.isPaused)) {`
- Line 1941: `controller.close();`
- Line 1948: `return controller.stream;`
- Line 1953: `FileAnalysis(this.path);`
- Line 1964: `void main(List<String> args) async {`
- Line 1966: `final autoFix = args.contains('--fix');`
- Line 1967: `final skipReport = args.contains('--no-report');`
- Line 1968: `final branchCoverage = args.contains('--branch');`
- Line 1969: `final incremental = args.contains('--incremental');`
- Line 1970: `final mutationTesting = args.contains('--mutation');`
- Line 1971: `final watchMode = args.contains('--watch');`
- Line 1972: `final parallel = args.contains('--parallel');`
- Line 1973: `final exportJson = args.contains('--json');`
- Line 1974: `final testImpactAnalysis = args.contains('--impact');`
- Line 1977: `final excludePatterns = <String>[];`
- Line 1978: `for (var i = 0; i < args.length; i++) {`
- Line 1979: `if (args[i] == '--exclude' && i + 1 < args.length) {`
- Line 1980: `excludePatterns.add(args[i + 1]);`
- Line 1987: `final failOnDecrease = args.contains('--fail-on-decrease');`
- Line 1988: `for (var i = 0; i < args.length; i++) {`
- Line 1990: `if (args[i].startsWith('--min-coverage')) {`
- Line 1991: `if (args[i].contains('=')) {`
- Line 1992: `minCoverage = double.tryParse(args[i].split('=')[1]) ?? 0;`
- Line 1993: `} else if (i + 1 < args.length) {`
- Line 1994: `minCoverage = double.tryParse(args[i + 1]) ?? 0;`
- Line 1996: `} else if (args[i].startsWith('--warn-coverage')) {`
- Line 1997: `if (args[i].contains('=')) {`
- Line 1998: `warnCoverage = double.tryParse(args[i].split('=')[1]) ?? 0;`
- Line 1999: `} else if (i + 1 < args.length) {`
- Line 2000: `warnCoverage = double.tryParse(args[i + 1]) ?? 0;`
- Line 2007: `for (var i = 0; i < args.length; i++) {`
- Line 2008: `if (args[i] == '--baseline' && i + 1 < args.length) {`
- Line 2009: `baselineFile = args[i + 1];`
- Line 2018: `final nonFlagArgs = <String>[];`
- Line 2019: `for (var i = 0; i < args.length; i++) {`
- Line 2020: `if (args[i] == '--lib' && i + 1 < args.length) {`
- Line 2021: `libPath = args[i + 1];`
- Line 2022: `i++; // Skip the next arg since we consumed it`
- Line 2023: `} else if (args[i] == '--test' && i + 1 < args.length) {`
- Line 2024: `testPath = args[i + 1];`
- Line 2025: `i++; // Skip the next arg since we consumed it`
- Line 2026: `} else if (!args[i].startsWith('--')) {`
- Line 2028: `final isPreviousFlag = i > 0 &&`
- Line 2029: `(args[i - 1] == '--lib' ||`
- Line 2030: `args[i - 1] == '--test' ||`
- Line 2031: `args[i - 1] == '--exclude' ||`
- Line 2032: `args[i - 1] == '--baseline' ||`
- Line 2033: `args[i - 1].startsWith('--min-coverage') ||`
- Line 2034: `args[i - 1].startsWith('--warn-coverage'));`
- Line 2036: `nonFlagArgs.add(args[i]);`
- Line 2042: `if (nonFlagArgs.isNotEmpty) {`
- Line 2044: `final firstArg = nonFlagArgs[0];`
- Line 2048: `if (nonFlagArgs.length > 1) {`
- Line 2049: `testPath = nonFlagArgs[1];`
- Line 2054: `if (firstArg.startsWith('lib/src/')) {`
- Line 2056: `final moduleName = firstArg.substring('lib/src/'.length);`
- Line 2057: `derivedTestPath = 'test/$moduleName';`
- Line 2058: `} else if (firstArg.startsWith('lib/')) {`
- Line 2060: `derivedTestPath = firstArg.replaceFirst('lib/', 'test/');`
- Line 2061: `} else if (firstArg.startsWith('test/')) {`
- Line 2067: `derivedTestPath = 'test/$firstArg';`
- Line 2071: `final derivedFile = File(derivedTestPath);`
- Line 2072: `final derivedDir = Directory(derivedTestPath);`
- Line 2073: `if (derivedFile.existsSync() || derivedDir.existsSync()) {`
- Line 2077: `final withoutSlash = derivedTestPath.replaceAll(RegExp(r'/$'), '');`
- Line 2078: `if (Directory(withoutSlash).existsSync() ||`
- Line 2079: `File(withoutSlash).existsSync()) {`
- Line 2094: `if (args.contains('--help') || args.contains('-h')) {`
- Line 2095: `print('Usage: dart coverage_tool.dart [options] [module_path]');`
- Line 2096: `print('');`
- Line 2097: `print('Basic Options:');`
- Line 2098: `print('  --lib <path>          Path to source files (default: lib/src)');`
- Line 2099: `print('  --test <path>         Path to test files (default: test)');`
- Line 2100: `print('  --fix                 Generate missing test cases automatically');`
- Line 2101: `print('  --no-report           Skip generating coverage report');`
- Line 2102: `print('  --help, -h            Show this help message');`
- Line 2103: `print('');`
- Line 2104: `print('Advanced Options (v2.0):');`
- Line 2105: `print('  --branch              Include branch coverage analysis');`
- Line 2106: `print('  --incremental         Only analyze changed files (git diff)');`
- Line 2107: `print('  --mutation            Run mutation testing');`
- Line 2108: `print(`
- Line 2111: `print('  --parallel            Use parallel test execution');`
- Line 2112: `print('  --json                Export JSON report');`
- Line 2113: `print('  --impact              Enable test impact analysis');`
- Line 2114: `print(`
- Line 2117: `print('                        Common patterns:');`
- Line 2118: `print(`
- Line 2121: `print(`
- Line 2124: `print('                          --exclude "test/mocks/*"    (mock files)');`
- Line 2125: `print('  --baseline <file>     Compare against baseline coverage');`
- Line 2126: `print('  --min-coverage <n>    Minimum coverage threshold (0-100)');`
- Line 2127: `print('  --warn-coverage <n>   Warning coverage threshold (0-100)');`
- Line 2128: `print('  --fail-on-decrease    Fail if coverage decreases from baseline');`
- Line 2129: `print('');`
- Line 2130: `print('Examples:');`
- Line 2131: `print('  # Basic usage');`
- Line 2132: `print('  dart coverage_tool.dart performance');`
- Line 2133: `print('');`
- Line 2134: `print('  # With auto-fix');`
- Line 2135: `print('  dart coverage_tool.dart lib/src/core --fix');`
- Line 2136: `print('');`
- Line 2137: `print('  # Incremental coverage with branch analysis');`
- Line 2138: `print('  dart coverage_tool.dart --incremental --branch');`
- Line 2139: `print('');`
- Line 2140: `print('  # Parallel execution with thresholds');`
- Line 2141: `print(`
- Line 2144: `print('');`
- Line 2145: `print('  # Exclude generated files');`
- Line 2146: `print(`
- Line 2149: `print('');`
- Line 2150: `print('  # Full analysis with all features');`
- Line 2151: `print('  dart coverage_tool.dart --fix --branch --parallel --json');`
- Line 2152: `print('');`
- Line 2153: `print('Note: Coverage badge is automatically embedded in every report');`
- Line 2154: `exit(0);`
- Line 2157: `final analyzer = CoverageAnalyzer(`
- Line 2170: `thresholds: CoverageThresholds(`
- Line 2179: `await analyzer.analyze();`
- Line 2181: `if (analyzer.uncoveredLines.isEmpty) {`
- Line 2182: `print('\nâœ… SUCCESS: 100% test coverage achieved!');`
- Line 2183: `exit(0);`
- Line 2184: `} else if (analyzer.thresholdViolation) {`
- Line 2185: `print('\nâŒ FAILURE: Coverage thresholds not met');`
- Line 2186: `print('${analyzer.uncoveredLines.length} lines are not covered');`
- Line 2187: `exit(1); // Exit with error code for CI/CD`
- Line 2189: `print(`
- Line 2190: `'\nâš ï¸  INFO: ${analyzer.uncoveredLines.length} lines are not covered',`
- Line 2192: `print('Run with --fix to generate missing tests automatically');`
- Line 2193: `exit(0); // Exit successfully - coverage is acceptable`
- Line 2196: `print('\nâŒ ERROR: $e');`
- Line 2197: `print(stack);`
- Line 2198: `exit(2);`

</details>

## ğŸ’¡ Recommendations

To achieve 100% coverage, focus on:

1. **Error Handling** (11 catch blocks)
   - Add tests that throw exceptions
   - Test error recovery paths

2. **Branch Coverage** (473 conditionals)
   - Test both true and false conditions
   - Cover edge cases in if/else statements

3. **Other Logic** (2594 lines)
   - Review untested methods
   - Add integration tests for complex flows

## ğŸ› ï¸ How to Improve Coverage

1. **Run with auto-fix:** `dart coverage_tool.dart lib/src/bin --fix`
2. **View HTML report:** `genhtml coverage/lcov.info -o coverage/html && open coverage/html/index.html`
3. **Run specific tests:** `flutter test test/bin`

## ğŸ”§ Available Options

```bash
# Basic usage
dart analyzer/coverage_tool.dart lib/src/core

# With auto-fix
dart analyzer/coverage_tool.dart lib/src/core --fix

# Incremental coverage (changed files only)
dart analyzer/coverage_tool.dart lib/src/core --incremental

# With branch coverage
dart analyzer/coverage_tool.dart lib/src/core --branch

# Parallel execution
dart analyzer/coverage_tool.dart lib/src/core --parallel

# With coverage diff
dart analyzer/coverage_tool.dart lib/src/core --baseline=coverage_baseline.json

# Watch mode
dart analyzer/coverage_tool.dart lib/src/core --watch

# Export JSON report
dart analyzer/coverage_tool.dart lib/src/core --json

# With coverage thresholds
dart analyzer/coverage_tool.dart lib/src/core --min-coverage=80 --warn-coverage=60

# All features
dart analyzer/coverage_tool.dart lib/src/core --fix --branch --incremental --parallel --json
```

---
*Generated by coverage_tool.dart v2.0 - Enhanced with 11 new features*

---

## ğŸ“Š Machine-Readable Data

The following JSON contains all report data in machine-parseable format:

```json
{
  "metadata": {
    "tool": "coverage_tool",
    "version": "2.0",
    "generated": "2025-10-30T10:54:30.202409",
    "module": "lib/src/bin",
    "test_path": "test/bin"
  },
  "summary": {
    "overall_coverage": 2.378686964795433,
    "total_lines": 3153,
    "covered_lines": 75,
    "uncovered_lines": 3078,
    "files_analyzed": 4
  },
  "file_coverages": [
    {
      "file": "/Users/unfazed-mac/Developer/packages/test_analyzer/lib/src/bin/failed_test_extractor_lib.dart",
      "coverage": 6.179775280898876,
      "total_lines": 356,
      "covered_lines": 22
    },
    {
      "file": "/Users/unfazed-mac/Developer/packages/test_analyzer/lib/src/bin/run_all_lib.dart",
      "coverage": 7.602339181286549,
      "total_lines": 513,
      "covered_lines": 39
    },
    {
      "file": "/Users/unfazed-mac/Developer/packages/test_analyzer/lib/src/bin/test_analyzer_lib.dart",
      "coverage": 0.08084074373484236,
      "total_lines": 1237,
      "covered_lines": 1
    },
    {
      "file": "/Users/unfazed-mac/Developer/packages/test_analyzer/lib/src/bin/coverage_tool_lib.dart",
      "coverage": 1.241642788920726,
      "total_lines": 1047,
      "covered_lines": 13
    }
  ]
}
```
